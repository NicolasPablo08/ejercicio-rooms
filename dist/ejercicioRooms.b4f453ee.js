let e,t,n,r,i,s,o,a,l,h,u,c,d,f;var p,g,m,y,_,v,w,b,E,C,T,I,x,S,k,A,N,R,P,D,O,L,M,F,U=globalThis,B={},j={},V=U.parcelRequire8e79;null==V&&((V=function(e){if(e in B)return B[e].exports;if(e in j){var t=j[e];delete j[e];var n={id:e,exports:{}};return B[e]=n,t.call(n.exports,n,n.exports),n.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){j[e]=t},U.parcelRequire8e79=V);var q=V.register;function $(e,t){void 0===t&&(t={});for(var n=function(e){for(var t=[],n=0;n<e.length;){var r=e[n];if("*"===r||"+"===r||"?"===r){t.push({type:"MODIFIER",index:n,value:e[n++]});continue}if("\\"===r){t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});continue}if("{"===r){t.push({type:"OPEN",index:n,value:e[n++]});continue}if("}"===r){t.push({type:"CLOSE",index:n,value:e[n++]});continue}if(":"===r){for(var i="",s=n+1;s<e.length;){var o=e.charCodeAt(s);if(o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122||95===o){i+=e[s++];continue}break}if(!i)throw TypeError("Missing parameter name at ".concat(n));t.push({type:"NAME",index:n,value:i}),n=s;continue}if("("===r){var a=1,l="",s=n+1;if("?"===e[s])throw TypeError('Pattern cannot start with "?" at '.concat(s));for(;s<e.length;){if("\\"===e[s]){l+=e[s++]+e[s++];continue}if(")"===e[s]){if(0==--a){s++;break}}else if("("===e[s]&&(a++,"?"!==e[s+1]))throw TypeError("Capturing groups are not allowed at ".concat(s));l+=e[s++]}if(a)throw TypeError("Unbalanced pattern at ".concat(n));if(!l)throw TypeError("Missing pattern at ".concat(n));t.push({type:"PATTERN",index:n,value:l}),n=s;continue}t.push({type:"CHAR",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),r=t.prefixes,i=void 0===r?"./":r,s=t.delimiter,o=void 0===s?"/#?":s,a=[],l=0,h=0,u="",c=function(e){if(h<n.length&&n[h].type===e)return n[h++].value},d=function(e){var t=c(e);if(void 0!==t)return t;var r=n[h],i=r.type,s=r.index;throw TypeError("Unexpected ".concat(i," at ").concat(s,", expected ").concat(e))},f=function(){for(var e,t="";e=c("CHAR")||c("ESCAPED_CHAR");)t+=e;return t},p=function(e){for(var t=0;t<o.length;t++){var n=o[t];if(e.indexOf(n)>-1)return!0}return!1},g=function(e){var t=a[a.length-1],n=e||(t&&"string"==typeof t?t:"");if(t&&!n)throw TypeError('Must have text between two parameters, missing text after "'.concat(t.name,'"'));return!n||p(n)?"[^".concat(z(o),"]+?"):"(?:(?!".concat(z(n),")[^").concat(z(o),"])+?")};h<n.length;){var m=c("CHAR"),y=c("NAME"),_=c("PATTERN");if(y||_){var v=m||"";-1===i.indexOf(v)&&(u+=v,v=""),u&&(a.push(u),u=""),a.push({name:y||l++,prefix:v,suffix:"",pattern:_||g(v),modifier:c("MODIFIER")||""});continue}var w=m||c("ESCAPED_CHAR");if(w){u+=w;continue}if(u&&(a.push(u),u=""),c("OPEN")){var v=f(),b=c("NAME")||"",E=c("PATTERN")||"",C=f();d("CLOSE"),a.push({name:b||(E?l++:""),pattern:b&&!E?g(v):E,prefix:v,suffix:C,modifier:c("MODIFIER")||""});continue}d("END")}return a}q("f504n",function(e,t){var n=V("23YZo"),r=V("fiQnm"),i=t&&!t.nodeType&&t,s=i&&e&&!e.nodeType&&e,o=s&&s.exports===i?n.Buffer:void 0;e.exports=(o?o.isBuffer:void 0)||r}),q("23YZo",function(e,t){var n=V("ljJ8G"),r="object"==typeof self&&self&&self.Object===Object&&self;e.exports=n||r||Function("return this")()}),q("ljJ8G",function(e,t){e.exports="object"==typeof U&&U&&U.Object===Object&&U}),q("fiQnm",function(e,t){e.exports=function(){return!1}}),q("jIny1",function(e,t){var n=V("ljJ8G"),r=t&&!t.nodeType&&t,i=r&&e&&!e.nodeType&&e,s=i&&i.exports===r&&n.process;e.exports=function(){try{var e=i&&i.require&&i.require("util").types;if(e)return e;return s&&s.binding&&s.binding("util")}catch(e){}}()});function H(e,t){void 0===t&&(t={});var n=W(t),r=t.encode,i=void 0===r?function(e){return e}:r,s=t.validate,o=void 0===s||s,a=e.map(function(e){if("object"==typeof e)return new RegExp("^(?:".concat(e.pattern,")$"),n)});return function(t){for(var n="",r=0;r<e.length;r++){var s=e[r];if("string"==typeof s){n+=s;continue}var l=t?t[s.name]:void 0,h="?"===s.modifier||"*"===s.modifier,u="*"===s.modifier||"+"===s.modifier;if(Array.isArray(l)){if(!u)throw TypeError('Expected "'.concat(s.name,'" to not repeat, but got an array'));if(0===l.length){if(h)continue;throw TypeError('Expected "'.concat(s.name,'" to not be empty'))}for(var c=0;c<l.length;c++){var d=i(l[c],s);if(o&&!a[r].test(d))throw TypeError('Expected all "'.concat(s.name,'" to match "').concat(s.pattern,'", but got "').concat(d,'"'));n+=s.prefix+d+s.suffix}continue}if("string"==typeof l||"number"==typeof l){var d=i(String(l),s);if(o&&!a[r].test(d))throw TypeError('Expected "'.concat(s.name,'" to match "').concat(s.pattern,'", but got "').concat(d,'"'));n+=s.prefix+d+s.suffix;continue}if(!h){var f=u?"an array":"a string";throw TypeError('Expected "'.concat(s.name,'" to be ').concat(f))}}return n}}function z(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function W(e){return e&&e.sensitive?"":"i"}function K(e){return"object"==typeof e&&!!e}function G(e){return"function"==typeof e}function Y(e){return"string"==typeof e}function Q(e=[]){return Array.isArray(e)?e:[e]}function X(e){return`[Vaadin.Router] ${e}`}class J extends Error{code;context;constructor(e){super(X(`Page not found (${e.pathname})`)),this.context=e,this.code=404}}const Z=Symbol("NotFoundResult");function ee(e){return(Array.isArray(e)?e[0]:e)??""}function et(e){return ee(e?.path)}const en=new Map;function er(e){try{return decodeURIComponent(e)}catch{return e}}en.set("|false",{keys:[],pattern:/(?:)/u});var ei=function(e,t,n=!1,r=[],i){let s=`${e}|${String(n)}`,o=ee(t),a=en.get(s);if(!a){let t=[];a={keys:t,pattern:function e(t,n,r){if(t instanceof RegExp){var i;if(!n)return t;for(var s=/\((?:\?<(.*?)>)?(?!\?)/g,o=0,a=s.exec(t.source);a;)n.push({name:a[1]||o++,prefix:"",suffix:"",modifier:"",pattern:""}),a=s.exec(t.source);return t}return Array.isArray(t)?(i=t.map(function(t){return e(t,n,r).source}),new RegExp("(?:".concat(i.join("|"),")"),W(r))):function(e,t,n){void 0===n&&(n={});for(var r=n.strict,i=void 0!==r&&r,s=n.start,o=n.end,a=n.encode,l=void 0===a?function(e){return e}:a,h=n.delimiter,u=n.endsWith,c="[".concat(z(void 0===u?"":u),"]|$"),d="[".concat(z(void 0===h?"/#?":h),"]"),f=void 0===s||s?"^":"",p=0;p<e.length;p++){var g=e[p];if("string"==typeof g)f+=z(l(g));else{var m=z(l(g.prefix)),y=z(l(g.suffix));if(g.pattern)if(t&&t.push(g),m||y)if("+"===g.modifier||"*"===g.modifier){var _="*"===g.modifier?"?":"";f+="(?:".concat(m,"((?:").concat(g.pattern,")(?:").concat(y).concat(m,"(?:").concat(g.pattern,"))*)").concat(y,")").concat(_)}else f+="(?:".concat(m,"(").concat(g.pattern,")").concat(y,")").concat(g.modifier);else{if("+"===g.modifier||"*"===g.modifier)throw TypeError('Can not repeat "'.concat(g.name,'" without a prefix and suffix'));f+="(".concat(g.pattern,")").concat(g.modifier)}else f+="(?:".concat(m).concat(y,")").concat(g.modifier)}}if(void 0===o||o)i||(f+="".concat(d,"?")),f+=n.endsWith?"(?=".concat(c,")"):"$";else{var v=e[e.length-1],w="string"==typeof v?d.indexOf(v[v.length-1])>-1:void 0===v;i||(f+="(?:".concat(d,"(?=").concat(c,"))?")),w||(f+="(?=".concat(d,"|").concat(c,")"))}return new RegExp(f,W(n))}($(t,r),n,r)}(e,t,{end:n,strict:""===e})},en.set(s,a)}let l=a.pattern.exec(o);if(!l)return null;let h={...i};for(let e=1;e<l.length;e++){let t=a.keys[e-1],n=t.name,r=l[e];void 0===r&&Object.hasOwn(h,n)||("+"===t.modifier||"*"===t.modifier?h[n]=r?r.split(/[/?#]/u).map(er):[]:h[n]=r?er(r):r)}return{keys:[...r,...a.keys],params:h,path:l[0]}},es=function e(t,n,r,i,s){let o,a,l=0,h=et(t);return h.startsWith("/")&&(r&&(h=h.substring(1)),r=!0),{next(u){var c;if(t===u)return{done:!0,value:void 0};t.__children??=Array.isArray(c=t.children)&&c.length>0?c:void 0;let d=t.__children??[],f=!t.__children&&!t.children;if(!o&&(o=ei(h,n,f,i,s)))return{value:{keys:o.keys,params:o.params,path:o.path,route:t}};if(o&&d.length>0)for(;l<d.length;){if(!a){let i=d[l];i.parent=t;let s=o.path.length;s>0&&"/"===n.charAt(s)&&(s+=1),a=e(i,n.substring(s),r,o.keys,o.params)}let i=a.next(u);if(!i.done)return{done:!1,value:i.value};a=null,l+=1}return{done:!0,value:void 0}}}};function eo(e){if(G(e.route.action))return e.route.action(e)}class ea extends Error{code;context;constructor(e,t){let n=`Path '${e.pathname}' is not properly resolved due to an error.`,r=et(e.route);r&&(n+=` Resolution had failed on route: '${r}'`),super(n,t),this.code=t?.code,this.context=e}warn(){console.warn(this.message)}}class el{baseUrl;#e;errorHandler;resolveRoute;#t;constructor(e,{baseUrl:t="",context:n,errorHandler:r,resolveRoute:i=eo}={}){if(Object(e)!==e)throw TypeError("Invalid routes");this.baseUrl=t,this.errorHandler=r,this.resolveRoute=i,Array.isArray(e)?this.#t={__children:e,__synthetic:!0,action:()=>void 0,path:""}:this.#t={...e,parent:void 0},this.#e={...n,hash:"",next:async()=>Z,params:{},pathname:"",resolver:this,route:this.#t,search:"",chain:[]}}get root(){return this.#t}get context(){return this.#e}get __effectiveBaseUrl(){return this.baseUrl?new URL(this.baseUrl,document.baseURI||document.URL).href.replace(/[^/]*$/u,""):""}getRoutes(){return[...this.#t.__children??[]]}removeRoutes(){this.#t.__children=[]}async resolve(e){let t=this,n={...this.#e,...Y(e)?{pathname:e}:e,next:l},r=es(this.#t,this.__normalizePathname(n.pathname)??n.pathname,!!this.baseUrl),i=this.resolveRoute,s=null,o=null,a=n;async function l(e=!1,h=s?.value?.route,u){let c=null===u?s?.value?.route:void 0;if(s=o??r.next(c),o=null,!e&&(s.done||!function(e,t){let n=e;for(;n;)if((n=n.parent)===t)return!0;return!1}(s.value.route,h)))return o=s,Z;if(s.done)throw new J(n);var d=a={...n,params:s.value.params,route:s.value.route,chain:a.chain?.slice()};let{path:f,route:p}=s.value;if(p&&!p.__synthetic){if(p.parent&&d.chain)for(let e=d.chain.length-1;e>=0&&d.chain[e].route!==p.parent;e--)d.chain.pop();d.chain?.push({path:f,route:p})}let g=await i(a);return null!=g&&g!==Z?(a.result=g&&"object"==typeof g&&"next"in g&&"params"in g&&"result"in g&&"route"in g?g.result:g,t.#e=a,a):await l(e,h,g)}try{return await l(!0,this.#t)}catch(t){let e=t instanceof J?t:new ea(a,{code:500,cause:t});if(this.errorHandler)return a.result=this.errorHandler(e),a;throw t}}setRoutes(e){this.#t.__children=[...Q(e)]}__normalizePathname(e){if(!this.baseUrl)return e;let t=this.__effectiveBaseUrl,n=e.startsWith("/")?new URL(t).origin+e:`./${e}`,r=new URL(n,t).href;if(r.startsWith(t))return r.slice(t.length)}addRoutes(e){return this.#t.__children=[...this.#t.__children??[],...Q(e)],this.getRoutes()}}function eh(e,t){let n=e.get(t);if(n){if(n.length>1)throw Error(`Duplicate route with name "${t}". Try seting unique 'name' route properties.`);return n[0]}}var eu=function(e,t={}){if(!(e instanceof el))throw TypeError("An instance of Resolver is expected");let n=new Map,r=new Map;return(i,s)=>{let o=eh(r,i);if(!o&&(r.clear(),!function e(t,n,r,i){let s=n.name??i?.(n);if(s&&(t.has(s)?t.get(s)?.push(n):t.set(s,[n])),Array.isArray(r))for(let s of r)s.parent=n,e(t,s,s.__children??s.children,i)}(r,e.root,e.root.__children,t.cacheKeyProvider),!(o=eh(r,i))))throw Error(`Route "${i}" not found`);let a=o.fullPath?n.get(o.fullPath):void 0;if(!a){let e=et(o),t=o.parent;for(;t;){let n=et(t);n&&(e=`${n.replace(/\/$/u,"")}/${e.replace(/^\//u,"")}`),t=t.parent}let r=$(e),i=Object.create(null);for(let e of r)Y(e)||(i[e.name]=!0);a={keys:i,tokens:r},n.set(e,a),o.fullPath=e}let l=H(a.tokens,{encode:encodeURIComponent,...t})(s)||"/";if(t.stringifyQueryParams&&s){let e={};for(let[t,n]of Object.entries(s))t in a.keys||!n||(e[t]=n);let n=t.stringifyQueryParams(e);n&&(l+=n.startsWith("?")?n:`?${n}`)}return l}};const ec=/\/\*[\*!]\s+vaadin-dev-mode:start([\s\S]*)vaadin-dev-mode:end\s+\*\*\//i,ed=window.Vaadin&&window.Vaadin.Flow&&window.Vaadin.Flow.clients;function ef(e,t){if("function"!=typeof e)return;let n=ec.exec(e.toString());if(n)try{e=Function(n[1])}catch(e){console.log("vaadin-development-mode-detector: uncommentAndRun() failed",e)}return e(t)}window.Vaadin=window.Vaadin||{};const ep=function(e,t){if(window.Vaadin.developmentMode)return ef(e,t)};function eg(){}void 0===window.Vaadin.developmentMode&&(window.Vaadin.developmentMode=function(){try{if(localStorage.getItem("vaadin.developmentmode.force"))return!0;if(!(["localhost","127.0.0.1"].indexOf(window.location.hostname)>=0))return!1;if(ed)return!(ed&&Object.keys(ed).map(e=>ed[e]).filter(e=>e.productionMode).length>0);return!ef(function(){return!0})}catch(e){return!1}}()),!function(e=window.Vaadin??={}){e.registrations??=[],e.registrations.push({is:"@vaadin/router",version:"2.0.0"})}(),"function"==typeof ep&&ep(eg);const em=e=>{let t=getComputedStyle(e).getPropertyValue("animation-name");return t&&"none"!==t},ey=(e,t)=>{let n=()=>{e.removeEventListener("animationend",n),t()};e.addEventListener("animationend",n)};async function e_(e,t){return e.classList.add(t),await new Promise(n=>{if(em(e)){let r=e.getBoundingClientRect(),i=`height: ${r.bottom-r.top}px; width: ${r.right-r.left}px`;e.setAttribute("style",`position: absolute; ${i}`),ey(e,()=>{e.classList.remove(t),e.removeAttribute("style"),n()})}else e.classList.remove(t),n()})}function ev(e){if(!e||!Y(e.path))throw Error(X('Expected route config to be an object with a "path" string property, or an array of such objects'));if(!G(e.action)&&!Array.isArray(e.children)&&!G(e.children)&&!Y(e.component)&&!Y(e.redirect))throw Error(X(`Expected route config "${e.path}" to include either "component, redirect" or "action" function but none found.`));e.redirect&&["bundle","component"].forEach(t=>{t in e&&console.warn(X(`Route config "${String(e.path)}" has both "redirect" and "${t}" properties, and "redirect" will always override the latter. Did you mean to only use "${t}"?`))})}function ew(e){Q(e).forEach(e=>ev(e))}function eb(e,t){let n=t.__effectiveBaseUrl;return n?new URL(e.replace(/^\//u,""),n).pathname:e}function eE(e){return e.map(e=>e.path).reduce((e,t)=>t.length?`${e.replace(/\/$/u,"")}/${t.replace(/^\//u,"")}`:e,"")}function eC({chain:e=[],hash:t="",params:n={},pathname:r="",redirectFrom:i,resolver:s,search:o=""},a){let l=e.map(e=>e.route);return{baseUrl:s?.baseUrl??"",getUrl:(t={})=>{var r;return s?eb(H($(eE(e.map(e=>e.route)),void 0),r)({...n,...t}),s):""},hash:t,params:n,pathname:r,redirectFrom:i,route:a??(Array.isArray(l)?l.at(-1):void 0)??null,routes:l,search:o,searchParams:new URLSearchParams(o)}}function eT(e,t){let n={...e.params};return{redirect:{from:e.pathname,params:n,pathname:t}}}function eI(e,t,...n){if("function"==typeof e)return e.apply(t,n)}function ex(e,t,...n){return r=>r&&K(r)&&("cancel"in r||"redirect"in r)?r:eI(t?.[e],t,...n)}function eS(e,t){return!window.dispatchEvent(new CustomEvent(`vaadin-router-${e}`,{cancelable:"go"===e,detail:t}))}function ek(e){if(e instanceof Element)return e.nodeName.toLowerCase()}function eA(e){if(e.defaultPrevented||0!==e.button||e.shiftKey||e.ctrlKey||e.altKey||e.metaKey)return;let t=e.target,n=e instanceof MouseEvent?e.composedPath():e.path??[];for(let e=0;e<n.length;e++){let r=n[e];if("nodeName"in r&&"a"===r.nodeName.toLowerCase()){t=r;break}}for(;t&&t instanceof Node&&"a"!==ek(t);)t=t.parentNode;if(!t||"a"!==ek(t))return;let r=t;if(r.target&&"_self"!==r.target.toLowerCase()||r.hasAttribute("download")||r.hasAttribute("router-ignore")||r.pathname===window.location.pathname&&""!==r.hash||(r.origin||function(e){let{port:t,protocol:n}=e,r="http:"===n&&"80"===t||"https:"===n&&"443"===t?e.hostname:e.host;return`${n}//${r}`}(r))!==window.location.origin)return;let{hash:i,pathname:s,search:o}=r;eS("go",{hash:i,pathname:s,search:o})&&e instanceof MouseEvent&&(e.preventDefault(),"click"===e.type&&window.scrollTo(0,0))}function eN(e){if("vaadin-router-ignore"===e.state)return;let{hash:t,pathname:n,search:r}=window.location;eS("go",{hash:t,pathname:n,search:r})}let eR=[];const eP={CLICK:{activate(){window.document.addEventListener("click",eA)},inactivate(){window.document.removeEventListener("click",eA)}},POPSTATE:{activate(){window.addEventListener("popstate",eN)},inactivate(){window.removeEventListener("popstate",eN)}}};function eD(e=[]){eR.forEach(e=>e.inactivate()),e.forEach(e=>e.activate()),eR=e}function eO(){return{cancel:!0}}const eL={__renderId:-1,params:{},route:{__synthetic:!0,children:[],path:"",action(){}},pathname:"",next:async()=>Z};class eM extends el{location=eC({resolver:this});ready=Promise.resolve(this.location);#n=new WeakSet;#r=new WeakSet;#i=this.#s.bind(this);#o=0;#a;__previousContext;#l;#h=null;#u=null;constructor(e,t){let n=document.head.querySelector("base"),r=n?.getAttribute("href");super([],{baseUrl:r?new URL(r,document.URL).href.replace(/[^/]*$/u,""):void 0,...t,resolveRoute:async e=>await this.#c(e)}),eD(Object.values(eP)),this.setOutlet(e),this.subscribe()}async #c(e){let{route:t}=e;if(G(t.children)){let r=await t.children(function({next:e,...t}){return t}(e));G(t.children)||({children:r}=t);var n=r;if(!Array.isArray(n)&&!K(n))throw Error(X(`Incorrect "children" value for the route ${String(t.path)}: expected array or object, but got ${String(n)}`));let i=Q(n);i.forEach(e=>ev(e)),t.__children=i}let r={component:e=>{let t=document.createElement(e);return this.#r.add(t),t},prevent:eO,redirect:t=>eT(e,t)};return await Promise.resolve().then(async()=>{if(this.#d(e))return await eI(t.action,t,e,r)}).then(e=>null!=e&&("object"==typeof e||"symbol"==typeof e)&&(e instanceof HTMLElement||e===Z||K(e)&&"redirect"in e)?e:Y(t.redirect)?r.redirect(t.redirect):void 0).then(e=>null!=e?e:Y(t.component)?r.component(t.component):void 0)}setOutlet(e){e&&this.#f(e),this.#a=e}getOutlet(){return this.#a}async setRoutes(e,t=!1){return this.__previousContext=void 0,this.#l=void 0,ew(e),super.setRoutes(e),t||this.#s(),await this.ready}addRoutes(e){return ew(e),super.addRoutes(e)}async render(e,t=!1){this.#o+=1;let n=this.#o,r={...eL,...Y(e)?{hash:"",search:"",pathname:e}:e,__renderId:n};return this.ready=this.#p(r,t),await this.ready}async #p(e,t){let{__renderId:n}=e;try{let r=await this.resolve(e),i=await this.#g(r);if(!this.#d(i))return this.location;let s=this.__previousContext;if(i===s)return this.#m(s,!0),this.location;if(this.location=eC(i),t&&this.#m(i,1===n),eS("location-changed",{router:this,location:this.location}),i.__skipAttach)return this.#y(i,s),this.__previousContext=i,this.location;this.#_(i,s);let o=this.#v(i);if(this.#w(i),this.#b(i,s),await o,this.#d(i))return this.#E(),this.__previousContext=i,this.location}catch(r){if(n===this.#o){for(let e of(t&&this.#m(this.context),this.#a?.children??[]))e.remove();throw this.location=eC(Object.assign(e,{resolver:this})),eS("error",{router:this,error:r,...e}),r}}return this.location}async #g(e,t=e){let n=await this.#C(t),r=n!==t?n:e,i=eb(eE(n.chain??[]),this)===n.pathname,s=async(e,t=e.route,n)=>{let r=await e.next(!1,t,n);if(null===r||r===Z){if(i)return e;if(null!=t.parent)return await s(e,t.parent,r)}return r},o=await s(n);if(null==o||o===Z)throw new J(r);return o!==n?await this.#g(r,o):await this.#T(n)}async #C(e){let{result:t}=e;if(t instanceof HTMLElement)return!function(e,t){if(t.location=eC(e),e.chain){let n=e.chain.map(e=>e.route).indexOf(e.route);e.chain[n].element=t}}(e,t),e;if(t&&"redirect"in t){let n=await this.#I(t.redirect,e.__redirectCount,e.__renderId);return await this.#C(n)}throw t instanceof Error?t:Error(X(`Invalid route resolution result for path "${e.pathname}". Expected redirect object or HTML element, but got: "${function(e){if("object"!=typeof e)return String(e);let[t="Unknown"]=/ (.*)\]$/u.exec(String(e))??[];return"Object"===t||"Array"===t?`${t} ${JSON.stringify(e)}`:t}(t)}". Double check the action return value for the route.`))}async #T(e){return await this.#x(e).then(async t=>t===this.__previousContext||t===e?t:await this.#g(t))}async #x(e){let t=this.__previousContext??{},n=t.chain??[],r=e.chain??[],i=Promise.resolve(void 0),s=t=>eT(e,t);if(e.__divergedChainIndex=0,e.__skipAttach=!1,n.length){for(let t=0;t<Math.min(n.length,r.length)&&n[t].route===r[t].route&&(n[t].path===r[t].path||n[t].element===r[t].element)&&this.#S(n[t].element,r[t].element);e.__divergedChainIndex++,t++);if(e.__skipAttach=r.length===n.length&&e.__divergedChainIndex===r.length&&this.#S(e.result,t.result),e.__skipAttach){for(let t=r.length-1;t>=0;t--)i=this.#k(i,e,{prevent:eO},n[t]);for(let t=0;t<r.length;t++)i=this.#A(i,e,{prevent:eO,redirect:s},r[t]),n[t].element.location=eC(e,n[t].route)}else for(let t=n.length-1;t>=e.__divergedChainIndex;t--)i=this.#k(i,e,{prevent:eO},n[t])}if(!e.__skipAttach)for(let t=0;t<r.length;t++)t<e.__divergedChainIndex?t<n.length&&n[t].element&&(n[t].element.location=eC(e,n[t].route)):(i=this.#A(i,e,{prevent:eO,redirect:s},r[t]),r[t].element&&(r[t].element.location=eC(e,r[t].route)));return await i.then(async t=>{if(t&&K(t)){if("cancel"in t&&this.__previousContext)return this.__previousContext.__renderId=e.__renderId,this.__previousContext;if("redirect"in t)return await this.#I(t.redirect,e.__redirectCount,e.__renderId)}return e})}async #k(e,t,n,r){let i=eC(t),s=await e;if(this.#d(t)&&(s=ex("onBeforeLeave",r.element,i,n,this)(s)),!(K(s)&&"redirect"in s))return s}async #A(e,t,n,r){let i=eC(t,r.route),s=await e;if(this.#d(t))return ex("onBeforeEnter",r.element,i,n,this)(s)}#S(e,t){return!!(e instanceof Element&&t instanceof Element)&&(this.#r.has(e)&&this.#r.has(t)?e.localName===t.localName:e===t)}#d(e){return e.__renderId===this.#o}async #I(e,t=0,n=0){if(t>256)throw Error(X(`Too many redirects when rendering ${e.from}`));return await this.resolve({...eL,pathname:this.urlForPath(e.pathname,e.params),redirectFrom:e.from,__redirectCount:t+1,__renderId:n})}#f(e=this.#a){if(!(e instanceof Element||e instanceof DocumentFragment))throw TypeError(X(`Expected router outlet to be a valid DOM Element | DocumentFragment (but got ${e})`))}#m({pathname:e,search:t="",hash:n=""},r){(window.location.pathname!==e||window.location.search!==t||window.location.hash!==n)&&(window.history[r?"replaceState":"pushState"](null,document.title,e+t+n),window.dispatchEvent(new PopStateEvent("popstate",{state:"vaadin-router-ignore"})))}#y(e,t){let n=this.#a;for(let r=0;r<(e.__divergedChainIndex??0);r++){let i=t?.chain?.[r].element;if(i)if(i.parentNode===n)e.chain[r].element=i,n=i;else break}return n}#_(e,t){this.#f(),this.#N();let n=this.#y(e,t);this.#h=[],this.#u=Array.from(n?.children??[]).filter(t=>this.#n.has(t)&&t!==e.result);let r=n;for(let t=e.__divergedChainIndex??0;t<(e.chain?.length??0);t++){let i=e.chain[t].element;i&&(r?.appendChild(i),this.#n.add(i),r===n&&this.#h.push(i),r=i)}}#E(){if(this.#u)for(let e of this.#u)e.remove();this.#u=null,this.#h=null}#N(){if(this.#u&&this.#h){for(let e of this.#h)e.remove();this.#u=null,this.#h=null}}#b(e,t){if(t?.chain&&null!=e.__divergedChainIndex)for(let n=t.chain.length-1;n>=e.__divergedChainIndex&&this.#d(e);n--){let r=t.chain[n].element;if(r)try{let t=eC(e);eI(r.onAfterLeave,r,t,{},this)}finally{if(this.#u?.includes(r))for(let e of r.children)e.remove()}}}#w(e){if(e.chain&&null!=e.__divergedChainIndex)for(let t=e.__divergedChainIndex;t<e.chain.length&&this.#d(e);t++){let n=e.chain[t].element;if(n){let r=eC(e,e.chain[t].route);eI(n.onAfterEnter,n,r,{},this)}}}async #v(e){let t,n=this.#u?.[0],r=this.#h?.[0],i=[],{chain:s=[]}=e;for(let e=s.length-1;e>=0;e--)if(s[e].route.animate){t=s[e].route.animate;break}if(n&&r&&t){let e=K(t)&&t.leave?t.leave:"leaving",s=K(t)&&t.enter?t.enter:"entering";i.push(e_(n,e)),i.push(e_(r,s))}return await Promise.all(i),e}subscribe(){window.addEventListener("vaadin-router-go",this.#i)}unsubscribe(){window.removeEventListener("vaadin-router-go",this.#i)}#s(e){let{pathname:t,search:n,hash:r}=e instanceof CustomEvent?e.detail:window.location;Y(this.__normalizePathname(t))&&(e?.preventDefault&&e.preventDefault(),this.render({pathname:t,search:n,hash:r},!0))}static setTriggers(...e){eD(e)}urlForName(e,t){return this.#l||(this.#l=eu(this,{cacheKeyProvider:e=>"component"in e&&"string"==typeof e.component?e.component:void 0})),eb(this.#l(e,t??void 0),this)}urlForPath(e,t){var n;return eb(H($(e,void 0),n)(t??void 0),this)}static go(e){let{pathname:t,search:n,hash:r}=Y(e)?new URL(e,"http://a"):e;return eS("go",{pathname:t,search:n,hash:r})}}new eM(document.documentElement.querySelector(".root")).setRoutes([{path:"/",component:"home-page"},{path:"/chat",component:"chat-page"},{path:"(.*)",redirect:"/"}]);const eF=()=>void 0,eU={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},eB=function(e,t){if(!e)throw ej(t)},ej=function(e){return Error("Firebase Database ("+eU.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},eV=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},eq=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=e[n++],o=((7&i)<<18|(63&s)<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{let s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")},e$={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=i>>2,u=(3&i)<<4|o>>4,c=(15&o)<<2|l>>6,d=63&l;!a&&(d=64,s||(c=64)),r.push(n[h],n[u],n[c],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(eV(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):eq(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw new eH;let l=i<<2|s>>4;if(r.push(l),64!==o){let e=s<<4&240|o>>2;if(r.push(e),64!==a){let e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class eH extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ez=function(e){let t=eV(e);return e$.encodeByteArray(t,!0)},eW=function(e){return ez(e).replace(/\./g,"")},eK=function(e){try{return e$.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},eG=()=>(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==U)return U;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,eY=()=>{},eQ=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&eK(e[1]);return t&&JSON.parse(t)},eX=()=>{try{return eF()||eG()||eY()||eQ()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},eJ=e=>{var t,n;return null==(n=null==(t=eX())?void 0:t.emulatorHosts)?void 0:n[e]},eZ=e=>{let t=eJ(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},e0=()=>{var e;return null==(e=eX())?void 0:e.config};class e1{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function e2(e){return e.endsWith(".cloudworkstations.dev")}async function e6(e){return(await fetch(e,{credentials:"include"})).ok}function e3(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[eW(JSON.stringify({alg:"none",type:"JWT"})),eW(JSON.stringify(s)),""].join(".")}const e5={};let e4=!1;function e8(e,t){if("undefined"==typeof window||"undefined"==typeof document||!e2(window.location.host)||e5[e]===t||e5[e]||e4)return;function n(e){return`__firebase__banner__${e}`}e5[e]=t;let r="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(e5))e5[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(r),t=!1,e||((e=document.createElement("div")).setAttribute("id",r),t=!0),{created:t,element:e}),o=n("text"),a=document.getElementById(o)||document.createElement("span"),l=n("learnmore"),h=document.getElementById(l)||document.createElement("a"),u=n("preprendIcon"),c=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e=s.element;e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center",h.setAttribute("id",l),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline";let t=function(){let e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{e4=!0;let e=document.getElementById(r);e&&e.remove()},e}();c.setAttribute("width","24"),c.setAttribute("id",u),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",e.append(c,a,h,t),document.body.appendChild(e)}i?(a.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText="Preview backend running in this workspace."),a.setAttribute("id",o)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function e7(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function e9(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(e7())}function te(){return!0===eU.NODE_CLIENT||!0===eU.NODE_ADMIN}class tt extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,tt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,tn.prototype.create)}}class tn{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?(n=o,r=i,n.replace(tr,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new tt(s,l,i)}}const tr=/\{\$([^}]+)}/g;function ti(e){return JSON.parse(e)}function ts(e){return JSON.stringify(e)}const to=function(e){let t={},n={},r={},i="";try{let s=e.split(".");t=ti(eK(s[0])||""),n=ti(eK(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}},ta=function(e){let t=to(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},tl=function(e){let t=to(e).claims;return"object"==typeof t&&!0===t.admin};function th(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function tu(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function tc(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function td(e,t,n){let r={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function tf(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(tp(n)&&tp(s)){if(!tf(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function tp(e){return null!==e&&"object"==typeof e}class tg{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,r;t||(t=0);let i=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)i[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)i[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=i[e-3]^i[e-8]^i[e-14]^i[e-16];i[e]=t<<1|t>>>31}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),r=0x5a827999):(n=o^a^l,r=0x6ed9eba1):e<60?(n=o&a|l&(o|a),r=0x8f1bbcdc):(n=o^a^l,r=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+r+i[e]|0;h=l,l=a,a=o<<30|o>>>2,o=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+o|0,this.chain_[2]=this.chain_[2]+a|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+h|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}}function tm(e,t){return`${e} failed: ${t} argument `}const ty=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){let t=i-55296;eB(++r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},t_=function(e){let t=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function tv(e){return e&&e._delegate?e._delegate:e}class tw{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const tb="[DEFAULT]";class tE{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new e1;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:tb})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=tb){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=tb){return this.instances.has(e)}getOptions(e=tb){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;let r=this.normalizeInstanceIdentifier(t),i=null!=(n=this.onInitCallbacks.get(r))?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===tb?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}return r||null}normalizeInstanceIdentifier(e=tb){return this.component?this.component.multipleInstances?e:tb:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class tC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new tE(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const tT=[];(p=y||(y={}))[p.DEBUG=0]="DEBUG",p[p.VERBOSE=1]="VERBOSE",p[p.INFO=2]="INFO",p[p.WARN=3]="WARN",p[p.ERROR=4]="ERROR",p[p.SILENT=5]="SILENT";const tI={debug:y.DEBUG,verbose:y.VERBOSE,info:y.INFO,warn:y.WARN,error:y.ERROR,silent:y.SILENT},tx=y.INFO,tS={[y.DEBUG]:"log",[y.VERBOSE]:"log",[y.INFO]:"info",[y.WARN]:"warn",[y.ERROR]:"error"},tk=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=tS[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class tA{constructor(e){this.name=e,this._logLevel=tx,this._logHandler=tk,this._userLogHandler=null,tT.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in y))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?tI[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,y.DEBUG,...e),this._logHandler(this,y.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,y.VERBOSE,...e),this._logHandler(this,y.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,y.INFO,...e),this._logHandler(this,y.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,y.WARN,...e),this._logHandler(this,y.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,y.ERROR,...e),this._logHandler(this,y.ERROR,...e)}}const tN=(e,t)=>t.some(t=>e instanceof t),tR=new WeakMap,tP=new WeakMap,tD=new WeakMap,tO=new WeakMap,tL=new WeakMap;let tM={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return tP.get(e);if("objectStoreNames"===t)return e.objectStoreNames||tD.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return tF(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function tF(n){if(n instanceof IDBRequest){let e=new Promise((e,t)=>{let r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",s)},i=()=>{e(tF(n.result)),r()},s=()=>{t(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",s)});return e.then(e=>{e instanceof IDBCursor&&tR.set(e,n)}).catch(()=>{}),tL.set(e,n),e}if(tO.has(n))return tO.get(n);let r=function(n){if("function"==typeof n)return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(t||(t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(n)?function(...e){return n.apply(tU(this),e),tF(tR.get(this))}:function(...e){return tF(n.apply(tU(this),e))}:function(e,...t){let r=n.call(tU(this),e,...t);return tD.set(r,e.sort?e.sort():[e]),tF(r)};return(n instanceof IDBTransaction&&function(e){if(tP.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});tP.set(e,t)}(n),tN(n,e||(e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(n,tM):n}(n);return r!==n&&(tO.set(n,r),tL.set(r,n)),r}const tU=e=>tL.get(e),tB=["get","getKey","getAll","getAllKeys","count"],tj=["put","add","delete","clear"],tV=new Map;function tq(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(tV.get(t))return tV.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=tj.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||tB.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return tV.set(t,s),s}tM={...f=tM,get:(e,t,n)=>tq(e,t)||f.get(e,t,n),has:(e,t)=>!!tq(e,t)||f.has(e,t)};class t${constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}const tH="@firebase/app",tz="0.13.1",tW=new tA("@firebase/app"),tK="[DEFAULT]",tG={[tH]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},tY=new Map,tQ=new Map,tX=new Map;function tJ(e,t){try{e.container.addComponent(t)}catch(n){tW.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function tZ(e){let t=e.name;if(tX.has(t))return tW.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(tX.set(t,e),tY.values()))tJ(n,e);for(let t of tQ.values())tJ(t,e);return!0}function t0(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function t1(e){return null!=e&&void 0!==e.settings}const t2=new tn("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class t6{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new tw("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw t2.create("app-deleted",{appName:this._name})}}const t3="11.9.0";function t5(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r=Object.assign({name:tK,automaticDataCollectionEnabled:!0},t),i=r.name;if("string"!=typeof i||!i)throw t2.create("bad-app-name",{appName:String(i)});if(n||(n=e0()),!n)throw t2.create("no-options");let s=tY.get(i);if(s)if(tf(n,s.options)&&tf(r,s.config))return s;else throw t2.create("duplicate-app",{appName:i});let o=new tC(i);for(let e of tX.values())o.addComponent(e);let a=new t6(n,r,o);return tY.set(i,a),a}function t4(e=tK){let t=tY.get(e);if(!t&&e===tK&&e0())return t5();if(!t)throw t2.create("no-app",{appName:e});return t}function t8(e,t,n){var r;let i=null!=(r=tG[e])?r:e;n&&(i+=`-${n}`);let s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){let e=[`Unable to register library "${i}" with version "${t}":`];s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),tW.warn(e.join(" "));return}tZ(new tw(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}const t7="firebase-heartbeat-store";let t9=null;function ne(){return t9||(t9=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(e,1),a=tF(o);return r&&o.addEventListener("upgradeneeded",e=>{r(tF(o.result),e.oldVersion,e.newVersion,tF(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(t7)}catch(e){console.warn(e)}}}).catch(e=>{throw t2.create("idb-open",{originalErrorMessage:e.message})})),t9}async function nt(e){try{let t=(await ne()).transaction(t7),n=await t.objectStore(t7).get(nr(e));return await t.done,n}catch(e){if(e instanceof tt)tW.warn(e.message);else{let t=t2.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});tW.warn(t.message)}}}async function nn(e,t){try{let n=(await ne()).transaction(t7,"readwrite"),r=n.objectStore(t7);await r.put(t,nr(e)),await n.done}catch(e){if(e instanceof tt)tW.warn(e.message);else{let t=t2.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});tW.warn(t.message)}}}function nr(e){return`${e.name}!${e.options.appId}`}class ni{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new no(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ns();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){tW.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=ns(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),na(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),na(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=eW(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return tW.warn(e),""}}}function ns(){return new Date().toISOString().substring(0,10)}class no{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await nt(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return nn(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return nn(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function na(e){return eW(JSON.stringify({version:2,heartbeats:e})).length}tZ(new tw("platform-logger",e=>new t$(e),"PRIVATE")),tZ(new tw("heartbeat",e=>new ni(e),"PRIVATE")),t8(tH,tz,""),t8(tH,tz,"esm2017"),t8("fire-js",""),t8("firebase","11.9.0","app");var nl="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==U?U:"undefined"!=typeof self?self:{},nh={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}var t=function(){this.blockSize=-1};function n(){}function r(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+0xd76aa478|0;o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[1]+0xe8c7b756|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[2]+0x242070db|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[3]+0xc1bdceee|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[4]+0xf57c0faf|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[5]+0x4787c62a|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[6]+0xa8304613|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[7]+0xfd469501|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[8]+0x698098d8|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[9]+0x8b44f7af|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[10]+0xffff5bb1|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[11]+0x895cd7be|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[12]+0x6b901122|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[13]+0xfd987193|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[14]+0xa679438e|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(o<<22|o>>>10),o=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,o=t+((n=i+(o<<20|o>>>12))^i^s)+r[5]+0xfffa3942|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[8]+0x8771f681|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[11]+0x6d9d6122|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[14]+0xfde5380c|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[1]+0xa4beea44|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[4]+0x4bdecfa9|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[7]+0xf6bb4b60|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[10]+0xbebfbc70|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[13]+0x289b7ec6|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[0]+0xeaa127fa|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[3]+0xd4ef3085|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[6]+0x4881d05|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[9]+0xd9d4d039|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[12]+0xe6db99e5|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[15]+0x1fa27cf8|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(o<<23|o>>>9),o=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(o<<21|o>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)},e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,i=this.B,s=this.h,o=0;o<t;){if(0==s)for(;o<=n;)r(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){r(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var s,o={};function a(e){var t;return -128<=e&&128>e?(t=function(e){return new i([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(o,e)?o[e]:o[e]=t(e)):new i([0|e],0>e?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return h;if(0>e)return p(l(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new i(t,0)}var h=a(0),u=a(1),c=a(0x1000000);function d(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function p(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(u)}function g(e,t){return e.add(p(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function v(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(h,h);if(f(e))return t=v(p(e),t),new y(p(t.g),p(t.h));if(f(t))return t=v(e,p(t)),new y(p(t.g),t.h);if(30<e.g.length){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,r=t;0>=r.l(e);)n=w(n),r=w(r);var i=b(n,1),s=b(r,1);for(r=b(r,2),n=b(n,2);!d(r);){var o=s.add(r);0>=o.l(e)&&(i=i.add(n),s=o),r=b(r,1),n=b(n,1)}return t=g(e,i.j(t)),new y(i,t)}for(i=h;0<=e.l(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,r-48),o=(s=l(n)).j(t);f(o)||0<o.l(e);)n-=r,o=(s=l(n)).j(t);d(s)&&(s=u),i=i.add(s),e=g(e,o)}return new y(i,e)}function w(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function b(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,s=[],o=0;o<r;o++)s[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new i(s,e.h)}(s=i.prototype).m=function(){if(f(this))return-p(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:0x100000000+r)*t,t*=0x100000000}return e},s.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+p(this).toString(e);for(var t=l(Math.pow(e,6)),n=this,r="";;){var i=v(n,t).g,s=((0<(n=g(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(d(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},s.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return f(e=g(this,e))?-1:+!d(e)},s.abs=function(){return f(this)?p(this):this},s.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,s=0;s<=t;s++){var o=r+(65535&this.i(s))+(65535&e.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new i(n,-0x80000000&n[n.length-1]?-1:0)},s.j=function(e){if(d(this)||d(e))return h;if(f(this))return f(e)?p(this).j(p(e)):p(p(this).j(e));if(f(e))return p(this.j(p(e)));if(0>this.l(c)&&0>e.l(c))return l(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var o=this.i(r)>>>16,a=65535&this.i(r),u=e.i(s)>>>16,g=65535&e.i(s);n[2*r+2*s]+=a*g,m(n,2*r+2*s),n[2*r+2*s+1]+=o*g,m(n,2*r+2*s+1),n[2*r+2*s+1]+=a*u,m(n,2*r+2*s+1),n[2*r+2*s+2]+=o*u,m(n,2*r+2*s+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new i(n,0)},s.A=function(e){return v(this,e).h},s.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},s.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},s.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,nh.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.A,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=l,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return p(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=l(Math.pow(n,8)),i=h,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=l(Math.pow(n,o)),i=i.j(o).add(l(a))):i=(i=i.j(r)).add(l(a))}return i},_=nh.Integer=i}).apply(void 0!==nl?nl:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var nu="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==U?U:"undefined"!=typeof self?self:{},nc={};(function(){var e,t,n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof nu&&nu];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var n=i;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in n))break e;n=n[o]}(t=t(s=n[e=e[e.length-1]]))!=s&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,n,r,i;return e=this,t=function(e,t){return t},e instanceof String&&(e+=""),n=0,r=!1,(i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return i},i}});var s=s||{},o=this||self;function a(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function l(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function h(e,t,n){return e.call.apply(e.bind,arguments)}function u(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function c(e,t,n){return(c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?h:u).apply(null,arguments)}function d(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function f(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function p(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function g(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(a(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function m(e){return/^[\s\xa0]*$/.test(e)}function y(){var e=o.navigator;return e&&(e=e.userAgent)?e:""}function _(e){return _[" "](e),e}_[" "]=function(){};var S=-1!=y().indexOf("Gecko")&&(-1==y().toLowerCase().indexOf("webkit")||-1!=y().indexOf("Edge"))&&-1==y().indexOf("Trident")&&-1==y().indexOf("MSIE")&&-1==y().indexOf("Edge");function k(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function A(e){let t={};for(let n in e)t[n]=e[n];return t}let N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function R(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<N.length;t++)n=N[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}var P=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new D,e=>e.reset());class D{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let O,L=!1,M=new class{constructor(){this.h=this.g=null}add(e,t){let n=P.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},F=()=>{let e=o.Promise.resolve(void 0);O=()=>{e.then(U)}};var U=()=>{let e;for(var t;e=null,M.g&&(e=M.g,M.g=M.g.next,M.g||(M.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){o.setTimeout(()=>{throw e},0)}(e)}P.j(t),100>P.h&&(P.h++,t.next=P.g,P.g=t)}L=!1};function B(){this.s=this.s,this.C=this.C}function j(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}B.prototype.s=!1,B.prototype.ma=function(){this.s||(this.s=!0,this.N())},B.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},j.prototype.h=function(){this.defaultPrevented=!0};var V=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};o.addEventListener("test",e,t),o.removeEventListener("test",e,t)}catch(e){}return e}();function q(e,t){if(j.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(S){e:{try{_(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:$[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&q.aa.h.call(this)}}f(q,j);var $={2:"touch",3:"pen",4:"mouse"};q.prototype.h=function(){q.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var H="closure_listenable_"+(1e6*Math.random()|0),z=0;function W(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++z,this.da=this.fa=!1}function K(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function G(e){this.src=e,this.g={},this.h=0}function Y(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(K(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Q(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}G.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Q(e,t,r,i);return -1<o?(t=e[o],n||(t.fa=!1)):((t=new W(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var X="closure_lm_"+(1e6*Math.random()|0),J={};function Z(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=l(i)?!!i.capture:!!i,a=er(e);if(a||(e[X]=a=new G(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function e(t){return en.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)V||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(et(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function ee(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[H])Y(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(et(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=er(t))?(Y(n,e),0==n.h&&(n.src=null,t[X]=null)):K(e)}}}function et(e){return e in J?J[e]:J[e]="on"+e}function en(e,t){if(e.da)e=!0;else{t=new q(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&ee(e),e=n.call(r,t)}return e}function er(e){return(e=e[X])instanceof G?e:null}var ei="__closure_events_fn_"+(1e9*Math.random()>>>0);function es(e){return"function"==typeof e?e:(e[ei]||(e[ei]=function(t){return e.handleEvent(t)}),e[ei])}function eo(){B.call(this),this.i=new G(this),this.M=this,this.F=null}function ea(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new j(t,e);else if(t instanceof j)t.target=t.target||e;else{var i=t;R(t=new j(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=el(o,r,!0,t)&&i}if(i=el(o=t.g=e,r,!0,t)&&i,i=el(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=el(o=t.g=n[s],r,!1,t)&&i}function el(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.da&&o.capture==n){var a=o.listener,l=o.ha||o.src;o.fa&&Y(e.i,o),i=!1!==a.call(l,r)&&i}}return i&&!r.defaultPrevented}function eh(e,t,n){if("function"==typeof e)n&&(e=c(e,n));else if(e&&"function"==typeof e.handleEvent)e=c(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:o.setTimeout(e,t||0)}f(eo,B),eo.prototype[H]=!0,eo.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);else(i=l(i)?!!i.capture:!!i,r=es(r),t&&t[H])?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=Q(o=t.g[n],r,i,s))&&(K(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete t.g[n],t.h--))):t&&(t=er(t))&&(n=t.g[n.toString()],t=-1,n&&(t=Q(n,r,i,s)),(r=-1<t?n[t]:null)&&ee(r))}(this,e,t,n,r)},eo.prototype.N=function(){if(eo.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)K(n[r]);delete t.g[e],t.h--}}this.F=null},eo.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},eo.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class eu extends B{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eh(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ec(e){B.call(this),this.h=e,this.g={}}f(ec,B);var ed=[];function ef(e){k(e.g,function(e,t){this.g.hasOwnProperty(t)&&ee(e)},e),e.g={}}ec.prototype.N=function(){ec.aa.N.call(this),ef(this)},ec.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ep=o.JSON.stringify,eg=o.JSON.parse,em=class{stringify(e){return o.JSON.stringify(e,void 0)}parse(e){return o.JSON.parse(e,void 0)}};function ey(){}function e_(e){return e.h||(e.h=e.i())}function ev(){}ey.prototype.h=null;var ew={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eb(){j.call(this,"d")}function eE(){j.call(this,"c")}f(eb,j),f(eE,j);var eC={},eT=null;function eI(){return eT=eT||new eo}function ex(e){j.call(this,eC.La,e)}function eS(e){let t=eI();ea(t,new ex(t))}function ek(e,t){j.call(this,eC.STAT_EVENT,e),this.stat=t}function eA(e){let t=eI();ea(t,new ek(t,e))}function eN(e,t){j.call(this,eC.Ma,e),this.size=t}function eR(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){e()},t)}function eP(){this.g=!0}function eD(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}}return ep(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}eC.La="serverreachability",f(ex,j),eC.STAT_EVENT="statevent",f(ek,j),eC.Ma="timingevent",f(eN,j),eP.prototype.xa=function(){this.g=!1},eP.prototype.info=function(){};var eO={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eL={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eM(){}function eF(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ec(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new eU}function eU(){this.i=null,this.g="",this.h=!1}f(eM,ey),eM.prototype.g=function(){return new XMLHttpRequest},eM.prototype.i=function(){return{}},t=new eM;var eB={},ej={};function eV(e,t,n){e.L=1,e.v=tn(e8(t)),e.m=n,e.P=!0,eq(e,null)}function eq(e,t){e.F=Date.now(),eH(e),e.A=e8(e.v);var n,r,i,s,o,a,h=e.A,u=e.R;Array.isArray(u)||(u=[String(u)]),tg(h.i,"t",u),e.C=0,h=e.j.J,e.h=new eU,e.g=t1(e.j,h?t:null,!e.m),0<e.O&&(e.M=new eu(c(e.Y,e,e.g),e.O)),t=e.U,h=e.g,u=e.ca;var d="readystatechange";Array.isArray(d)||(d&&(ed[0]=d.toString()),d=ed);for(var f=0;f<d.length;f++){var p=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=es(r),t&&t[H]?t.L(n,r,l(i)?!!i.capture:!!i,s):Z(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=es(r),t&&t[H]?t.K(n,r,l(i)?!!i.capture:!!i,s):Z(t,n,r,!1,i,s)}(h,d[f],u||t.handleEvent,!1,t.h||t);if(!p)break;t.g[p.key]=p}t=e.H?A(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),eS(),n=e.i,r=e.u,i=e.A,s=e.l,o=e.R,a=e.m,n.info(function(){if(n.g)if(a)for(var e="",t=a.split("&"),l=0;l<t.length;l++){var h=t[l].split("=");if(1<h.length){var u=h[0];h=h[1];var c=u.split("_");e=2<=c.length&&"type"==c[1]?e+(u+"=")+h+"&":e+(u+"=redacted&")}}else e=null;else e=a;return"XMLHTTP REQ ("+s+") [attempt "+o+"]: "+r+"\n"+i+"\n"+e})}function e$(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function eH(e){e.S=Date.now()+e.I,ez(e,e.I)}function ez(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eR(c(e.ba,e),t)}function eW(e){e.B&&(o.clearTimeout(e.B),e.B=null)}function eK(e){0==e.j.G||e.J||tQ(e.j,e)}function eG(e){eW(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ef(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eY(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||e0(n.h,e))){if(!e.K&&e0(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)tY(n),tB(n);else break e;tW(n),eA(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=eR(c(n.Za,n),6e3));if(1>=eZ(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else tJ(n,11)}else if((e.K||n.g==e)&&tY(n),!m(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let a=i[t];if(n.T=a[0],a=a[1],2==n.G)if("c"==a[0]){n.K=a[1],n.ia=a[2];let t=a[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));let i=a[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));let l=a[5];null!=l&&"number"==typeof l&&0<l&&(n.L=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(e1(s,s.h),s.h=null))}if(r.D){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,tt(r.I,r.D,e))}}if(n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms")),(r=n).qa=t0(r,r.J?r.ia:null,r.W),e.K){e2(r.h,e);var o=r.L;o&&(e.I=o),e.B&&(eW(e),eH(e)),r.g=e}else tz(r);0<n.i.length&&tV(n)}else"stop"!=a[0]&&"close"!=a[0]||tJ(n,7);else 3==n.G&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?tJ(n,7):tU(n):"noop"!=a[0]&&n.l&&n.l.ta(a),n.v=0)}}eS(4)}catch(e){}}eF.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tO(e)?t.j():this.Y(e)},eF.prototype.Y=function(e){try{if(e==this.g)e:{let v=tO(this.g);var t=this.g.Ba();let w=this.g.Z();if(!(3>v)&&(3!=v||this.g&&(this.h.h||this.g.oa()||tL(this.g)))){this.J||4!=v||7==t||(8==t||0>=w?eS(3):eS(2)),eW(this);var n=this.g.Z();this.X=n;t:if(e$(this)){var r=tL(this.g);e="";var i=r.length,s=4==tO(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eG(this),eK(this);var a="";break t}this.h.i=new o.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,l=this.i,h=this.u,u=this.A,c=this.l,d=this.R,f=n,l.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+d+"]: "+h+"\n"+u+"\n"+v+" "+f}),this.o){if(this.T&&!this.K){t:{if(this.g){var l,h,u,c,d,f,p,g=this.g;if((p=g.g?g.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(p)){var y=p;break t}}y=null}if(n=y)eD(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eY(this,n);else{this.o=!1,this.s=3,eA(12),eG(this),eK(this);break e}}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;)if((e=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?ej:isNaN(n=Number(t.substring(n,r)))?eB:(r+=1)+n>t.length?ej:(t=t.slice(r,r+n),e.C=r+n,t)}(this,a))==ej){4==v&&(this.s=4,eA(14),n=!1),eD(this.i,this.l,null,"[Incomplete Response]");break}else if(e==eB){this.s=4,eA(15),eD(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}else eD(this.i,this.l,e,null),eY(this,e);if(e$(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=v||0!=a.length||this.h.h||(this.s=1,eA(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var _=this.j;_.g==this&&_.ba&&!_.M&&(_.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),tK(_),_.M=!0,eA(11))}}else eD(this.i,this.l,a,"[Invalid Chunked Response]"),eG(this),eK(this)}else eD(this.i,this.l,a,null),eY(this,a);4==v&&eG(this),this.o&&!this.J&&(4==v?tQ(this.j,this):(this.o=!1,eH(this)))}else(function(e){let t={};e=(e.g&&2<=tO(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(m(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,eA(12)):(this.s=0,eA(13)),eG(this),eK(this)}}}catch(e){}finally{}},eF.prototype.cancel=function(){this.J=!0,eG(this)},eF.prototype.ba=function(){var e,t;this.B=null;let n=Date.now();0<=n-this.S?(e=this.i,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(eS(),eA(17)),eG(this),this.s=2,eK(this)):ez(this,this.S-n)};var eQ=class{constructor(e,t){this.g=e,this.map=t}};function eX(e){this.l=e||10,e=o.PerformanceNavigationTiming?0<(e=o.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function eJ(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eZ(e){return e.h?1:e.g?e.g.size:0}function e0(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function e1(e,t){e.g?e.g.add(t):e.h=t}function e2(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e6(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return p(e.i)}function e3(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(a(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(a(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(a(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}eX.prototype.cancel=function(){if(this.i=e6(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e5=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e4(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof e4){this.h=e.h,e7(this,e.j),this.o=e.o,this.g=e.g,e9(this,e.s),this.l=e.l;var t=e.i,n=new tc;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),te(this,n),this.m=e.m}else e&&(t=String(e).match(e5))?(this.h=!1,e7(this,t[1]||"",!0),this.o=tr(t[2]||""),this.g=tr(t[3]||"",!0),e9(this,t[4]),this.l=tr(t[5]||"",!0),te(this,t[6]||"",!0),this.m=tr(t[7]||"")):(this.h=!1,this.i=new tc(null,this.h))}function e8(e){return new e4(e)}function e7(e,t,n){e.j=n?tr(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e9(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function te(e,t,n){var r,i;t instanceof tc?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(td(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tf(this,t),tg(this,n,e))},r)),r.j=i):(n||(t=ti(t,th)),e.i=new tc(t,e.h))}function tt(e,t,n){e.i.set(t,n)}function tn(e){return tt(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function tr(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ti(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ts),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ts(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e4.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ti(t,to,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ti(t,to,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ti(n,"/"==n.charAt(0)?tl:ta,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ti(n,tu)),e.join("")};var to=/[#\/\?@]/g,ta=/[#\?:]/g,tl=/[#\?]/g,th=/[#\?@]/g,tu=/#/g;function tc(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function td(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tf(e,t){td(e),t=tm(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tp(e,t){return td(e),t=tm(e,t),e.g.has(t)}function tg(e,t,n){tf(e,t),0<n.length&&(e.i=null,e.g.set(tm(e,t),p(n)),e.h+=n.length)}function tm(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function ty(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function t_(){this.g=new em}function tv(e){this.l=e.Ub||null,this.j=e.eb||!1}function tw(e,t){eo.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function tb(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tE(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tC(e)}function tC(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tT(e){let t="";return k(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tI(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tT(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tt(e,t,n))}function tx(e){eo.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(n=tc.prototype).add=function(e,t){td(this),this.i=null,e=tm(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},n.forEach=function(e,t){td(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},n.na=function(){td(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},n.V=function(e){td(this);let t=[];if("string"==typeof e)tp(this,e)&&(t=t.concat(this.g.get(tm(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},n.set=function(e,t){return td(this),this.i=null,tp(this,e=tm(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},n.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")},f(tv,ey),tv.prototype.g=function(){return new tw(this.l,this.j)},tv.prototype.i=(e={},function(){return e}),f(tw,eo),(n=tw.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tC(this)},n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||o).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tE(this)),this.readyState=0},n.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tC(this)),this.g&&(this.readyState=3,tC(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==o.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tb(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},n.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tE(this):tC(this),3==this.readyState&&tb(this)}},n.Ra=function(e){this.g&&(this.response=this.responseText=e,tE(this))},n.Qa=function(e){this.g&&(this.response=e,tE(this))},n.ga=function(){this.g&&tE(this)},n.setRequestHeader=function(e,t){this.u.append(e,t)},n.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tw.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),f(tx,eo);var tS=/^https?$/i,tk=["POST","PUT"];function tA(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tN(e),tP(e)}function tN(e){e.A||(e.A=!0,ea(e,"complete"),ea(e,"error"))}function tR(e){if(e.h&&void 0!==s&&(!e.v[1]||4!=tO(e)||2!=e.Z())){if(e.u&&4==tO(e))eh(e.Ea,0,e);else if(ea(e,"readystatechange"),4==tO(e)){e.h=!1;try{let s=e.Z();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){var i=String(e.D).match(e5)[1]||null;!i&&o.self&&o.self.location&&(i=o.self.location.protocol.slice(0,-1)),n=!tS.test(i?i.toLowerCase():"")}t=n}if(t)ea(e,"complete"),ea(e,"success");else{e.m=6;try{var a=2<tO(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",tN(e)}}finally{tP(e)}}}}function tP(e,t){if(e.g){tD(e);let n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||ea(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function tD(e){e.I&&(o.clearTimeout(e.I),e.I=null)}function tO(e){return e.g?e.g.readyState:0}function tL(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tM(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tF(e){this.Aa=0,this.i=[],this.j=new eP,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tM("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tM("baseRetryDelayMs",5e3,e),this.cb=tM("retryDelaySeedMs",1e4,e),this.Wa=tM("forwardChannelMaxRetries",2,e),this.wa=tM("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new eX(e&&e.concurrentRequestLimit),this.Da=new t_,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tU(e){if(tj(e),3==e.G){var t=e.U++,n=e8(e.I);if(tt(n,"SID",e.K),tt(n,"RID",t),tt(n,"TYPE","terminate"),t$(e,n),(t=new eF(e,e.j,t)).L=2,t.v=tn(e8(n)),n=!1,o.navigator&&o.navigator.sendBeacon)try{n=o.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&o.Image&&((new Image).src=t.v,n=!0),n||(t.g=t1(t.j,null),t.g.ea(t.v)),t.F=Date.now(),eH(t)}tZ(e)}function tB(e){e.g&&(tK(e),e.g.cancel(),e.g=null)}function tj(e){tB(e),e.u&&(o.clearTimeout(e.u),e.u=null),tY(e),e.h.cancel(),e.s&&("number"==typeof e.s&&o.clearTimeout(e.s),e.s=null)}function tV(e){if(!eJ(e.h)&&!e.s){e.s=!0;var t=e.Ga;O||F(),L||(O(),L=!0),M.add(t,e),e.B=0}}function tq(e,t){var n;n=t?t.l:e.U++;let r=e8(e.I);tt(r,"SID",e.K),tt(r,"RID",n),tt(r,"AID",e.T),t$(e,r),e.m&&e.o&&tI(r,e.m,e.o),n=new eF(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tH(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),e1(e.h,n),eV(n,r,t)}function t$(e,t){e.H&&k(e.H,function(e,n){tt(t,n,e)}),e.l&&e3({},function(e,n){tt(t,n,e)})}function tH(e,t,n){n=Math.min(e.i.length,n);var r=e.l?c(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g,a=i[o].map;if(0>(n-=t))t=Math.max(0,i[o].g-100),s=!1;else try{!function(e,t,n){let r=n||"";try{e3(e,function(e,n){let i=e;l(e)&&(i=ep(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return t.D=e=e.i.splice(0,n),r}function tz(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;O||F(),L||(O(),L=!0),M.add(t,e),e.v=0}}function tW(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=eR(c(e.Fa,e),tX(e,e.v)),e.v++,!0)}function tK(e){null!=e.A&&(o.clearTimeout(e.A),e.A=null)}function tG(e){e.g=new eF(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=e8(e.qa);tt(t,"RID","rpc"),tt(t,"SID",e.K),tt(t,"AID",e.T),tt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&tt(t,"TO",e.ja),tt(t,"TYPE","xmlhttp"),t$(e,t),e.m&&e.o&&tI(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=tn(e8(t)),n.m=null,n.P=!0,eq(n,e)}function tY(e){null!=e.C&&(o.clearTimeout(e.C),e.C=null)}function tQ(e,t){var n,r=null;if(e.g==t){tY(e),tK(e),e.g=null;var i=2}else{if(!e0(e.h,t))return;r=t.D,e2(e.h,t),i=1}if(0!=e.G){if(t.o)if(1==i){r=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;ea(i=eI(),new eN(i,r)),tV(e)}else tz(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==i&&(n=t,!(eZ(e.h)>=e.h.j-!!e.s)&&(e.s?(e.i=n.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=eR(c(e.Ga,e,n),tX(e,e.B)),e.B++,!0)))||2==i&&tW(e)))switch(r&&0<r.length&&((t=e.h).i=t.i.concat(r)),s){case 1:tJ(e,5);break;case 4:tJ(e,10);break;case 3:tJ(e,6);break;default:tJ(e,2)}}}function tX(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function tJ(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.fb,e),r=e.Xa;let t=!r;r=new e4(r||"//www.google.com/images/cleardot.gif"),o.location&&"http"==o.location.protocol||e7(r,"https"),tn(r),t?function(e,t){let n=new eP;if(o.Image){let r=new Image;r.onload=d(ty,n,"TestLoadImage: loaded",!0,t,r),r.onerror=d(ty,n,"TestLoadImage: error",!1,t,r),r.onabort=d(ty,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=d(ty,n,"TestLoadImage: timeout",!1,t,r),o.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){let n=new eP,r=new AbortController,i=setTimeout(()=>{r.abort(),ty(n,"TestPingServer: timeout",!1,t)},1e4);fetch(e,{signal:r.signal}).then(e=>{clearTimeout(i),e.ok?ty(n,"TestPingServer: ok",!0,t):ty(n,"TestPingServer: server error",!1,t)}).catch(()=>{clearTimeout(i),ty(n,"TestPingServer: error",!1,t)})}(r.toString(),n)}else eA(2);e.G=0,e.l&&e.l.sa(t),tZ(e),tj(e)}function tZ(e){if(e.G=0,e.ka=[],e.l){let t=e6(e.h);(0!=t.length||0!=e.i.length)&&(g(e.ka,t),g(e.ka,e.i),e.h.i.length=0,p(e.i),e.i.length=0),e.l.ra()}}function t0(e,t,n){var r=n instanceof e4?e8(n):new e4(n);if(""!=r.g)t&&(r.g=t+"."+r.g),e9(r,r.s);else{var i=o.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new e4(null);r&&e7(s,r),t&&(s.g=t),i&&e9(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&tt(r,n,t),tt(r,"VER",e.la),t$(e,r),r}function t1(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tx(e.Ca&&!e.pa?new tv({eb:n}):e.pa)).Ha(e.J),t}function t2(){}function t6(){}function t3(e,t){eo.call(this),this.g=new tF(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!m(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!m(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t8(this)}function t5(e){eb.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t4(){eE.call(this),this.status=1}function t8(e){this.g=e}(n=tx.prototype).Ha=function(e){this.J=e},n.ea=function(e,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);n=n?n.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():t.g(),this.v=this.o?e_(this.o):e_(t),this.g.onreadystatechange=c(this.Ea,this);try{this.B=!0,this.g.open(n,String(e),!0),this.B=!1}catch(e){tA(this,e);return}if(e=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[t,a]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=o.FormData&&e instanceof o.FormData,!(0<=Array.prototype.indexOf.call(tk,n,void 0))||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(t,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tD(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tA(this,e)}},n.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,ea(this,"complete"),ea(this,"abort"),tP(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tP(this,!0)),tx.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?tR(this):this.bb())},n.bb=function(){tR(this)},n.isActive=function(){return!!this.g},n.Z=function(){try{return 2<tO(this)?this.g.status:-1}catch(e){return -1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},n.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eg(t)}},n.Ba=function(){return this.m},n.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(n=tF.prototype).la=8,n.G=1,n.connect=function(e,t,n,r){eA(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=t0(this,null,this.W),tV(this)},n.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let i=new eF(this,this.j,e),s=this.o;if(this.S&&(s?R(s=A(s),this.S):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tH(this,i,t),tt(n=e8(this.I),"RID",e),tt(n,"CVER",22),this.D&&tt(n,"X-HTTP-Session-Id",this.D),t$(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(tT(s)))+"&"+t:this.m&&tI(n,this.m,s)),e1(this.h,i),this.Ua&&tt(n,"TYPE","init"),this.P?(tt(n,"$req",t),tt(n,"SID","null"),i.T=!0,eV(i,n,null)):eV(i,n,t),this.G=2}}else 3==this.G&&(e?tq(this,e):0==this.i.length||eJ(this.h)||tq(this))},n.Fa=function(){if(this.u=null,tG(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=eR(c(this.ab,this),e)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,eA(10),tB(this),tG(this))},n.Za=function(){null!=this.C&&(this.C=null,tB(this),tW(this),eA(19))},n.fb=function(e){e?(this.j.info("Successfully pinged google.com"),eA(2)):(this.j.info("Failed to ping google.com"),eA(1))},n.isActive=function(){return!!this.l&&this.l.isActive(this)},(n=t2.prototype).ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){},t6.prototype.g=function(e,t){return new t3(e,t)},f(t3,eo),t3.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t3.prototype.close=function(){tU(this.g)},t3.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ep(e),e=n);t.i.push(new eQ(t.Ya++,e)),3==t.G&&tV(t)},t3.prototype.N=function(){this.g.l=null,delete this.j,tU(this.g),delete this.g,t3.aa.N.call(this)},f(t5,eb),f(t4,eE),f(t8,t2),t8.prototype.ua=function(){ea(this.g,"a")},t8.prototype.ta=function(e){ea(this.g,new t5(e))},t8.prototype.sa=function(e){ea(this.g,new t4)},t8.prototype.ra=function(){ea(this.g,"b")},t6.prototype.createWebChannel=t6.prototype.g,t3.prototype.send=t3.prototype.o,t3.prototype.open=t3.prototype.m,t3.prototype.close=t3.prototype.close,x=nc.createWebChannelTransport=function(){return new t6},I=nc.getStatEventTarget=function(){return eI()},T=nc.Event=eC,C=nc.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eO.NO_ERROR=0,eO.TIMEOUT=8,eO.HTTP_ERROR=6,E=nc.ErrorCode=eO,eL.COMPLETE="complete",b=nc.EventType=eL,ev.EventType=ew,ew.OPEN="a",ew.CLOSE="b",ew.ERROR="c",ew.MESSAGE="d",eo.prototype.listen=eo.prototype.K,w=nc.WebChannel=ev,nc.FetchXmlHttpFactory=tv,tx.prototype.listenOnce=tx.prototype.L,tx.prototype.getLastError=tx.prototype.Ka,tx.prototype.getLastErrorCode=tx.prototype.Ba,tx.prototype.getStatus=tx.prototype.Z,tx.prototype.getResponseJson=tx.prototype.Oa,tx.prototype.getResponseText=tx.prototype.oa,tx.prototype.send=tx.prototype.ea,tx.prototype.setWithCredentials=tx.prototype.Ha,v=nc.XhrIo=tx}).apply(void 0!==nu?nu:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),S=function(e){for(var t,n=e.length,r=n%3,i=[],s=0,o=n-r;s<o;s+=16383)i.push(function(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&0xff0000)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(nd[r>>18&63]+nd[r>>12&63]+nd[r>>6&63]+nd[63&r]);return i.join("")}(e,s,s+16383>o?o:s+16383));return 1===r?i.push(nd[(t=e[n-1])>>2]+nd[t<<4&63]+"=="):2===r&&i.push(nd[(t=(e[n-2]<<8)+e[n-1])>>10]+nd[t>>4&63]+nd[t<<2&63]+"="),i.join("")};for(var nd=[],nf=[],np="undefined"!=typeof Uint8Array?Uint8Array:Array,ng="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",nm=0,ny=ng.length;nm<ny;++nm)nd[nm]=ng[nm],nf[ng.charCodeAt(nm)]=nm;nf[45]=62,nf[95]=63,k=function(e,t,n,r,i){var s,o,a=8*i-r-1,l=(1<<a)-1,h=l>>1,u=-7,c=n?i-1:0,d=n?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+e[t+c],c+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=256*o+e[t+c],c+=d,u-=8);if(0===s)s=1-h;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=h}return(f?-1:1)*o*Math.pow(2,s-r)},A=function(e,t,n,r,i,s){var o,a,l,h=8*s-i-1,u=(1<<h)-1,c=u>>1,d=5960464477539062e-23*(23===i),f=r?0:s-1,p=r?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(a=+!!isNaN(t),o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(o++,l/=2),o+c>=u?(a=0,o=u):o+c>=1?(a=(t*l-1)*Math.pow(2,i),o+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;e[n+f]=255&o,f+=p,o/=256,h-=8);e[n+f-p]|=128*g};const n_="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function nv(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,nw.prototype),t}function nw(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return nC(e)}return nb(e,t,n)}function nb(e,t,n){if("string"==typeof e){var r=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!nw.isEncoding(i))throw TypeError("Unknown encoding: "+i);let n=0|nS(r,i),s=nv(n),o=s.write(r,i);return o!==n&&(s=s.slice(0,o)),s}if(ArrayBuffer.isView(e)){var s=e;if(nQ(s,Uint8Array)){let e=new Uint8Array(s);return nI(e.buffer,e.byteOffset,e.byteLength)}return nT(s)}if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(nQ(e,ArrayBuffer)||e&&nQ(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(nQ(e,SharedArrayBuffer)||e&&nQ(e.buffer,SharedArrayBuffer)))return nI(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let o=e.valueOf&&e.valueOf();if(null!=o&&o!==e)return nw.from(o,t,n);let a=function(e){if(nw.isBuffer(e)){let t=0|nx(e.length),n=nv(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?nv(0):nT(e):"Buffer"===e.type&&Array.isArray(e.data)?nT(e.data):void 0}(e);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return nw.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function nE(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function nC(e){return nE(e),nv(e<0?0:0|nx(e))}function nT(e){let t=e.length<0?0:0|nx(e.length),n=nv(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function nI(e,t,n){let r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),nw.prototype),r}function nx(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function nS(e,t){if(nw.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||nQ(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return nK(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return nG(e).length;default:if(i)return r?-1:nK(e).length;t=(""+t).toLowerCase(),i=!0}}function nk(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){let r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let r=t;r<n;++r)i+=nX[e[r]];return i}(this,t,n);case"utf8":case"utf-8":return nP(this,t,n);case"ascii":return function(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,n);case"latin1":case"binary":return function(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}(this,t,n);case"base64":var i,s,o;return i=this,s=t,o=n,0===s&&o===i.length?S(i):S(i.slice(s,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){let r=e.slice(t,n),i="";for(let e=0;e<r.length-1;e+=2)i+=String.fromCharCode(r[e]+256*r[e+1]);return i}(this,t,n);default:if(r)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function nA(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function nN(e,t,n,r,i){var s;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(i)return -1;else n=e.length-1;else if(n<0)if(!i)return -1;else n=0;if("string"==typeof t&&(t=nw.from(t,r)),nw.isBuffer(t))return 0===t.length?-1:nR(e,t,n,r,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return nR(e,[t],n,r,i)}throw TypeError("val must be string, number or Buffer")}function nR(e,t,n,r,i){let s,o=1,a=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;o=2,a/=2,l/=2,n/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let r=-1;for(s=n;s<a;s++)if(h(e,s)===h(t,-1===r?0:s-r)){if(-1===r&&(r=s),s-r+1===l)return r*o}else -1!==r&&(s-=s-r),r=-1}else for(n+l>a&&(n=a-l),s=n;s>=0;s--){let n=!0;for(let r=0;r<l;r++)if(h(e,s+r)!==h(t,r)){n=!1;break}if(n)return s}return -1}function nP(e,t,n){n=Math.min(e.length,n);let r=[],i=t;for(;i<n;){let t=e[i],s=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=n){let n,r,a,l;switch(o){case 1:t<128&&(s=t);break;case 2:(192&(n=e[i+1]))==128&&(l=(31&t)<<6|63&n)>127&&(s=l);break;case 3:n=e[i+1],r=e[i+2],(192&n)==128&&(192&r)==128&&(l=(15&t)<<12|(63&n)<<6|63&r)>2047&&(l<55296||l>57343)&&(s=l);break;case 4:n=e[i+1],r=e[i+2],a=e[i+3],(192&n)==128&&(192&r)==128&&(192&a)==128&&(l=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&a)>65535&&l<1114112&&(s=l)}}null===s?(s=65533,o=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=o}var s=r;let o=s.length;if(o<=4096)return String.fromCharCode.apply(String,s);let a="",l=0;for(;l<o;)a+=String.fromCharCode.apply(String,s.slice(l,l+=4096));return a}function nD(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function nO(e,t,n,r,i,s){if(!nw.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function nL(e,t,n,r,i){n$(t,r,i,e,n,7);let s=Number(t&BigInt(0xffffffff));e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s;let o=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function nM(e,t,n,r,i){n$(t,r,i,e,n,7);let s=Number(t&BigInt(0xffffffff));e[n+7]=s,s>>=8,e[n+6]=s,s>>=8,e[n+5]=s,s>>=8,e[n+4]=s;let o=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function nF(e,t,n,r,i,s){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function nU(e,t,n,r,i){return t*=1,n>>>=0,i||nF(e,t,n,4,34028234663852886e22,-34028234663852886e22),A(e,t,n,r,23,4),n+4}function nB(e,t,n,r,i){return t*=1,n>>>=0,i||nF(e,t,n,8,17976931348623157e292,-17976931348623157e292),A(e,t,n,r,52,8),n+8}nw.TYPED_ARRAY_SUPPORT=function(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),nw.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(nw.prototype,"parent",{enumerable:!0,get:function(){if(nw.isBuffer(this))return this.buffer}}),Object.defineProperty(nw.prototype,"offset",{enumerable:!0,get:function(){if(nw.isBuffer(this))return this.byteOffset}}),nw.poolSize=8192,nw.from=function(e,t,n){return nb(e,t,n)},Object.setPrototypeOf(nw.prototype,Uint8Array.prototype),Object.setPrototypeOf(nw,Uint8Array),nw.alloc=function(e,t,n){return(nE(e),e<=0)?nv(e):void 0!==t?"string"==typeof n?nv(e).fill(t,n):nv(e).fill(t):nv(e)},nw.allocUnsafe=function(e){return nC(e)},nw.allocUnsafeSlow=function(e){return nC(e)},nw.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==nw.prototype},nw.compare=function(e,t){if(nQ(e,Uint8Array)&&(e=nw.from(e,e.offset,e.byteLength)),nQ(t,Uint8Array)&&(t=nw.from(t,t.offset,t.byteLength)),!nw.isBuffer(e)||!nw.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:+(r<n)},nw.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},nw.concat=function(e,t){let n;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return nw.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;let r=nw.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){let t=e[n];if(nQ(t,Uint8Array))i+t.length>r.length?(nw.isBuffer(t)||(t=nw.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else if(nw.isBuffer(t))t.copy(r,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=t.length}return r},nw.byteLength=nS,nw.prototype._isBuffer=!0,nw.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)nA(this,t,t+1);return this},nw.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)nA(this,t,t+3),nA(this,t+1,t+2);return this},nw.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)nA(this,t,t+7),nA(this,t+1,t+6),nA(this,t+2,t+5),nA(this,t+3,t+4);return this},nw.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?nP(this,0,e):nk.apply(this,arguments)},nw.prototype.toLocaleString=nw.prototype.toString,nw.prototype.equals=function(e){if(!nw.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===nw.compare(this,e)},nw.prototype.inspect=function(){let e="";return e=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(e+=" ... "),"<Buffer "+e+">"},n_&&(nw.prototype[n_]=nw.prototype.inspect),nw.prototype.compare=function(e,t,n,r,i){if(nQ(e,Uint8Array)&&(e=nw.from(e,e.offset,e.byteLength)),!nw.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;let s=i-r,o=n-t,a=Math.min(s,o),l=this.slice(r,i),h=e.slice(t,n);for(let e=0;e<a;++e)if(l[e]!==h[e]){s=l[e],o=h[e];break}return s<o?-1:+(o<s)},nw.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},nw.prototype.indexOf=function(e,t,n){return nN(this,e,t,n,!0)},nw.prototype.lastIndexOf=function(e,t,n){return nN(this,e,t,n,!1)},nw.prototype.write=function(e,t,n,r){var i,s,o,a,l,h,u,c;if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let f=!1;for(;;)switch(r){case"hex":return function(e,t,n,r){let i;n=Number(n)||0;let s=e.length-n;r?(r=Number(r))>s&&(r=s):r=s;let o=t.length;for(r>o/2&&(r=o/2),i=0;i<r;++i){var a;let r=parseInt(t.substr(2*i,2),16);if((a=r)!=a)break;e[n+i]=r}return i}(this,e,t,n);case"utf8":case"utf-8":return i=t,s=n,nY(nK(e,this.length-i),this,i,s);case"ascii":case"latin1":case"binary":return o=t,a=n,nY(function(e){let t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(e),this,o,a);case"base64":return l=t,h=n,nY(nG(e),this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,c=n,nY(function(e,t){let n,r,i=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i.push(n%256),i.push(r);return i}(e,this.length-u),this,u,c);default:if(f)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),f=!0}},nw.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},nw.prototype.slice=function(e,t){let n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);let r=this.subarray(e,t);return Object.setPrototypeOf(r,nw.prototype),r},nw.prototype.readUintLE=nw.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||nD(e,t,this.length);let r=this[e],i=1,s=0;for(;++s<t&&(i*=256);)r+=this[e+s]*i;return r},nw.prototype.readUintBE=nw.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||nD(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},nw.prototype.readUint8=nw.prototype.readUInt8=function(e,t){return e>>>=0,t||nD(e,1,this.length),this[e]},nw.prototype.readUint16LE=nw.prototype.readUInt16LE=function(e,t){return e>>>=0,t||nD(e,2,this.length),this[e]|this[e+1]<<8},nw.prototype.readUint16BE=nw.prototype.readUInt16BE=function(e,t){return e>>>=0,t||nD(e,2,this.length),this[e]<<8|this[e+1]},nw.prototype.readUint32LE=nw.prototype.readUInt32LE=function(e,t){return e>>>=0,t||nD(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},nw.prototype.readUint32BE=nw.prototype.readUInt32BE=function(e,t){return e>>>=0,t||nD(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},nw.prototype.readBigUInt64LE=nJ(function(e){nH(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&nz(e,this.length-8);let r=t+256*this[++e]+65536*this[++e]+0x1000000*this[++e],i=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*n;return BigInt(r)+(BigInt(i)<<BigInt(32))}),nw.prototype.readBigUInt64BE=nJ(function(e){nH(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&nz(e,this.length-8);let r=0x1000000*t+65536*this[++e]+256*this[++e]+this[++e],i=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)}),nw.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||nD(e,t,this.length);let r=this[e],i=1,s=0;for(;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},nw.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||nD(e,t,this.length);let r=t,i=1,s=this[e+--r];for(;r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},nw.prototype.readInt8=function(e,t){return(e>>>=0,t||nD(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},nw.prototype.readInt16LE=function(e,t){e>>>=0,t||nD(e,2,this.length);let n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},nw.prototype.readInt16BE=function(e,t){e>>>=0,t||nD(e,2,this.length);let n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},nw.prototype.readInt32LE=function(e,t){return e>>>=0,t||nD(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},nw.prototype.readInt32BE=function(e,t){return e>>>=0,t||nD(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},nw.prototype.readBigInt64LE=nJ(function(e){nH(e>>>=0,"offset");let t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&nz(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+0x1000000*this[++e])}),nw.prototype.readBigInt64BE=nJ(function(e){nH(e>>>=0,"offset");let t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&nz(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n)}),nw.prototype.readFloatLE=function(e,t){return e>>>=0,t||nD(e,4,this.length),k(this,e,!0,23,4)},nw.prototype.readFloatBE=function(e,t){return e>>>=0,t||nD(e,4,this.length),k(this,e,!1,23,4)},nw.prototype.readDoubleLE=function(e,t){return e>>>=0,t||nD(e,8,this.length),k(this,e,!0,52,8)},nw.prototype.readDoubleBE=function(e,t){return e>>>=0,t||nD(e,8,this.length),k(this,e,!1,52,8)},nw.prototype.writeUintLE=nw.prototype.writeUIntLE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){let r=Math.pow(2,8*n)-1;nO(this,e,t,n,r,0)}let i=1,s=0;for(this[t]=255&e;++s<n&&(i*=256);)this[t+s]=e/i&255;return t+n},nw.prototype.writeUintBE=nw.prototype.writeUIntBE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){let r=Math.pow(2,8*n)-1;nO(this,e,t,n,r,0)}let i=n-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+n},nw.prototype.writeUint8=nw.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||nO(this,e,t,1,255,0),this[t]=255&e,t+1},nw.prototype.writeUint16LE=nw.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||nO(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},nw.prototype.writeUint16BE=nw.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||nO(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},nw.prototype.writeUint32LE=nw.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||nO(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},nw.prototype.writeUint32BE=nw.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||nO(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},nw.prototype.writeBigUInt64LE=nJ(function(e,t=0){return nL(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),nw.prototype.writeBigUInt64BE=nJ(function(e,t=0){return nM(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),nw.prototype.writeIntLE=function(e,t,n,r){if(e*=1,t>>>=0,!r){let r=Math.pow(2,8*n-1);nO(this,e,t,n,r-1,-r)}let i=0,s=1,o=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/s|0)-o&255;return t+n},nw.prototype.writeIntBE=function(e,t,n,r){if(e*=1,t>>>=0,!r){let r=Math.pow(2,8*n-1);nO(this,e,t,n,r-1,-r)}let i=n-1,s=1,o=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/s|0)-o&255;return t+n},nw.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||nO(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},nw.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||nO(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},nw.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||nO(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},nw.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||nO(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},nw.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||nO(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},nw.prototype.writeBigInt64LE=nJ(function(e,t=0){return nL(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),nw.prototype.writeBigInt64BE=nJ(function(e,t=0){return nM(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),nw.prototype.writeFloatLE=function(e,t,n){return nU(this,e,t,!0,n)},nw.prototype.writeFloatBE=function(e,t,n){return nU(this,e,t,!1,n)},nw.prototype.writeDoubleLE=function(e,t,n){return nB(this,e,t,!0,n)},nw.prototype.writeDoubleBE=function(e,t,n){return nB(this,e,t,!1,n)},nw.prototype.copy=function(e,t,n,r){if(!nw.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);let i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},nw.prototype.fill=function(e,t,n,r){let i;if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!nw.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){let t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{let s=nw.isBuffer(e)?e:nw.from(e,r),o=s.length;if(0===o)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=s[i%o]}return this};const nj={};function nV(e,t,n){nj[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function nq(e){let t="",n=e.length,r=+("-"===e[0]);for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function n$(e,t,n,r,i,s){if(e>n||e<t){let r,i="bigint"==typeof t?"n":"";throw r=s>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${(s+1)*8}${i}`:`>= -(2${i} ** ${(s+1)*8-1}${i}) and < 2 ** ${(s+1)*8-1}${i}`:`>= ${t}${i} and <= ${n}${i}`,new nj.ERR_OUT_OF_RANGE("value",r,e)}nH(i,"offset"),(void 0===r[i]||void 0===r[i+s])&&nz(i,r.length-(s+1))}function nH(e,t){if("number"!=typeof e)throw new nj.ERR_INVALID_ARG_TYPE(t,"number",e)}function nz(e,t,n){if(Math.floor(e)!==e)throw nH(e,n),new nj.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new nj.ERR_BUFFER_OUT_OF_BOUNDS;throw new nj.ERR_OUT_OF_RANGE(n||"offset",`>= ${+!!n} and <= ${t}`,e)}nV("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),nV("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),nV("ERR_OUT_OF_RANGE",function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>0x100000000?i=nq(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=nq(i)),i+="n"),r+=` It must be ${t}. Received ${i}`},RangeError);const nW=/[^+/0-9A-Za-z-_]/g;function nK(e,t){let n;t=t||1/0;let r=e.length,i=null,s=[];for(let o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319||o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function nG(e){return function(e){var t,n,r=function(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}(e),i=r[0],s=r[1],o=new np((i+s)*3/4-s),a=0,l=s>0?i-4:i;for(n=0;n<l;n+=4)t=nf[e.charCodeAt(n)]<<18|nf[e.charCodeAt(n+1)]<<12|nf[e.charCodeAt(n+2)]<<6|nf[e.charCodeAt(n+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=255&t;return 2===s&&(t=nf[e.charCodeAt(n)]<<2|nf[e.charCodeAt(n+1)]>>4,o[a++]=255&t),1===s&&(t=nf[e.charCodeAt(n)]<<10|nf[e.charCodeAt(n+1)]<<4|nf[e.charCodeAt(n+2)]>>2,o[a++]=t>>8&255,o[a++]=255&t),o}(function(e){if((e=(e=e.split("=")[0]).trim().replace(nW,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function nY(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function nQ(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}const nX=function(){let e="0123456789abcdef",t=Array(256);for(let n=0;n<16;++n){let r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function nJ(e){return"undefined"==typeof BigInt?nZ:e}function nZ(){throw Error("BigInt not supported")}const n0="@firebase/firestore",n1="4.7.17";class n2{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}n2.UNAUTHENTICATED=new n2(null),n2.GOOGLE_CREDENTIALS=new n2("google-credentials-uid"),n2.FIRST_PARTY=new n2("first-party-uid"),n2.MOCK_USER=new n2("mock-user");let n6="11.9.0";const n3=new tA("@firebase/firestore");function n5(){return n3.logLevel}function n4(e,...t){if(n3.logLevel<=y.DEBUG){let n=t.map(n9);n3.debug(`Firestore (${n6}): ${e}`,...n)}}function n8(e,...t){if(n3.logLevel<=y.ERROR){let n=t.map(n9);n3.error(`Firestore (${n6}): ${e}`,...n)}}function n7(e,...t){if(n3.logLevel<=y.WARN){let n=t.map(n9);n3.warn(`Firestore (${n6}): ${e}`,...n)}}function n9(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function re(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,rt(e,r,n)}function rt(e,t,n){let r=`FIRESTORE (${n6}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw n8(r),Error(r)}function rn(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||rt(t,i,r)}const rr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ri extends tt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class rs{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ro{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ra{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(n2.UNAUTHENTICATED))}shutdown(){}}class rl{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class rh{constructor(e){this.t=e,this.currentUser=n2.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){rn(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new rs;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new rs,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{n4("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?o(e):(n4("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new rs)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(n4("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(rn("string"==typeof t.accessToken,31837,{l:t}),new ro(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return rn(null===e||"string"==typeof e,2055,{h:e}),new n2(e)}}class ru{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=n2.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class rc{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new ru(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(n2.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class rd{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rf{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,t1(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){rn(void 0===this.o,3512);let n=e=>{null!=e.error&&n4("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,n4("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{n4("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):n4("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new rd(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(rn("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new rd(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function rp(e,t){return e<t?-1:+(e>t)}function rg(e,t){let n=0;for(;n<e.length&&n<t.length;){let r=e.codePointAt(n),i=t.codePointAt(n);if(r!==i){if(r<128&&i<128)return rp(r,i);{let s=new TextEncoder,o=function(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return rp(e[n],t[n]);return rp(e.length,t.length)}(s.encode(rm(e,n)),s.encode(rm(t,n)));return 0!==o?o:rp(r,i)}}n+=r>65535?2:1}return rp(e.length,t.length)}function rm(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function ry(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class r_{static now(){return r_.fromMillis(Date.now())}static fromDate(e){return r_.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new r_(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new ri(rr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new ri(rr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?rp(this.nanoseconds,e.nanoseconds):rp(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class rv{static fromTimestamp(e){return new rv(e)}static min(){return new rv(new r_(0,0))}static max(){return new rv(new r_(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const rw="__name__";class rb{constructor(e,t,n){void 0===t?t=0:t>e.length&&re(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&re(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===rb.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof rb?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=rb.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return rp(e.length,t.length)}static compareSegments(e,t){let n=rb.isNumericId(e),r=rb.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?rb.extractNumericId(e).compare(rb.extractNumericId(t)):rg(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return _.fromString(e.substring(4,e.length-2))}}class rE extends rb{construct(e,t,n){return new rE(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new ri(rr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new rE(t)}static emptyPath(){return new rE([])}}const rC=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rT extends rb{construct(e,t,n){return new rT(e,t,n)}static isValidIdentifier(e){return rC.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rT.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===rw}static keyField(){return new rT([rw])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new ri(rr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new ri(rr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new ri(rr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new ri(rr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new rT(t)}static emptyPath(){return new rT([])}}class rI{constructor(e){this.path=e}static fromPath(e){return new rI(rE.fromString(e))}static fromName(e){return new rI(rE.fromString(e).popFirst(5))}static empty(){return new rI(rE.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===rE.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return rE.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rI(new rE(e.slice()))}}class rx{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new rx(rv.min(),rI.empty(),-1)}static max(){return new rx(rv.max(),rI.empty(),-1)}}class rS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class rk{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&re(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new rk((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof rk?t:rk.resolve(t)}catch(e){return rk.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):rk.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):rk.reject(t)}static resolve(e){return new rk((t,n)=>{t(e)})}static reject(e){return new rk((t,n)=>{n(e)})}static waitFor(e){return new rk((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=rk.resolve(!1);for(let n of e)t=t.next(e=>e?rk.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new rk((n,r)=>{let i=e.length,s=Array(i),o=0;for(let a=0;a<i;a++){let l=a;t(e[l]).next(e=>{s[l]=e,++o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new rk((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function rA(e){return"IndexedDbTransactionError"===e.name}class rN{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ue(e),this.ce=e=>t.writeSequenceNumber(e))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ce&&this.ce(e),e}}rN.le=-1;function rR(e){return 0===e&&1/e==-1/0}function rP(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function rD(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}class rO{constructor(e,t){this.comparator=e,this.root=t||rM.EMPTY}insert(e,t){return new rO(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,rM.BLACK,null,null))}remove(e){return new rO(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rM.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new rL(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new rL(this.root,e,this.comparator,!1)}getReverseIterator(){return new rL(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new rL(this.root,e,this.comparator,!0)}}class rL{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class rM{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:rM.RED,this.left=null!=r?r:rM.EMPTY,this.right=null!=i?i:rM.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new rM(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return rM.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return rM.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,rM.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,rM.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw re(43730,{key:this.key,value:this.value});if(this.right.isRed())throw re(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw re(27949);return e+ +!this.isRed()}}rM.EMPTY=null,rM.RED=!0,rM.BLACK=!1,rM.EMPTY=new class{constructor(){this.size=0}get key(){throw re(57766)}get value(){throw re(16141)}get color(){throw re(16727)}get left(){throw re(29726)}get right(){throw re(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new rM(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class rF{constructor(e){this.comparator=e,this.data=new rO(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new rU(this.data.getIterator())}getIteratorFrom(e){return new rU(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof rF)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new rF(this.comparator);return t.data=e,t}}class rU{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class rB{constructor(e){this.fields=e,e.sort(rT.comparator)}static empty(){return new rB([])}unionWith(e){let t=new rF(rT.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new rB(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ry(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class rj extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class rV{constructor(e){this.binaryString=e}static fromBase64String(e){return new rV(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new rj("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new rV(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rp(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}rV.EMPTY_BYTE_STRING=new rV("");const rq=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function r$(e){if(rn(!!e,39018),"string"==typeof e){let t=0,n=rq.exec(e);if(rn(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:rH(e.seconds),nanos:rH(e.nanos)}}function rH(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function rz(e){return"string"==typeof e?rV.fromBase64String(e):rV.fromUint8Array(e)}const rW="server_timestamp",rK="__type__",rG="__previous_value__",rY="__local_write_time__";function rQ(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[rK])?void 0:n.stringValue)===rW}function rX(e){let t=r$(e.mapValue.fields[rY].timestampValue);return new r_(t.seconds,t.nanos)}const rJ="(default)";class rZ{constructor(e,t){this.projectId=e,this.database=t||rJ}static empty(){return new rZ("","")}get isDefaultDatabase(){return this.database===rJ}isEqual(e){return e instanceof rZ&&e.projectId===this.projectId&&e.database===this.database}}const r0="__max__",r1={mapValue:{fields:{__type__:{stringValue:r0}}}},r2="value";function r6(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?rQ(e)?4:io(e)?0x1fffffffffffff:ii(e)?10:11:re(28295,{value:e})}function r3(e,t){if(e===t)return!0;let n=r6(e);if(n!==r6(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return rX(e).isEqual(rX(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=r$(e.timestampValue),i=r$(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return rz(e.bytesValue).isEqual(rz(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return rH(e.geoPointValue.latitude)===rH(t.geoPointValue.latitude)&&rH(e.geoPointValue.longitude)===rH(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return rH(e.integerValue)===rH(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=rH(e.doubleValue),r=rH(t.doubleValue);return n===r?rR(n)===rR(r):isNaN(n)&&isNaN(r)}return!1;case 9:return ry(e.arrayValue.values||[],t.arrayValue.values||[],r3);case 10:case 11:let s=e.mapValue.fields||{},o=t.mapValue.fields||{};if(rP(s)!==rP(o))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===o[e]||!r3(s[e],o[e])))return!1;return!0;default:return re(52216,{left:e})}}function r5(e,t){return void 0!==(e.values||[]).find(e=>r3(e,t))}function r4(e,t){if(e===t)return 0;let n=r6(e),r=r6(t);if(n!==r)return rp(n,r);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return rp(e.booleanValue,t.booleanValue);case 2:let i=rH(e.integerValue||e.doubleValue),s=rH(t.integerValue||t.doubleValue);return i<s?-1:i>s?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return r8(e.timestampValue,t.timestampValue);case 4:return r8(rX(e),rX(t));case 5:return rg(e.stringValue,t.stringValue);case 6:return function(e,t){let n=rz(e),r=rz(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=rp(n[e],r[e]);if(0!==t)return t}return rp(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=rp(rH(e.latitude),rH(t.latitude));return 0!==n?n:rp(rH(e.longitude),rH(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return r7(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;let o=e.fields||{},a=t.fields||{},l=null==(n=o[r2])?void 0:n.arrayValue,h=null==(r=a[r2])?void 0:r.arrayValue,u=rp((null==(i=null==l?void 0:l.values)?void 0:i.length)||0,(null==(s=null==h?void 0:h.values)?void 0:s.length)||0);return 0!==u?u:r7(l,h)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===r1.mapValue&&t===r1.mapValue)return 0;if(e===r1.mapValue)return 1;if(t===r1.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=rg(r[e],s[e]);if(0!==t)return t;let o=r4(n[r[e]],i[s[e]]);if(0!==o)return o}return rp(r.length,s.length)}(e.mapValue,t.mapValue);default:throw re(23264,{Pe:n})}}function r8(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return rp(e,t);let n=r$(e),r=r$(t),i=rp(n.seconds,r.seconds);return 0!==i?i:rp(n.nanos,r.nanos)}function r7(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=r4(n[e],r[e]);if(t)return t}return rp(n.length,r.length)}function r9(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=r$(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?rz(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,rI.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=r9(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${r9(e.fields[i])}`;return n+"}"}(e.mapValue):re(61005,{value:e})}function ie(e){return!!e&&"integerValue"in e}function it(e){return!!e&&"arrayValue"in e}function ir(e){return!!e&&"mapValue"in e}function ii(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{}).__type__)?void 0:n.stringValue)==="__vector__"}function is(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return rD(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=is(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=is(e.arrayValue.values[n]);return t}return Object.assign({},e)}function io(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===r0}class ia{constructor(e){this.value=e}static empty(){return new ia({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!ir(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=is(t)}setAll(e){let t=rT.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=is(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());ir(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return r3(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];ir(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(rD(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new ia(is(this.value))}}class il{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new il(e,0,rv.min(),rv.min(),rv.min(),ia.empty(),0)}static newFoundDocument(e,t,n,r){return new il(e,1,t,rv.min(),n,r,0)}static newNoDocument(e,t){return new il(e,2,t,rv.min(),rv.min(),ia.empty(),0)}static newUnknownDocument(e,t){return new il(e,3,t,rv.min(),rv.min(),ia.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(rv.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ia.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ia.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rv.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof il&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new il(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ih{constructor(e,t){this.position=e,this.inclusive=t}}function iu(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],o=e.position[i];if(r=s.field.isKeyField()?rI.comparator(rI.fromName(o.referenceValue),n.key):r4(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ic(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!r3(e.position[n],t.position[n]))return!1;return!0}class id{constructor(e,t="asc"){this.field=e,this.dir=t}}class ip{}class ig extends ip{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new iv(e,t,n):"array-contains"===t?new iC(e,n):"in"===t?new iT(e,n):"not-in"===t?new iI(e,n):"array-contains-any"===t?new ix(e,n):new ig(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new iw(e,n):new ib(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(r4(t,this.value)):null!==t&&r6(this.value)===r6(t)&&this.matchesComparison(r4(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return re(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class im extends ip{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new im(e,t)}matches(e){return iy(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function iy(e){return"and"===e.op}function i_(e){for(let t of e.filters)if(t instanceof im)return!1;return!0}class iv extends ig{constructor(e,t,n){super(e,t,n),this.key=rI.fromName(n.referenceValue)}matches(e){let t=rI.comparator(e.key,this.key);return this.matchesComparison(t)}}class iw extends ig{constructor(e,t){super(e,"in",t),this.keys=iE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ib extends ig{constructor(e,t){super(e,"not-in",t),this.keys=iE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function iE(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>rI.fromName(e.referenceValue))}class iC extends ig{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return it(t)&&r5(t.arrayValue,this.value)}}class iT extends ig{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&r5(this.value.arrayValue,t)}}class iI extends ig{constructor(e,t){super(e,"not-in",t)}matches(e){if(r5(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!r5(this.value.arrayValue,t)}}class ix extends ig{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!it(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>r5(this.value.arrayValue,e))}}class iS{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Ie=null}}function ik(e,t=null,n=[],r=[],i=null,s=null,o=null){return new iS(e,t,n,r,i,s,o)}function iA(e){if(null===e.Ie){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof ig)return t.field.canonicalString()+t.op.toString()+r9(t.value);if(i_(t)&&iy(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>r9(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>r9(e)).join(",")),e.Ie=t}return e.Ie}function iN(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof ig?n instanceof ig&&t.op===n.op&&t.field.isEqual(n.field)&&r3(t.value,n.value):t instanceof im?n instanceof im&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void re(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ic(e.startAt,t.startAt)&&ic(e.endAt,t.endAt)}class iR{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function iP(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function iD(e){if(null===e.Ee){let t;e.Ee=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ee.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new rF(rT.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ee.push(new id(t,r))}),n.has(rT.keyField().canonicalString())||e.Ee.push(new id(rT.keyField(),r))}return e.Ee}function iO(e){return e.de||(e.de=function(e,t){if("F"===e.limitType)return ik(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new id(e.field,t)});let n=e.endAt?new ih(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new ih(e.startAt.position,e.startAt.inclusive):null;return ik(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(e,iD(e))),e.de}function iL(e,t,n){return new iR(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function iM(e,t){return iN(iO(e),iO(t))&&e.limitType===t.limitType}function iF(e){return`${iA(iO(e))}|lt:${e.limitType}`}function iU(e){var t;let n;return`Query(target=${n=(t=iO(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof ig?`${t.field.canonicalString()} ${t.op} ${r9(t.value)}`:t instanceof im?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>r9(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>r9(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function iB(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):rI.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of iD(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,n){let r=iu(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,iD(e),t))&&(!e.endAt||!!function(e,t,n){let r=iu(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,iD(e),t))}class ij{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){rD(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){var e=this.inner;for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}size(){return this.innerSize}}const iV=new rO(rI.comparator),iq=new rO(rI.comparator);function i$(...e){let t=iq;for(let n of e)t=t.insert(n.key,n);return t}function iH(){return new ij(e=>e.toString(),(e,t)=>e.isEqual(t))}new rO(rI.comparator);const iz=new rF(rI.comparator);function iW(...e){let t=iz;for(let n of e)t=t.add(n);return t}const iK=new rF(rp);class iG{constructor(){this._=void 0}}class iY extends iG{}class iQ extends iG{constructor(e){super(),this.elements=e}}function iX(e,t){let n=i2(t);for(let t of e.elements)n.some(e=>r3(e,t))||n.push(t);return{arrayValue:{values:n}}}class iJ extends iG{constructor(e){super(),this.elements=e}}function iZ(e,t){let n=i2(t);for(let t of e.elements)n=n.filter(e=>!r3(e,t));return{arrayValue:{values:n}}}class i0 extends iG{constructor(e,t){super(),this.serializer=e,this.Re=t}}function i1(e){return rH(e.integerValue||e.doubleValue)}function i2(e){return it(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class i6{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new i6}static exists(e){return new i6(void 0,e)}static updateTime(e){return new i6(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function i3(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class i5{}function i4(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new si(e.key,i6.none()):new i9(e.key,e.data,i6.none());{let n=e.data,r=ia.empty(),i=new rF(rT.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new se(e.key,r,new rB(i.toArray()),i6.none())}}function i8(e,t,n,r){return e instanceof i9?function(e,t,n,r){if(!i3(e.precondition,t))return n;let i=e.value.clone(),s=sr(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof se?function(e,t,n,r){if(!i3(e.precondition,t))return n;let i=sr(e.fieldTransforms,r,t),s=t.data;return(s.setAll(st(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):i3(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function i7(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&ry(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof iQ&&r instanceof iQ||n instanceof iJ&&r instanceof iJ?ry(n.elements,r.elements,r3):n instanceof i0&&r instanceof i0?r3(n.Re,r.Re):n instanceof iY&&r instanceof iY)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class i9 extends i5{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class se extends i5{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function st(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function sn(e,t,n){let r=new Map;rn(e.length===n.length,32656,{Ve:n.length,me:e.length});for(let s=0;s<n.length;s++){var i;let o=e[s],a=o.transform,l=t.data.field(o.field);r.set(o.field,(i=n[s],a instanceof iQ?iX(a,l):a instanceof iJ?iZ(a,l):i))}return r}function sr(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,e instanceof iY?function(e,t){let n={fields:{[rK]:{stringValue:rW},[rY]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&rQ(t)&&(t=function e(t){let n=t.mapValue.fields[rG];return rQ(n)?e(n):n}(t)),t&&(n.fields[rG]=t),{mapValue:n}}(t,s):e instanceof iQ?iX(e,s):e instanceof iJ?iZ(e,s):function(e,t){let n=function(e,t){return e instanceof i0?ie(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}(e,t),r=i1(n)+i1(e.Re);return ie(n)&&ie(e.Re)?{integerValue:""+r}:function(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rR(t)?"-0":t}}(e.serializer,r)}(e,s))}return r}class si extends i5{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ss{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){e instanceof i9?function(e,t,n){let r=e.value.clone(),i=sn(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof se?function(e,t,n){if(!i3(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=sn(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(st(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=i8(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=i8(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=iH();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,o=this.applyToLocalView(s,i.mutatedFields),a=i4(s,o=t.has(r.key)?null:o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(rv.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),iW())}isEqual(e){return this.batchId===e.batchId&&ry(this.mutations,e.mutations,(e,t)=>i7(e,t))&&ry(this.baseMutations,e.baseMutations,(e,t)=>i7(e,t))}}class so{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}(R=N||(N={}))[R.OK=0]="OK",R[R.CANCELLED=1]="CANCELLED",R[R.UNKNOWN=2]="UNKNOWN",R[R.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",R[R.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",R[R.NOT_FOUND=5]="NOT_FOUND",R[R.ALREADY_EXISTS=6]="ALREADY_EXISTS",R[R.PERMISSION_DENIED=7]="PERMISSION_DENIED",R[R.UNAUTHENTICATED=16]="UNAUTHENTICATED",R[R.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",R[R.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",R[R.ABORTED=10]="ABORTED",R[R.OUT_OF_RANGE=11]="OUT_OF_RANGE",R[R.UNIMPLEMENTED=12]="UNIMPLEMENTED",R[R.INTERNAL=13]="INTERNAL",R[R.UNAVAILABLE=14]="UNAVAILABLE",R[R.DATA_LOSS=15]="DATA_LOSS",new _([0xffffffff,0xffffffff],0);class sa{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function sl(e){return rn(!!e,49232),rv.fromTimestamp(function(e){let t=r$(e);return new r_(t.seconds,t.nanos)}(e))}function sh(e,t){let n=new rE(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function su(e){return rT.fromServerFormat(e.fieldPath)}class sc{constructor(e){this.wt=e}}class sd{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(+!!e.booleanValue);else if("integerValue"in e)this.Mt(t,15),t.xt(rH(e.integerValue));else if("doubleValue"in e){let n=rH(e.doubleValue);isNaN(n)?this.Mt(t,13):(this.Mt(t,15),rR(n)?t.xt(0):t.xt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Mt(t,20),"string"==typeof n&&(n=r$(n)),t.Ot(`${n.seconds||""}`),t.xt(n.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(rz(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Mt(t,45),t.xt(n.latitude||0),t.xt(n.longitude||0)}else"mapValue"in e?io(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):ii(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):re(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){let n=e.fields||{};for(let e of(this.Mt(t,55),Object.keys(n)))this.Nt(e,t),this.Ct(n[e],t)}qt(e,t){var n,r;let i=e.fields||{};this.Mt(t,53);let s=(null==(r=null==(n=i[r2].arrayValue)?void 0:n.values)?void 0:r.length)||0;this.Mt(t,15),t.xt(rH(s)),this.Nt(r2,t),this.Ct(i[r2],t)}$t(e,t){let n=e.values||[];for(let e of(this.Mt(t,50),n))this.Ct(e,t)}kt(e,t){this.Mt(t,37),rI.fromName(e).path.forEach(e=>{this.Mt(t,60),this.Kt(e,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}sd.Wt=new sd;class sf{constructor(){this.Cn=new sp}addToCollectionParentIndex(e,t){return this.Cn.add(t),rk.resolve()}getCollectionParents(e,t){return rk.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return rk.resolve()}deleteFieldIndex(e,t){return rk.resolve()}deleteAllFieldIndexes(e){return rk.resolve()}createTargetIndexes(e,t){return rk.resolve()}getDocumentsMatchingTarget(e,t){return rk.resolve(null)}getIndexType(e,t){return rk.resolve(0)}getFieldIndexes(e,t){return rk.resolve([])}getNextCollectionGroupToUpdate(e){return rk.resolve(null)}getMinOffset(e,t){return rk.resolve(rx.min())}getMinOffsetFromCollectionGroup(e,t){return rk.resolve(rx.min())}updateCollectionGroup(e,t,n){return rk.resolve()}updateIndexEntries(e,t){return rk.resolve()}}class sp{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new rF(rE.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new rF(rE.comparator)).toArray()}}new Uint8Array(0);class sg{static withCacheSize(e){return new sg(e,sg.DEFAULT_COLLECTION_PERCENTILE,sg.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}sg.DEFAULT_COLLECTION_PERCENTILE=10,sg.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sg.DEFAULT=new sg(0x2800000,sg.DEFAULT_COLLECTION_PERCENTILE,sg.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sg.DISABLED=new sg(-1,0,0);class sm{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new sm(0)}static lr(){return new sm(-1)}}class sy{constructor(){this.changes=new ij(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,il.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?rk.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class s_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sv{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&i8(n.mutation,e,rB.empty(),r_.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,iW()).next(()=>t))}getLocalViewOfDocuments(e,t,n=iW()){let r=iH();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=i$();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=iH();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,iW()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=iV,s=iH(),o=iH();return t.forEach((e,t)=>{let o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof se)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),i8(o.mutation,t,o.mutation.getFieldMask(),r_.now())):s.set(t.key,rB.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new s_(t,null!=(n=s.get(e))?n:null))}),o))}recalculateAndSaveOverlays(e,t){let n=iH(),r=new rO((e,t)=>e-t),i=iW();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let o=n.get(e)||rB.empty();o=i.applyToLocalView(s,o),n.set(e,o);let a=(r.get(i.batchId)||iW()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{let s=[],o=r.getReverseIterator();for(;o.hasNext();){let r=o.getNext(),a=r.key,l=r.value,h=iH();l.forEach(e=>{if(!i.has(e)){let r=i4(t.get(e),n.get(e));null!==r&&h.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,h))}return rk.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return rI.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):null!==t.collectionGroup?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):rk.resolve(iH()),o=-1,a=i;return s.next(t=>rk.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?rk.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,iW())).next(e=>{let t;return{batchId:o,changes:(t=iq,e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t)}}))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new rI(t)).next(e=>{let t=i$();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=i$();return this.indexManager.getCollectionParents(e,i).next(o=>rk.forEach(o,o=>{let a=new iR(o.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,il.newInvalidDocument(r)))});let n=i$();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&i8(s.mutation,r,rB.empty(),r_.now()),iB(t,r)&&(n=n.insert(e,r))}),n})}}class sw{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return rk.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,{id:t.id,version:t.version,createTime:sl(t.createTime)}),rk.resolve()}getNamedQuery(e,t){return rk.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,{name:t.name,query:function(e){let t=function(e){var t;let n,r=function(e){var t;let n=function(e){var t;let n=rE.fromString(e);return rn((t=n).length>=4&&"projects"===t.get(0)&&"databases"===t.get(2),10190,{key:n.toString()}),n}(e);return 4===n.length?rE.emptyPath():(rn((t=n).length>4&&"documents"===t.get(4),29091,{key:t.toString()}),t.popFirst(5))}(e.parent),i=e.structuredQuery,s=i.from?i.from.length:0,o=null;if(s>0){rn(1===s,65062);let e=i.from[0];e.allDescendants?o=e.collectionId:r=r.child(e.collectionId)}let a=[];i.where&&(a=function(e){var t;let n=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=su(e.unaryFilter.field);return ig.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=su(e.unaryFilter.field);return ig.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=su(e.unaryFilter.field);return ig.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=su(e.unaryFilter.field);return ig.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return re(61313);default:return re(60726)}}(t):void 0!==t.fieldFilter?ig.create(su(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return re(58110);default:return re(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?im.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return re(1026)}}(t.compositeFilter.op)):re(30097,{filter:t})}(e);return n instanceof im&&i_(t=n)&&iy(t)?n.getFilters():[n]}(i.where));let l=[];i.orderBy&&(l=i.orderBy.map(e=>new id(su(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let h=null;i.limit&&(h=null==(n="object"==typeof(t=i.limit)?t.value:t)?null:n);let u=null;i.startAt&&(u=function(e){let t=!!e.before;return new ih(e.values||[],t)}(i.startAt));let c=null;return i.endAt&&(c=function(e){let t=!e.before;return new ih(e.values||[],t)}(i.endAt)),new iR(r,o,l,a,h,"F",u,c)}({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?iL(t,t.limit,"L"):t}(t.bundledQuery),readTime:sl(t.readTime)}),rk.resolve()}}class sb{constructor(){this.overlays=new rO(rI.comparator),this.Qr=new Map}getOverlay(e,t){return rk.resolve(this.overlays.get(t))}getOverlays(e,t){let n=iH();return rk.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),rk.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.Qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Qr.delete(n)),rk.resolve()}getOverlaysForCollection(e,t,n){let r=iH(),i=t.length+1,s=new rI(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){let e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return rk.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new rO((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=iH(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let o=iH(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return rk.resolve(o)}St(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.Qr.get(r.largestBatchId).delete(n.key);this.Qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new so(t,n));let i=this.Qr.get(t);void 0===i&&(i=iW(),this.Qr.set(t,i)),this.Qr.set(t,i.add(n.key))}}class sE{constructor(){this.sessionToken=rV.EMPTY_BYTE_STRING}getSessionToken(e){return rk.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,rk.resolve()}}class sC{constructor(){this.$r=new rF(sT.Ur),this.Kr=new rF(sT.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){let n=new sT(e,t);this.$r=this.$r.add(n),this.Kr=this.Kr.add(n)}Gr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.zr(new sT(e,t))}jr(e,t){e.forEach(e=>this.removeReference(e,t))}Hr(e){let t=new rI(new rE([])),n=new sT(t,e),r=new sT(t,e+1),i=[];return this.Kr.forEachInRange([n,r],e=>{this.zr(e),i.push(e.key)}),i}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){let t=new rI(new rE([])),n=new sT(t,e),r=new sT(t,e+1),i=iW();return this.Kr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new sT(e,0),n=this.$r.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class sT{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return rI.comparator(e.key,t.key)||rp(e.Zr,t.Zr)}static Wr(e,t){return rp(e.Zr,t.Zr)||rI.comparator(e.key,t.key)}}class sI{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new rF(sT.Ur)}checkEmpty(e){return rk.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new ss(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Xr=this.Xr.add(new sT(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return rk.resolve(s)}lookupMutationBatch(e,t){return rk.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.ti(t+1),r=n<0?0:n;return rk.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return rk.resolve(0===this.mutationQueue.length?-1:this.nr-1)}getAllMutationBatches(e){return rk.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new sT(t,0),r=new sT(t,Number.POSITIVE_INFINITY),i=[];return this.Xr.forEachInRange([n,r],e=>{let t=this.ei(e.Zr);i.push(t)}),rk.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new rF(rp);return t.forEach(e=>{let t=new sT(e,0),r=new sT(e,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([t,r],e=>{n=n.add(e.Zr)})}),rk.resolve(this.ni(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;rI.isDocumentKey(i)||(i=i.child(""));let s=new sT(new rI(i),0),o=new rF(rp);return this.Xr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Zr)),!0)},s),rk.resolve(this.ni(o))}ni(e){let t=[];return e.forEach(e=>{let n=this.ei(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){rn(0===this.ri(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Xr;return rk.forEach(t.mutations,r=>{let i=new sT(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Xr=n})}sr(e){}containsKey(e,t){let n=new sT(t,0),r=this.Xr.firstAfterOrEqual(n);return rk.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,rk.resolve()}ri(e,t){return this.ti(e)}ti(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ei(e){let t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sx{constructor(e){this.ii=e,this.docs=new rO(rI.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ii(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return rk.resolve(n?n.document.mutableCopy():il.newInvalidDocument(t))}getEntries(e,t){let n=iV;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():il.newInvalidDocument(e))}),rk.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=iV,s=t.path,o=new rI(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){let{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=rI.comparator(e.documentKey,t.documentKey))?n:rp(e.largestBatchId,t.largestBatchId)}(new rx(o.readTime,o.key,-1),n)||(r.has(o.key)||iB(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return rk.resolve(i)}getAllFromCollectionGroup(e,t,n,r){re(9500)}si(e,t){return rk.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new sS(this)}getSize(e){return rk.resolve(this.size)}}class sS extends sy{constructor(e){super(),this.Br=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Br.addEntry(e,r)):this.Br.removeEntry(n)}),rk.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}class sk{constructor(e){this.persistence=e,this.oi=new ij(e=>iA(e),iN),this.lastRemoteSnapshotVersion=rv.min(),this.highestTargetId=0,this._i=0,this.ai=new sC,this.targetCount=0,this.ui=sm.cr()}forEachTarget(e,t){return this.oi.forEach((e,n)=>t(n)),rk.resolve()}getLastRemoteSnapshotVersion(e){return rk.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return rk.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),rk.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this._i&&(this._i=t),rk.resolve()}Tr(e){this.oi.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ui=new sm(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,rk.resolve()}updateTargetData(e,t){return this.Tr(t),rk.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,rk.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.oi.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.oi.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),rk.waitFor(i).next(()=>r)}getTargetCount(e){return rk.resolve(this.targetCount)}getTargetData(e,t){let n=this.oi.get(t)||null;return rk.resolve(n)}addMatchingKeys(e,t,n){return this.ai.Gr(t,n),rk.resolve()}removeMatchingKeys(e,t,n){this.ai.jr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),rk.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),rk.resolve()}getMatchingKeysForTargetId(e,t){let n=this.ai.Yr(t);return rk.resolve(n)}containsKey(e,t){return rk.resolve(this.ai.containsKey(t))}}class sA{constructor(e,t){this.ci={},this.overlays={},this.li=new rN(0),this.hi=!1,this.hi=!0,this.Pi=new sE,this.referenceDelegate=e(this),this.Ti=new sk(this),this.indexManager=new sf,this.remoteDocumentCache=new sx(e=>this.referenceDelegate.Ii(e)),this.serializer=new sc(t),this.Ei=new sw(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sb,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ci[e.toKey()];return n||(n=new sI(t,this.referenceDelegate),this.ci[e.toKey()]=n),n}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,n){n4("MemoryPersistence","Starting transaction:",e);let r=new sN(this.li.next());return this.referenceDelegate.di(),n(r).next(e=>this.referenceDelegate.Ai(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ri(e,t){return rk.or(Object.values(this.ci).map(n=>()=>n.containsKey(e,t)))}}class sN extends rS{constructor(e){super(),this.currentSequenceNumber=e}}class sR{constructor(e){this.persistence=e,this.Vi=new sC,this.mi=null}static fi(e){return new sR(e)}get gi(){if(this.mi)return this.mi;throw re(60996)}addReference(e,t,n){return this.Vi.addReference(n,t),this.gi.delete(n.toString()),rk.resolve()}removeReference(e,t,n){return this.Vi.removeReference(n,t),this.gi.add(n.toString()),rk.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),rk.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach(e=>this.gi.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.gi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}di(){this.mi=new Set}Ai(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return rk.forEach(this.gi,n=>{let r=rI.fromPath(n);return this.pi(e,r).next(e=>{e||t.removeEntry(r,rv.min())})}).next(()=>(this.mi=null,t.apply(e)))}updateLimboDocument(e,t){return this.pi(e,t).next(e=>{e?this.gi.delete(t.toString()):this.gi.add(t.toString())})}Ii(e){return 0}pi(e,t){return rk.or([()=>rk.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}class sP{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.ds=n,this.As=r}static Rs(e,t){let n=iW(),r=iW();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new sP(e,t.fromCache,n,r)}}class sD{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class sO{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=!function(){var e;let t=null==(e=eX())?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(U.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}(e7())>0?6:4}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ws(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.bs(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new sD;return this.Ss(e,t,n).next(r=>{if(i.result=r,this.fs)return this.Ds(e,t,n,r.size)})}).next(()=>i.result)}Ds(e,t,n,r){return n.documentReadCount<this.gs?(n5()<=y.DEBUG&&n4("QueryEngine","SDK will not create cache indexes for query:",iU(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),rk.resolve()):(n5()<=y.DEBUG&&n4("QueryEngine","Query:",iU(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ps*r?(n5()<=y.DEBUG&&n4("QueryEngine","The SDK decides to create cache indexes for query:",iU(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,iO(t))):rk.resolve())}ws(e,t){if(iP(t))return rk.resolve(null);let n=iO(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=iO(t=iL(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=iW(...r);return this.ys.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.vs(t,r);return this.Cs(t,s,i,n.readTime)?this.ws(e,iL(t,null,"F")):this.Fs(e,s,t,n)}))})))}bs(e,t,n,r){return iP(t)||r.isEqual(rv.min())?rk.resolve(null):this.ys.getDocuments(e,n).next(i=>{let s=this.vs(t,i);return this.Cs(t,s,n,r)?rk.resolve(null):(n5()<=y.DEBUG&&n4("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),iU(t)),this.Fs(e,s,t,function(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new rx(rv.fromTimestamp(1e9===r?new r_(n+1,0):new r_(n,r)),rI.empty(),-1)}(r,0)).next(e=>e))})}vs(e,t){let n=new rF((t,n)=>{let r=!1;for(let i of iD(e)){let e=function(e,t,n){let r=e.field.isKeyField()?rI.comparator(t.key,n.key):function(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?r4(r,i):re(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return re(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0});return t.forEach((t,r)=>{iB(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return n5()<=y.DEBUG&&n4("QueryEngine","Using full collection scan to execute query:",iU(t)),this.ys.getDocumentsMatchingQuery(e,t,rx.min(),n)}Fs(e,t,n,r){return this.ys.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class sL{constructor(e,t,n,r){this.persistence=e,this.Ms=t,this.serializer=r,this.xs=new rO(rp),this.Os=new ij(e=>iA(e),iN),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(n)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sv(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.xs))}}async function sM(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Ls(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],o=iW();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))o=o.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))o=o.add(t.key);return e.localDocuments.getDocuments(n,o).next(e=>({ks:e,removedBatchIds:i,addedBatchIds:s}))})})}class sF{constructor(){this.activeTargetIds=iK}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class sU{constructor(){this.xo=new sF,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,n){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new sF,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class sB{No(e){}shutdown(){}}const sj="ConnectivityMonitor";class sV{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){for(let e of(n4(sj,"Network connectivity changed: AVAILABLE"),this.Qo))e(0)}qo(){for(let e of(n4(sj,"Network connectivity changed: UNAVAILABLE"),this.Qo))e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let sq=null;function s$(){return null===sq?sq=0x10000000+Math.round(0x80000000*Math.random()):sq++,"0x"+sq.toString(16)}const sH="RestConnection",sz={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class sW{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${n}/databases/${r}`,this.Go=this.databaseId.database===rJ?`project_id=${n}`:`project_id=${n}&database_id=${r}`}zo(e,t,n,r,i){let s=s$(),o=this.jo(e,t.toUriEncodedString());n4(sH,`Sending RPC '${e}' ${s}:`,o,n);let a={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(a,r,i);let{host:l}=new URL(o),h=e2(l);return this.Jo(e,o,a,n,h).then(t=>(n4(sH,`Received RPC '${e}' ${s}: `,t),t),t=>{throw n7(sH,`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t})}Yo(e,t,n,r,i,s){return this.zo(e,t,n,r,i)}Ho(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+n6,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}jo(e,t){let n=sz[e];return`${this.Ko}/v1/${t}:${n}`}terminate(){}}class sK{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}const sG="WebChannelConnection";class sY extends sW{constructor(e){super(e),this.l_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,i){let s=s$();return new Promise((i,o)=>{let a=new v;a.setWithCredentials(!0),a.listenOnce(b.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case E.NO_ERROR:let t=a.getResponseJson();n4(sG,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case E.TIMEOUT:n4(sG,`RPC '${e}' ${s} timed out`),o(new ri(rr.DEADLINE_EXCEEDED,"Request time out"));break;case E.HTTP_ERROR:let n=a.getStatus();if(n4(sG,`RPC '${e}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(rr).indexOf(t)>=0?t:rr.UNKNOWN}(t.status);o(new ri(e,t.message))}else o(new ri(rr.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new ri(rr.UNAVAILABLE,"Connection failed."));break;default:re(9055,{h_:e,streamId:s,P_:a.getLastErrorCode(),T_:a.getLastError()})}}finally{n4(sG,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(r);n4(sG,`RPC '${e}' ${s} sending request:`,r),a.send(t,"POST",l,n,15)})}I_(e,t,n){let r=s$(),i=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=x(),o=I(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Ho(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;let h=i.join("");n4(sG,`Creating RPC '${e}' stream ${r}: ${h}`,a);let u=s.createWebChannel(h,a);this.E_(u);let c=!1,d=!1,f=new sK({Zo:t=>{d?n4(sG,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(c||(n4(sG,`Opening RPC '${e}' stream ${r} transport.`),u.open(),c=!0),n4(sG,`RPC '${e}' stream ${r} sending:`,t),u.send(t))},Xo:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,w.EventType.OPEN,()=>{d||(n4(sG,`RPC '${e}' stream ${r} transport opened.`),f.__())}),p(u,w.EventType.CLOSE,()=>{d||(d=!0,n4(sG,`RPC '${e}' stream ${r} transport closed`),f.u_(),this.d_(u))}),p(u,w.EventType.ERROR,t=>{d||(d=!0,n7(sG,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),f.u_(new ri(rr.UNAVAILABLE,"The operation could not be completed")))}),p(u,w.EventType.MESSAGE,t=>{var n;if(!d){let i=t.data[0];rn(!!i,16349);let s=(null==i?void 0:i.error)||(null==(n=i[0])?void 0:n.error);if(s){n4(sG,`RPC '${e}' stream ${r} received error:`,s);let t=s.status,n=function(e){let t=N[e];if(void 0!==t){if(void 0===t)return n8("GRPC error has no .code"),rr.UNKNOWN;switch(t){case N.OK:return rr.OK;case N.CANCELLED:return rr.CANCELLED;case N.UNKNOWN:return rr.UNKNOWN;case N.DEADLINE_EXCEEDED:return rr.DEADLINE_EXCEEDED;case N.RESOURCE_EXHAUSTED:return rr.RESOURCE_EXHAUSTED;case N.INTERNAL:return rr.INTERNAL;case N.UNAVAILABLE:return rr.UNAVAILABLE;case N.UNAUTHENTICATED:return rr.UNAUTHENTICATED;case N.INVALID_ARGUMENT:return rr.INVALID_ARGUMENT;case N.NOT_FOUND:return rr.NOT_FOUND;case N.ALREADY_EXISTS:return rr.ALREADY_EXISTS;case N.PERMISSION_DENIED:return rr.PERMISSION_DENIED;case N.FAILED_PRECONDITION:return rr.FAILED_PRECONDITION;case N.ABORTED:return rr.ABORTED;case N.OUT_OF_RANGE:return rr.OUT_OF_RANGE;case N.UNIMPLEMENTED:return rr.UNIMPLEMENTED;case N.DATA_LOSS:return rr.DATA_LOSS;default:return re(39323,{code:t})}}}(t),i=s.message;void 0===n&&(n=rr.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),d=!0,f.u_(new ri(n,i)),u.close()}else n4(sG,`RPC '${e}' stream ${r} received:`,i),f.c_(i)}}),p(o,T.STAT_EVENT,t=>{t.stat===C.PROXY?n4(sG,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===C.NOPROXY&&n4(sG,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{f.a_()},0),f}terminate(){this.l_.forEach(e=>e.close()),this.l_=[]}E_(e){this.l_.push(e)}d_(e){this.l_=this.l_.filter(t=>t===e)}}function sQ(){return"undefined"!=typeof document?document:null}class sX{constructor(e,t,n=1e3,r=1.5,i=6e4){this.xi=e,this.timerId=t,this.A_=n,this.R_=r,this.V_=i,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(e){this.cancel();let t=Math.floor(this.m_+this.w_()),n=Math.max(0,Date.now()-this.g_),r=Math.max(0,t-n);r>0&&n4("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.m_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,r,()=>(this.g_=Date.now(),e())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){null!==this.f_&&(this.f_.skipDelay(),this.f_=null)}cancel(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}}class sJ{}class sZ extends sJ{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.sa=!1}oa(){if(this.sa)throw new ri(rr.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,n,r){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.zo(e,sh(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===rr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ri(rr.UNKNOWN,e.toString())})}Yo(e,t,n,r,i){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Yo(e,sh(t,n),r,s,o,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===rr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ri(rr.UNKNOWN,e.toString())})}terminate(){this.sa=!0,this.connection.terminate()}}class s0{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){0===this._a&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(e){"Online"===this.state?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.la("Offline")))}set(e){this.Ta(),this._a=0,"Online"===e&&(this.ua=!1),this.la(e)}la(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ha(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(n8(t),this.ua=!1):n4("OnlineStateTracker",t)}Ta(){null!==this.aa&&(this.aa.cancel(),this.aa=null)}}const s1="RemoteStore";class s2{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=i,this.Ra.No(e=>{n.enqueueAndForget(async()=>{s5(this)&&(n4(s1,"Restarting streams for network reachability change."),await async function(e){e.da.add(4),await s3(e),e.Va.set("Unknown"),e.da.delete(4),await s6(e)}(this))})}),this.Va=new s0(n,r)}}async function s6(e){if(s5(e))for(let t of e.Aa)await t(!0)}async function s3(e){for(let t of e.Aa)await t(!1)}function s5(e){return 0===e.da.size}async function s4(e,t){t?(e.da.delete(2),await s6(e)):t||(e.da.add(2),await s3(e),e.Va.set("Unknown"))}class s8{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new rs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new s8(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ri(rr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class s7{constructor(){this.queries=s9(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){let n=e.queries;e.queries=s9(),n.forEach((e,n)=>{for(let e of n.Sa)e.onError(t)})}(this,new ri(rr.ABORTED,"Firestore shutting down"))}}function s9(){return new ij(e=>iF(e),iM)}(D=P||(P={})).xa="default",D.Cache="cache";class oe{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.lu={},this.hu=new ij(e=>iF(e),iM),this.Pu=new Map,this.Tu=new Set,this.Iu=new rO(rI.comparator),this.Eu=new Map,this.du=new sC,this.Au={},this.Ru=new Map,this.Vu=sm.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return!0===this.mu}}function ot(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.hu.forEach((e,n)=>{let r=n.view.Fa(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.Sa)e.Fa(t)&&(n=!0)}),n&&r.Ca.forEach(e=>{e.next()}),i.length&&e.lu.Y_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function on(e,t,n){let r=[],i=[],s=[];e.hu.isEmpty()||(e.hu.forEach((o,a)=>{s.push(e.fu(a,t,n).then(t=>{var s;if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:null==(s=null==n?void 0:n.targetChanges.get(a.targetId))?void 0:s.current;e.sharedClientState.updateQueryState(a.targetId,r?"current":"not-current")}if(t){r.push(t);let e=sP.Rs(a.targetId,t);i.push(e)}}))}),await Promise.all(s),e.lu.Y_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>rk.forEach(t,t=>rk.forEach(t.ds,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>rk.forEach(t.As,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!rA(e))throw e;n4("LocalStore","Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.xs.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.xs=e.xs.insert(t,i)}}}(e.localStore,i))}async function or(e,t){if(!e.currentUser.isEqual(t)){n4("SyncEngine","User change. New user:",t.toKey());let n=await sM(e.localStore,t);e.currentUser=t,e.Ru.forEach(e=>{e.forEach(e=>{e.reject(new ri(rr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Ru.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await on(e,n.ks)}}class oi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=new sa(e.databaseInfo.databaseId,!0),this.sharedClientState=this.bu(e),this.persistence=this.Su(e),await this.persistence.start(),this.localStore=this.Du(e),this.gcScheduler=this.vu(e,this.localStore),this.indexBackfillerScheduler=this.Cu(e,this.localStore)}vu(e,t){return null}Cu(e,t){return null}Du(e){var t,n;return t=this.persistence,n=new sO,new sL(t,n,e.initialUser,this.serializer)}Su(e){return new sA(sR.fi,this.serializer)}bu(e){return new sU}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}oi.provider={build:()=>new oi};class os{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>ot(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=or.bind(null,this.syncEngine),await s4(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new s7}createDatastore(e){var t;let n=new sa(e.databaseInfo.databaseId,!0),r=new sY(e.databaseInfo);return t=e.authCredentials,new sZ(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new s2(t,n,e.asyncQueue,e=>ot(this.syncEngine,e,0),sV.C()?new sV:new sB)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){let a=new oe(e,t,n,r,i,s);return o&&(a.mu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){n4(s1,"RemoteStore shutting down."),e.da.add(5),await s3(e),e.Ra.shutdown(),e.Va.set("Unknown")}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()}}os.provider={build:()=>new os};const oo=new Map,oa="firestore.googleapis.com";class ol{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new ri(rr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=oa,this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new ri(rr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new ri(rr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=function(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}(null!=(n=e.experimentalLongPollingOptions)?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ri(rr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new ri(rr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new ri(rr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class oh{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ol({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ri(rr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new ri(rr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ol(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ra;switch(e.type){case"firstParty":return new rc(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ri(rr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=oo.get(e);t&&(n4("ComponentProvider","Removing Datastore"),oo.delete(e),t.terminate())}(this),Promise.resolve()}}const ou="AsyncQueue";class oc{constructor(e=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new sX(this,"async_queue_retry"),this.rc=()=>{let e=sQ();e&&n4(ou,"Visibility state changed to "+e.visibilityState),this.x_.b_()},this.sc=e;let t=sQ();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.oc(),this._c(e)}enterRestrictedMode(e){if(!this.Yu){this.Yu=!0,this.tc=e||!1;let t=sQ();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.rc)}}enqueue(e){if(this.oc(),this.Yu)return new Promise(()=>{});let t=new rs;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ju.push(e),this.ac()))}async ac(){if(0!==this.Ju.length){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(e){if(!rA(e))throw e;n4(ou,"Operation failed with retryable error: "+e)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}}_c(e){let t=this.sc.then(()=>(this.ec=!0,e().catch(e=>{throw this.Xu=e,this.ec=!1,n8("INTERNAL UNHANDLED ERROR: ",od(e)),e}).then(e=>(this.ec=!1,e))));return this.sc=t,t}enqueueAfterDelay(e,t,n){this.oc(),this.nc.indexOf(e)>-1&&(t=0);let r=s8.createAndSchedule(this,e,t,n,e=>this.uc(e));return this.Zu.push(r),r}oc(){this.Xu&&re(47125,{cc:od(this.Xu)})}verifyOperationInProgress(){}async lc(){let e;do e=this.sc,await e;while(e!==this.sc)}hc(e){for(let t of this.Zu)if(t.timerId===e)return!0;return!1}Pc(e){return this.lc().then(()=>{for(let t of(this.Zu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.Zu))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.lc()})}Tc(e){this.nc.push(e)}uc(e){let t=this.Zu.indexOf(e);this.Zu.splice(t,1)}}function od(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class of extends oh{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new oc,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new oc(e),this._firestoreClient=void 0,await e}}}RegExp("[~\\*/\\[\\]]"),new WeakMap,function(e=!0){n6=t3,tZ(new tw("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new of(new rh(t.getProvider("auth-internal")),new rf(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ri(rr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rZ(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),t8(n0,n1,void 0),t8(n0,n1,"esm2017")}();var op={},og=op={};function om(){throw Error("setTimeout has not been defined")}function oy(){throw Error("clearTimeout has not been defined")}try{O="function"==typeof setTimeout?setTimeout:om}catch(e){O=om}try{L="function"==typeof clearTimeout?clearTimeout:oy}catch(e){L=oy}function o_(e){if(O===setTimeout)return setTimeout(e,0);if((O===om||!O)&&setTimeout)return O=setTimeout,setTimeout(e,0);try{return O(e,0)}catch(t){try{return O.call(null,e,0)}catch(t){return O.call(this,e,0)}}}var ov=[],ow=!1,ob=-1;function oE(){ow&&M&&(ow=!1,M.length?ov=M.concat(ov):ob=-1,ov.length&&oC())}function oC(){if(!ow){var e=o_(oE);ow=!0;for(var t=ov.length;t;){for(M=ov,ov=[];++ob<t;)M&&M[ob].run();ob=-1,t=ov.length}M=null,ow=!1,function(e){if(L===clearTimeout)return clearTimeout(e);if((L===oy||!L)&&clearTimeout)return L=clearTimeout,clearTimeout(e);try{L(e)}catch(t){try{return L.call(null,e)}catch(t){return L.call(this,e)}}}(e)}}function oT(e,t){this.fun=e,this.array=t}function oI(){}og.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];ov.push(new oT(e,t)),1!==ov.length||ow||o_(oC)},oT.prototype.run=function(){this.fun.apply(null,this.array)},og.title="browser",og.browser=!0,og.env={},og.argv=[],og.version="",og.versions={},og.on=oI,og.addListener=oI,og.once=oI,og.off=oI,og.removeListener=oI,og.removeAllListeners=oI,og.emit=oI,og.prependListener=oI,og.prependOnceListener=oI,og.listeners=function(e){return[]},og.binding=function(e){throw Error("process.binding is not supported")},og.cwd=function(){return"/"},og.chdir=function(e){throw Error("process.chdir is not supported")},og.umask=function(){return 0};const ox="@firebase/database",oS="1.0.19";let ok="";class oA{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ts(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:ti(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class oN{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return th(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const oR=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new oA(t)}}catch(e){}return new oN},oP=oR("localStorage"),oD=oR("sessionStorage"),oO=new tA("@firebase/database"),oL=(d=1,function(){return d++}),oM=function(e){let t=ty(e),n=new tg;n.update(t);let r=n.digest();return e$.encodeByteArray(r)},oF=function(...e){let t="";for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=oF.apply(null,r):"object"==typeof r?t+=ts(r):t+=r,t+=" "}return t};let oU=null,oB=!0;const oj=function(e,t){eB(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(oO.logLevel=y.VERBOSE,oU=oO.log.bind(oO),t&&oD.set("logging_enabled",!0)):"function"==typeof e?oU=e:(oU=null,oD.remove("logging_enabled"))},oV=function(...e){if(!0===oB&&(oB=!1,null===oU&&!0===oD.get("logging_enabled")&&oj(!0)),oU){let t=oF.apply(null,e);oU(t)}},oq=function(e){return function(...t){oV(e,...t)}},o$=function(...e){let t="FIREBASE INTERNAL ERROR: "+oF(...e);oO.error(t)},oH=function(...e){let t=`FIREBASE FATAL ERROR: ${oF(...e)}`;throw oO.error(t),Error(t)},oz=function(...e){let t="FIREBASE WARNING: "+oF(...e);oO.warn(t)},oW=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&oz("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},oK=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},oG=function(e){if(te()||"complete"===document.readyState)e();else{let t=!1,n=function(){if(!document.body)return void setTimeout(n,Math.floor(10));t||(t=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},oY="[MIN_NAME]",oQ="[MAX_NAME]",oX=function(e,t){if(e===t)return 0;{if(e===oY||t===oQ)return -1;if(t===oY||e===oQ)return 1;let n=o5(e),r=o5(t);if(null!==n)if(null!==r)return n-r==0?e.length-t.length:n-r;else return -1;return null!==r?1:e<t?-1:1}},oJ=function(e,t){return e===t?0:e<t?-1:1},oZ=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+ts(t))},o0=function(e){if("object"!=typeof e||null===e)return ts(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=ts(t[r]),n+=":",n+=o0(e[t[r]]);return n+"}"},o1=function(e,t){let n=e.length;if(n<=t)return[e];let r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function o2(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}const o6=function(e){let t,n,r,i,s;eB(!oK(e),"Invalid JSON number");0===e?(n=0,r=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,r=Math.round(e*Math.pow(2,52-i)-0x10000000000000)):(n=0,r=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(+!!t),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},o3=RegExp("^-?(0*)\\d{1,10}$"),o5=function(e){if(o3.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},o4=function(e){try{e()}catch(e){setTimeout(()=>{throw oz("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},o8=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class o7{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,t1(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null==(t=this.appCheckProvider)||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){oz(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class o9{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(oV("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',oz(e)}}class ae{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}ae.OWNER="owner";const at=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,an="websocket",ar="long_polling";class ai{constructor(e,t,n,r,i=!1,s="",o=!1,a=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=oP.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&oP.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function as(e,t,n){let r;if(eB("string"==typeof t,"typeof type must == string"),eB("object"==typeof n,"typeof params must == object"),t===an)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===ar)r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let i=[];return o2(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class ao{constructor(){this.counters_={}}incrementCounter(e,t=1){th(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let r in n)n.hasOwnProperty(r)&&"__proto__"!==r&&(t[r]=e(t[r],n[r]));return t}(void 0,this.counters_)}}const aa={},al={};function ah(e){let t=e.toString();return aa[t]||(aa[t]=new ao),aa[t]}class au{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&o4(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const ac="start";class ad{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=oq(e),this.stats_=ah(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),as(t,ar,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new au(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),oG(()=>{if(this.isClosed_)return;this.scriptTagHolder=new af((...e)=>{let[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===ac)this.id=n,this.password=r;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[ac]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&at.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ad.forceAllow_=!0}static forceDisallow(){ad.forceDisallow_=!0}static isAvailable(){return!te()&&(!!ad.forceAllow_||!ad.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=ts(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=o1(ez(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(te())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=ts(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class af{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,te())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=oL(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=af.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');let r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(e){oV("frame writing exception"),e.stack&&oV(e.stack),oV(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||oV("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){te()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{oV("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let ap=null;"undefined"!=typeof MozWebSocket?ap=MozWebSocket:"undefined"!=typeof WebSocket&&(ap=WebSocket);class ag{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=oq(this.connId),this.stats_=ah(t),this.connURL=ag.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){let s={};return s.v="5",!te()&&"undefined"!=typeof location&&location.hostname&&at.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),as(e,an,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,oP.set("previous_websocket_failure",!0);try{let e;if(te()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${ok}/${op.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n={},r=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(e.proxy={origin:r})}this.mySock=new ap(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){ag.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==ap&&!ag.forceDisallow_}static previouslyFailed(){return oP.isInMemoryStorage||!0===oP.get("previous_websocket_failure")}markConnectionHealthy(){oP.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=ti(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(eB(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=ts(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=o1(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ag.responsesRequiredToBeHealthy=2,ag.healthyTimeout=3e4;class am{static get ALL_TRANSPORTS(){return[ad,ag]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=ag&&ag.isAvailable(),n=t&&!ag.previouslyFailed();if(e.webSocketOnly&&(t||oz("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[ag];else{let e=this.transports_=[];for(let t of am.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);am.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}am.globalTransportInitialized_=!1;class ay{constructor(e,t,n,r,i,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=oq("c:"+this.id+":"),this.transportManager_=new am(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=o8(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=oZ("t",e),n=oZ("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=oZ("t",e),n=oZ("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=oZ("t",e);if("d"in e){let n=e.d;if("h"===t){let e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?o$("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):o$("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&oz("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),o8(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):o8(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(oP.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class a_{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class av{constructor(e){this.allowedEvents_=e,this.listeners_={},eB(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(e){eB(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class aw extends av{static getInstance(){return new aw}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||e9()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return eB("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class ab{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function aE(){return new ab("")}function aC(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function aT(e){return e.pieces_.length-e.pieceNum_}function aI(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new ab(e.pieces_,t)}function ax(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function aS(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function ak(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new ab(t,0)}function aA(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof ab)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new ab(n,0)}function aN(e){return e.pieceNum_>=e.pieces_.length}function aR(e,t){let n=aC(e),r=aC(t);if(null===n)return t;if(n===r)return aR(aI(e),aI(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function aP(e,t){if(aT(e)!==aT(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function aD(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(aT(e)>aT(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class aO{constructor(e,t){this.errorPrefix_=t,this.parts_=aS(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=t_(this.parts_[e]);aL(this)}}function aL(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+aM(e))}function aM(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class aF extends av{static getInstance(){return new aF}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return eB("visible"===e,"Unknown event type: "+e),[this.visible_]}}class aU extends a_{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=aU.nextPersistentConnectionId_++,this.log_=oq("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!te())throw Error("Auth override specified in options, but not supported on non Node.js platforms");aF.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&aw.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(ts(i)),eB(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();let t=new e1,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();let i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),eB(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),eB(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");let o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);let i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,i=>{let s=i.d,o=i.s;aU.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&th(e,"w")){let n=tu(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();oz(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||tl(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=ta(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),eB(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);let i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){let i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();let s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ts(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):o$("Unrecognized action received from server: "+ts(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){eB(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+aU.nextConnectionId_++,i=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){eB(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?oV("getToken() completed but was canceled"):(oV("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new ay(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{oz(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},i))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&oz(e),a())}}}interrupt(e){oV("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){oV("Resuming connection for reason: "+e),delete this.interruptReasons_[e],tc(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>o0(e)).join("$"):"default";let r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){let n,r=new ab(e).toString();if(this.listens.has(r)){let e=this.listens.get(r);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(r)}else n=void 0;return n}onAuthRevoked_(e,t){oV("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){oV("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";te()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+ok.replace(/\./g,"-")]=1,e9()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=aw.getInstance().currentlyOnline();return tc(this.interruptReasons_)&&e}}aU.nextPersistentConnectionId_=0,aU.nextConnectionId_=0;class aB{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new aB(e,t)}}class aj{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new aB(oY,e),r=new aB(oY,t);return 0!==this.compare(n,r)}minPost(){return aB.MIN}}class aV extends aj{static get __EMPTY_NODE(){return n}static set __EMPTY_NODE(e){n=e}compare(e,t){return oX(e.name,t.name)}isDefinedOn(e){throw ej("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return aB.MIN}maxPost(){return new aB(oQ,n)}makePost(e,t){return eB("string"==typeof e,"KeyIndex indexValue must always be a string."),new aB(e,n)}toString(){return".key"}}const aq=new aV;class a${constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class aH{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:aH.RED,this.left=null!=r?r:az.EMPTY_NODE,this.right=null!=i?i:az.EMPTY_NODE}copy(e,t,n,r,i){return new aH(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return az.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,r;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return az.EMPTY_NODE;else r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,aH.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,aH.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}aH.RED=!0,aH.BLACK=!1;class az{constructor(e,t=az.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new az(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,aH.BLACK,null,null))}remove(e){return new az(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,aH.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(r)return r.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new a$(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new a$(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new a$(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new a$(this.root_,null,this.comparator_,!0,e)}}function aW(e,t){return oX(e.name,t.name)}function aK(e,t){return oX(e,t)}az.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new aH(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const aG=function(e){return"number"==typeof e?"number:"+o6(e):"string:"+e},aY=function(e){if(e.isLeafNode()){let t=e.val();eB("string"==typeof t||"number"==typeof t||"object"==typeof t&&th(t,".sv"),"Priority must be a string or number.")}else eB(e===r||e.isEmpty(),"priority of unexpected type.");eB(e===r||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class aQ{static set __childrenNodeConstructor(e){i=e}static get __childrenNodeConstructor(){return i}constructor(e,t=aQ.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,eB(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),aY(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new aQ(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:aQ.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return aN(e)?this:".priority"===aC(e)?this.priorityNode_:aQ.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:aQ.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=aC(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(eB(".priority"!==n||1===aT(e),".priority must be the last token in a path"),this.updateImmediateChild(n,aQ.__childrenNodeConstructor.EMPTY_NODE.updateChild(aI(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+aG(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=o6(this.value_):e+=this.value_,this.lazyHash_=oM(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===aQ.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof aQ.__childrenNodeConstructor?-1:(eB(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,r=aQ.VALUE_TYPE_ORDER.indexOf(t),i=aQ.VALUE_TYPE_ORDER.indexOf(n);return(eB(r>=0,"Unknown leaf type: "+t),eB(i>=0,"Unknown leaf type: "+n),r!==i)?i-r:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}aQ.VALUE_TYPE_ORDER=["object","boolean","number","string"];const aX=new class extends aj{compare(e,t){let n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?oX(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return aB.MIN}maxPost(){return new aB(oQ,new aQ("[PRIORITY-POST]",o))}makePost(e,t){return new aB(t,new aQ("[PRIORITY-POST]",s(e)))}toString(){return".priority"}},aJ=Math.log(2);class aZ{constructor(e){this.count=parseInt(Math.log(e+1)/aJ,10),this.current_=this.count-1;let t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}const a0=function(e,t,n,r){e.sort(t);let i=function(t,r){let s,o,a=r-t;if(0===a)return null;if(1===a)return s=e[t],new aH(n?n(s):s,s.node,aH.BLACK,null,null);{let o=parseInt(a/2,10)+t,l=i(t,o),h=i(o+1,r);return s=e[o],new aH(n?n(s):s,s.node,aH.BLACK,l,h)}};return new az(r||t,function(t){let r=null,s=null,o=e.length,a=function(t,r){let s=o-t,a=o;o-=t;let h=i(s+1,a),u=e[s];l(new aH(n?n(u):u,u.node,r,null,h))},l=function(e){r?r.left=e:s=e,r=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,aH.BLACK):(a(r,aH.BLACK),a(r,aH.RED))}return s}(new aZ(e.length)))},a1={};class a2{static get Default(){return eB(a1&&aX,"ChildrenNode.ts has not been loaded"),a=a||new a2({".priority":a1},{".priority":aX})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=tu(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof az?t:null}hasIndex(e){return th(this.indexSet_,e.toString())}addIndex(e,t){let n;eB(e!==aq,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(aB.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();n=i?a0(r,e.getCompare()):a1;let a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;let h=Object.assign({},this.indexes_);return h[a]=n,new a2(h,l)}addToIndexes(e,t){return new a2(td(this.indexes_,(n,r)=>{let i=tu(this.indexSet_,r);if(eB(i,"Missing index implementation for "+r),n===a1)if(!i.isDefinedOn(e.node))return a1;else{let n=[],r=t.getIterator(aB.Wrap),s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),a0(n,i.getCompare())}{let r=t.get(e.name),i=n;return r&&(i=i.remove(new aB(e.name,r))),i.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new a2(td(this.indexes_,n=>{if(n===a1)return n;{let r=t.get(e.name);return r?n.remove(new aB(e.name,r)):n}}),this.indexSet_)}}class a6{static get EMPTY_NODE(){return l||(l=new a6(new az(aK),null,a2.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&aY(this.priorityNode_),this.children_.isEmpty()&&eB(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||l}updatePriority(e){return this.children_.isEmpty()?this:new a6(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?l:t}}getChild(e){let t=aC(e);return null===t?this:this.getImmediateChild(t).getChild(aI(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(eB(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,r,i=new aB(e,t);t.isEmpty()?(n=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(n=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));let s=n.isEmpty()?l:this.priorityNode_;return new a6(n,s,r)}}updateChild(e,t){let n=aC(e);if(null===n)return t;{eB(".priority"!==aC(e)||1===aT(e),".priority must be the last token in a path");let r=this.getImmediateChild(n).updateChild(aI(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,r=0,i=!0;if(this.forEachChild(aX,(s,o)=>{t[s]=o.val(e),n++,i&&a6.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1}),e||!i||!(r<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+aG(this.getPriority().val())+":"),this.forEachChild(aX,(t,n)=>{let r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":oM(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let r=this.resolveIndex_(n);if(!r)return this.children_.getPredecessorKey(e);{let n=r.getPredecessorKey(new aB(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new aB(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new aB(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,aB.Wrap),r=n.peek();for(;null!=r&&0>t.compare(r,e);)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,aB.Wrap),r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===a3?-1:0}withIndex(e){if(e===aq||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new a6(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===aq||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(aX),n=e.getIterator(aX),r=t.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=t.getNext(),i=n.getNext()}return null===r&&null===i}}resolveIndex_(e){return e===aq?null:this.indexMap_.get(e.toString())}}a6.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const a3=new class extends a6{constructor(){super(new az(aK),a6.EMPTY_NODE,a2.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return a6.EMPTY_NODE}isEmpty(){return!1}};function a5(e,t=null){if(null===e)return a6.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),eB(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new aQ(e,a5(t));if(e instanceof Array){let n=a6.EMPTY_NODE;return o2(e,(t,r)=>{if(th(e,t)&&"."!==t.substring(0,1)){let e=a5(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(a5(t))}{let n=[],r=!1;if(o2(e,(e,t)=>{if("."!==e.substring(0,1)){let i=a5(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new aB(e,i)))}}),0===n.length)return a6.EMPTY_NODE;let i=a0(n,aW,e=>e.name,aK);if(!r)return new a6(i,a5(t),a2.Default);{let e=a0(n,aX.getCompare());return new a6(i,a5(t),new a2({".priority":e},{".priority":aX}))}}}Object.defineProperties(aB,{MIN:{value:new aB(oY,a6.EMPTY_NODE)},MAX:{value:new aB(oQ,a3)}}),aV.__EMPTY_NODE=a6.EMPTY_NODE,aQ.__childrenNodeConstructor=a6,r=a3,o=a3,s=a5;class a4 extends aj{constructor(e){super(),this.indexPath_=e,eB(!aN(e)&&".priority"!==aC(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?oX(e.name,t.name):i}makePost(e,t){let n=a5(e);return new aB(t,a6.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new aB(oQ,a6.EMPTY_NODE.updateChild(this.indexPath_,a3))}toString(){return aS(this.indexPath_,0).join("/")}}const a8=new class extends aj{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?oX(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return aB.MIN}maxPost(){return aB.MAX}makePost(e,t){return new aB(t,a5(e))}toString(){return".value"}};function a7(e){return{type:"value",snapshotNode:e}}function a9(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function le(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function lt(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class ln{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){eB(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()||(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(le(t,o)):eB(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(a9(t,n)):s.trackChildChange(lt(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(aX,(e,r)=>{t.hasChild(e)||n.trackChildChange(le(e,r))}),t.isLeafNode()||t.forEachChild(aX,(t,r)=>{if(e.hasChild(t)){let i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(lt(t,r,i))}else n.trackChildChange(a9(t,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?a6.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class lr{constructor(e){this.indexedFilter_=new ln(e.getIndex()),this.index_=e.getIndex(),this.startPost_=lr.getStartPost_(e),this.endPost_=lr.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new aB(t,n))||(n=a6.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=a6.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(a6.EMPTY_NODE);let i=this;return t.forEachChild(aX,(e,t)=>{i.matches(new aB(e,t))||(r=r.updateImmediateChild(e,a6.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}class li{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new lr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return(this.rangedFilter_.matches(new aB(t,n))||(n=a6.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=a6.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=a6.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t))if(this.withinDirectionalEnd(t))r=r.updateImmediateChild(t.name,t.node),n++;else break}}else{let e;r=(r=t.withIndex(this.index_)).updatePriority(a6.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,a6.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();eB(e.numChildren()===this.limit_,"");let o=new aB(t,n),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(e.hasChild(t)){let h=e.getImmediateChild(t),u=r.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=u&&(u.name===t||e.hasChild(u.name));)u=r.getChildAfterChild(this.index_,u,this.reverse_);let c=null==u?1:s(u,o);if(l&&!n.isEmpty()&&c>=0)return null!=i&&i.trackChildChange(lt(t,n,h)),e.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(le(t,h));let n=e.updateImmediateChild(t,a6.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=i&&i.trackChildChange(a9(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:l?s(a,o)>=0?(null!=i&&(i.trackChildChange(le(a.name,a.node)),i.trackChildChange(a9(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(a.name,a6.EMPTY_NODE)):e:e}}class ls{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=aX}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return eB(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(eB(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:oY}hasEnd(){return this.endSet_}getIndexEndValue(){return eB(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(eB(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:oQ}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return eB(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===aX}copy(){let e=new ls;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function lo(e){let t,n={};if(e.isDefault())return n;if(e.index_===aX?t="$priority":e.index_===a8?t="$value":e.index_===aq?t="$key":(eB(e.index_ instanceof a4,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=ts(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=ts(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+ts(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=ts(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+ts(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function la(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==aX&&(t.i=e.index_.toString()),t}class ll extends a_{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(eB(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=oq("p:rest:"),this.listens_={}}listen(e,t,n,r){let i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);let s=ll.getListenId_(e,n),o={};this.listens_[s]=o;let a=lo(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),tu(this.listens_,s)===o){let t;r(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}})}unlisten(e,t){let n=ll.getListenId_(e,t);delete this.listens_[n]}get(e){let t=lo(e._queryParams),n=e._path.toString(),r=new e1;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=ti(o.responseText)}catch(e){oz("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&oz("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class lh{constructor(){this.rootNode_=a6.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function lu(){return{value:null,children:new Map}}function lc(e,t,n){var r,i;null!==e.value?n(t,e.value):(r=e,i=(e,r)=>{lc(r,new ab(t.toString()+"/"+e),n)},r.children.forEach((e,t)=>{i(t,e)}))}class ld{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&o2(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class lf{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new ld(e);let n=1e4+2e4*Math.random();o8(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;o2(e,(e,r)=>{r>0&&th(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),o8(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function lp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function lg(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function lm(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(g=F||(F={}))[g.OVERWRITE=0]="OVERWRITE",g[g.MERGE=1]="MERGE",g[g.ACK_USER_WRITE=2]="ACK_USER_WRITE",g[g.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class ly{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=F.ACK_USER_WRITE,this.source=lp()}operationForChild(e){if(!aN(this.path))return eB(aC(this.path)===e,"operationForChild called for unrelated child."),new ly(aI(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return eB(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new ab(e));return new ly(aE(),t,this.revert)}}}class l_{constructor(e,t){this.source=e,this.path=t,this.type=F.LISTEN_COMPLETE}operationForChild(e){return aN(this.path)?new l_(this.source,aE()):new l_(this.source,aI(this.path))}}class lv{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=F.OVERWRITE}operationForChild(e){return aN(this.path)?new lv(this.source,aE(),this.snap.getImmediateChild(e)):new lv(this.source,aI(this.path),this.snap)}}class lw{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=F.MERGE}operationForChild(e){if(!aN(this.path))return eB(aC(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new lw(this.source,aI(this.path),this.children);{let t=this.children.subtree(new ab(e));return t.isEmpty()?null:t.value?new lv(this.source,aE(),t.value):new lw(this.source,aE(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class lb{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(aN(e))return this.isFullyInitialized()&&!this.filtered_;let t=aC(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class lE{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function lC(e,t,n,r,i,s){let o=r.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw ej("Should only compare child_ events.");let r=new aB(t.childName,t.snapshotNode),i=new aB(n.childName,n.snapshotNode);return e.index_.compare(r,i)})(e,t,n)),o.forEach(n=>{var r,o,a;let l=(r=e,o=n,a=s,"value"===o.type||"child_removed"===o.type||(o.prevName=a.getPredecessorChildName(o.childName,o.snapshotNode,r.index_)),o);i.forEach(r=>{r.respondsTo(n.type)&&t.push(r.createEvent(l,e.query_))})})}function lT(e,t){return{eventCache:e,serverCache:t}}function lI(e,t,n,r){return lT(new lb(t,n,r),e.serverCache)}function lx(e,t,n,r){return lT(e.eventCache,new lb(t,n,r))}function lS(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function lk(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}const lA=()=>(h||(h=new az(oJ)),h);class lN{static fromObject(e){let t=new lN(null);return o2(e,(e,n)=>{t=t.set(new ab(e),n)}),t}constructor(e,t=lA()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:aE(),value:this.value};{if(aN(e))return null;let n=aC(e),r=this.children.get(n);if(null===r)return null;{let i=r.findRootMostMatchingPathAndValue(aI(e),t);return null!=i?{path:aA(new ab(n),i.path),value:i.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(aN(e))return this;{let t=aC(e),n=this.children.get(t);return null!==n?n.subtree(aI(e)):new lN(null)}}set(e,t){if(aN(e))return new lN(t,this.children);{let n=aC(e),r=(this.children.get(n)||new lN(null)).set(aI(e),t),i=this.children.insert(n,r);return new lN(this.value,i)}}remove(e){if(aN(e))if(this.children.isEmpty())return new lN(null);else return new lN(null,this.children);{let t=aC(e),n=this.children.get(t);if(!n)return this;{let r,i=n.remove(aI(e));return(r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty())?new lN(null):new lN(this.value,r)}}}get(e){if(aN(e))return this.value;{let t=aC(e),n=this.children.get(t);return n?n.get(aI(e)):null}}setTree(e,t){if(aN(e))return t;{let n,r=aC(e),i=(this.children.get(r)||new lN(null)).setTree(aI(e),t);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new lN(this.value,n)}}fold(e){return this.fold_(aE(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(aA(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,aE(),t)}findOnPath_(e,t,n){let r=!!this.value&&n(t,this.value);if(r)return r;{if(aN(e))return null;let r=aC(e),i=this.children.get(r);return i?i.findOnPath_(aI(e),aA(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,aE(),t)}foreachOnPath_(e,t,n){if(aN(e))return this;{this.value&&n(t,this.value);let r=aC(e),i=this.children.get(r);return i?i.foreachOnPath_(aI(e),aA(t,r),n):new lN(null)}}foreach(e){this.foreach_(aE(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(aA(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class lR{constructor(e){this.writeTree_=e}static empty(){return new lR(new lN(null))}}function lP(e,t,n){if(aN(t))return new lR(new lN(n));{let r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){let i=r.path,s=r.value,o=aR(i,t);return s=s.updateChild(o,n),new lR(e.writeTree_.set(i,s))}{let r=new lN(n);return new lR(e.writeTree_.setTree(t,r))}}}function lD(e,t,n){let r=e;return o2(n,(e,n)=>{r=lP(r,aA(t,e),n)}),r}function lO(e,t){return aN(t)?lR.empty():new lR(e.writeTree_.setTree(t,new lN(null)))}function lL(e,t){return null!=lM(e,t)}function lM(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(aR(n.path,t)):null}function lF(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(aX,(e,n)=>{t.push(new aB(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new aB(e,n.value))}),t}function lU(e,t){if(aN(t))return e;{let n=lM(e,t);return new lR(null!=n?new lN(n):e.writeTree_.subtree(t))}}function lB(e){return e.writeTree_.isEmpty()}function lj(e,t){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);{let i=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?(eB(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):r=e(aA(t,n),s,r)}),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(aA(t,".priority"),i)),r}}(aE(),e.writeTree_,t)}function lV(e){return e.visible}function lq(e,t,n){let r=lR.empty();for(let i=0;i<e.length;++i){let s=e[i];if(t(s)){let e,t=s.path;if(s.snap)aD(n,t)?r=lP(r,e=aR(n,t),s.snap):aD(t,n)&&(e=aR(t,n),r=lP(r,aE(),s.snap.getChild(e)));else if(s.children){if(aD(n,t))r=lD(r,e=aR(n,t),s.children);else if(aD(t,n))if(aN(e=aR(t,n)))r=lD(r,aE(),s.children);else{let t=tu(s.children,aC(e));if(t){let n=t.getChild(aI(e));r=lP(r,aE(),n)}}}else throw ej("WriteRecord should have .snap or .children")}}return r}function l$(e,t,n,r,i){if(r||i){let s=lU(e.visibleWrites,t);return!i&&lB(s)?n:i||null!=n||lL(s,aE())?lj(lq(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(aD(e.path,t)||aD(t,e.path))},t),n||a6.EMPTY_NODE):null}{let r=lM(e.visibleWrites,t);if(null!=r)return r;{let r=lU(e.visibleWrites,t);return lB(r)?n:null!=n||lL(r,aE())?lj(r,n||a6.EMPTY_NODE):null}}}function lH(e,t,n,r){return l$(e.writeTree,e.treePath,t,n,r)}function lz(e,t){return function(e,t,n){let r=a6.EMPTY_NODE,i=lM(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(aX,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(!n)return lF(lU(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r;{let i=lU(e.visibleWrites,t);return n.forEachChild(aX,(e,t)=>{let n=lj(lU(i,new ab(e)),t);r=r.updateImmediateChild(e,n)}),lF(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}}(e.writeTree,e.treePath,t)}function lW(e,t,n,r){return function(e,t,n,r,i){eB(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=aA(t,n);if(lL(e.visibleWrites,s))return null;{let t=lU(e.visibleWrites,s);return lB(t)?i.getChild(n):lj(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function lK(e,t){var n,r;return n=e.writeTree,r=aA(e.treePath,t),lM(n.visibleWrites,r)}function lG(e,t,n){return function(e,t,n,r){let i=aA(t,n),s=lM(e.visibleWrites,i);return null!=s?s:r.isCompleteForChild(n)?lj(lU(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function lY(e,t){return lQ(aA(e.treePath,t),e.writeTree)}function lQ(e,t){return{treePath:e,writeTree:t}}class lX{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;eB("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),eB(".priority"!==n,"Only non-priority child changes can be tracked.");let r=this.changeMap.get(n);if(r){let i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,lt(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,le(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,a9(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===i)this.changeMap.set(n,lt(n,e.snapshotNode,r.oldSnap));else throw ej("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const lJ=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class lZ{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new lb(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return lG(this.writes_,e,t)}}getChildAfterChild(e,t,n){var r;let i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:lk(this.viewCache_),s=(r=this.writes_,function(e,t,n,r,i,s,o){let a,l=lU(e.visibleWrites,t),h=lM(l,aE());if(null!=h)a=h;else{if(null==n)return[];a=lj(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),i=n.getNext();for(;i&&e.length<1;)0!==t(i,r)&&e.push(i),i=n.getNext();return e}}(r.writeTree,r.treePath,i,t,1,n,e));return 0===s.length?null:s[0]}}function l0(e,t,n,r,i,s){let o=t.eventCache;if(null!=lK(r,n))return t;{let a,l;if(aN(n))if(eB(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=lk(t),i=lz(r,n instanceof a6?n:a6.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{let n=lH(r,lk(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let h=aC(n);if(".priority"===h){eB(1===aT(n),"Can't have a priority with additional path components");let i=o.getNode(),s=lW(r,n,i,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{let u,c=aI(n);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=lW(r,n,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(h).updateChild(c,e):o.getNode().getImmediateChild(h)}else u=lG(r,h,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),h,u,c,i,s):o.getNode()}}return lI(t,a,o.isFullyInitialized()||aN(n),e.filter.filtersNodes())}}function l1(e,t,n,r,i,s,o,a){let l,h=t.serverCache,u=o?e.filter:e.filter.getIndexedFilter();if(aN(n))l=u.updateFullNode(h.getNode(),r,null);else if(u.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,r);l=u.updateFullNode(h.getNode(),e,null)}else{let e=aC(n);if(!h.isCompleteForPath(n)&&aT(n)>1)return t;let i=aI(n),s=h.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?u.updatePriority(h.getNode(),s):u.updateChild(h.getNode(),e,s,i,lJ,null)}let c=lx(t,l,h.isFullyInitialized()||aN(n),u.filtersNodes()),d=new lZ(i,c,s);return l0(e,c,n,i,d,a)}function l2(e,t,n,r,i,s,o){let a,l,h=t.eventCache,u=new lZ(i,t,s);if(aN(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,o),a=lI(t,l,!0,e.filter.filtersNodes());else{let i=aC(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),a=lI(t,l,h.isFullyInitialized(),h.isFiltered());else{let s,l=aI(n),c=h.getNode().getImmediateChild(i);if(aN(l))s=r;else{let e=u.getCompleteChild(i);s=null!=e?".priority"===ax(l)&&e.getChild(ak(l)).isEmpty()?e:e.updateChild(l,r):a6.EMPTY_NODE}a=c.equals(s)?t:lI(t,e.filter.updateChild(h.getNode(),i,s,l,u,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function l6(e,t){return e.eventCache.isCompleteForChild(t)}function l3(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function l5(e,t,n,r,i,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=aN(n)?r:new lN(null).setTree(n,r);let u=t.serverCache.getNode();return l.children.inorderTraversal((n,r)=>{if(u.hasChild(n)){let l=l3(e,t.serverCache.getNode().getImmediateChild(n),r);h=l1(e,h,new ab(n),l,i,s,o,a)}}),l.children.inorderTraversal((n,r)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!u.hasChild(n)&&!l){let l=l3(e,t.serverCache.getNode().getImmediateChild(n),r);h=l1(e,h,new ab(n),l,i,s,o,a)}}),h}class l4{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let n=this.query_._queryParams,r=new ln(n.getIndex()),i=n.loadsAllData()?new ln(n.getIndex()):n.hasLimit()?new li(n):new lr(n);this.processor_={filter:i};let s=t.serverCache,o=t.eventCache,a=r.updateFullNode(a6.EMPTY_NODE,s.getNode(),null),l=i.updateFullNode(a6.EMPTY_NODE,o.getNode(),null),h=new lb(a,s.isFullyInitialized(),r.filtersNodes()),u=new lb(l,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=lT(u,h),this.eventGenerator_=new lE(this.query_)}get query(){return this.query_}}function l8(e){return 0===e.eventRegistrations_.length}function l7(e,t,n){let r=[];if(n){eB(null==t,"A cancel should cancel all event registrations.");let i=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,i);t&&r.push(t)})}if(t){let n=[];for(let r=0;r<e.eventRegistrations_.length;++r){let i=e.eventRegistrations_[r];if(i.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(r+1));break}}else n.push(i)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function l9(e,t,n,r){var i,s;t.type===F.MERGE&&null!==t.source.queryId&&(eB(lk(e.viewCache_),"We should always have a full cache before handling merges"),eB(lS(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,r,i){let s,o,a=new lX;if(n.type===F.OVERWRITE)n.source.fromUser?s=l2(e,t,n.path,n.snap,r,i,a):(eB(n.source.fromServer,"Unknown source."),o=n.source.tagged||t.serverCache.isFiltered()&&!aN(n.path),s=l1(e,t,n.path,n.snap,r,i,o,a));else if(n.type===F.MERGE){var l,h,u,c,d,f,p;let g;n.source.fromUser?(l=e,h=t,u=n.path,c=n.children,d=r,f=i,p=a,g=h,c.foreach((e,t)=>{let n=aA(u,e);l6(h,aC(n))&&(g=l2(l,g,n,t,d,f,p))}),c.foreach((e,t)=>{let n=aA(u,e);l6(h,aC(n))||(g=l2(l,g,n,t,d,f,p))}),s=g):(eB(n.source.fromServer,"Unknown source."),o=n.source.tagged||t.serverCache.isFiltered(),s=l5(e,t,n.path,n.children,r,i,o,a))}else if(n.type===F.ACK_USER_WRITE)s=n.revert?function(e,t,n,r,i,s){let o;if(null!=lK(r,n))return t;{let a,l=new lZ(r,t,i),h=t.eventCache.getNode();if(aN(n)||".priority"===aC(n)){let n;if(t.serverCache.isFullyInitialized())n=lH(r,lk(t));else{let e=t.serverCache.getNode();eB(e instanceof a6,"serverChildren would be complete if leaf node"),n=lz(r,e)}a=e.filter.updateFullNode(h,n,s)}else{let i=aC(n),u=lG(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=h.getImmediateChild(i)),(a=null!=u?e.filter.updateChild(h,i,u,aI(n),l,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(h,i,a6.EMPTY_NODE,aI(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=lH(r,lk(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=lK(r,aE()),lI(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,r,i,a):function(e,t,n,r,i,s,o){if(null!=lK(i,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value)if(aN(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return l1(e,t,n,l.getNode().getChild(n),i,s,a,o);else{if(!aN(n))return t;let r=new lN(null);return l.getNode().forEachChild(aq,(e,t)=>{r=r.set(new ab(e),t)}),l5(e,t,n,r,i,s,a,o)}{let h=new lN(null);return r.foreach((e,t)=>{let r=aA(n,e);l.isCompleteForPath(r)&&(h=h.set(e,l.getNode().getChild(r)))}),l5(e,t,n,h,i,s,a,o)}}(e,t,n.path,n.affectedTree,r,i,a);else if(n.type===F.LISTEN_COMPLETE)s=function(e,t,n,r,i){let s=t.serverCache;return l0(e,lx(t,s.getNode(),s.isFullyInitialized()||aN(n),s.isFiltered()),n,r,lJ,i)}(e,t,n.path,r,a);else throw ej("Unknown operation type: "+n.type);let g=a.getChanges();return function(e,t,n){let r=t.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=lS(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!i||r.getNode().equals(s))&&r.getNode().getPriority().equals(s.getPriority())||n.push(a7(lS(t)))}}(t,s,g),{viewCache:s,changes:g}}(e.processor_,o,t,n,r);return i=e.processor_,eB((s=a.viewCache).eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),eB(s.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),eB(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,he(e,a.changes,a.viewCache.eventCache.getNode(),null)}function he(e,t,n,r){let i=r?[r]:e.eventRegistrations_;var s=e.eventGenerator_;let o=[],a=[];return t.forEach(e=>{var t;"child_changed"===e.type&&s.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&a.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),lC(s,o,"child_removed",t,i,n),lC(s,o,"child_added",t,i,n),lC(s,o,"child_moved",a,i,n),lC(s,o,"child_changed",t,i,n),lC(s,o,"value",t,i,n),o}class ht{constructor(){this.views=new Map}}function hn(e,t,n,r){let i=t.source.queryId;if(null!==i){let s=e.views.get(i);return eB(null!=s,"SyncTree gave us an op for an invalid query."),l9(s,t,n,r)}{let i=[];for(let s of e.views.values())i=i.concat(l9(s,t,n,r));return i}}function hr(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function hi(e,t){let n=null;for(let r of e.views.values())n=n||function(e,t){let n=lk(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!aN(t)&&!n.getImmediateChild(aC(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function hs(e,t){if(t._queryParams.loadsAllData())return ha(e);{let n=t._queryIdentifier;return e.views.get(n)}}function ho(e){return null!=ha(e)}function ha(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let hl=1;class hh{constructor(e){this.listenProvider_=e,this.syncPointTree_=new lN(null),this.pendingWriteTree_={visibleWrites:lR.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function hu(e,t,n=!1){let r=function(e,t){for(let n=0;n<e.allWrites.length;n++){let r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let r=e.allWrites.findIndex(e=>e.writeId===t);eB(r>=0,"removeWrite called with nonexistent writeId.");let i=e.allWrites[r];e.allWrites.splice(r,1);let s=i.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=r&&function(e,t){if(e.snap)return aD(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&aD(aA(e.path,n),t))return!0;return!1}(t,i.path)?s=!1:aD(i.path,t.path)&&(o=!0)),a--}return!!s&&(o?((n=e).visibleWrites=lq(n.allWrites,lV,aE()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):i.snap?e.visibleWrites=lO(e.visibleWrites,i.path):o2(i.children,t=>{e.visibleWrites=lO(e.visibleWrites,aA(i.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new lN(null);return null!=r.snap?t=t.set(aE(),!0):o2(r.children,e=>{t=t.set(new ab(e),!0)}),hg(e,new ly(r.path,t,n))}}function hc(e,t,n){return hg(e,new lv(lg(),t,n))}function hd(e,t,n,r,i=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=hs(o,t))){let c=function(e,t,n,r){let i=t._queryIdentifier,s=[],o=[],a=ho(e);if("default"===i)for(let[t,i]of e.views.entries())o=o.concat(l7(i,n,r)),l8(i)&&(e.views.delete(t),i.query._queryParams.loadsAllData()||s.push(i.query));else{let t=e.views.get(i);t&&(o=o.concat(l7(t,n,r)),l8(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!ho(e)&&s.push(new(eB(u,"Reference.ts has not been loaded"),u)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let d=c.removed;if(a=c.events,!i){let n=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),i=e.syncPointTree_.findOnPath(s,(e,t)=>ho(t));if(n&&!i){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&ho(t))return[ha(t)];{let e=[];return t&&(e=hr(t)),o2(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let r=n[t],i=r.query,s=hm(e,r);e.listenProvider_.startListening(hE(i),hy(e,i),s.hashFn,s.onComplete)}}}i||!(d.length>0)||r||(n?e.listenProvider_.stopListening(hE(t),null):d.forEach(t=>{let n=e.queryToTagMap.get(h_(t));e.listenProvider_.stopListening(hE(t),n)}))}var l=e,h=d;for(let e=0;e<h.length;++e){let t=h[e];if(!t._queryParams.loadsAllData()){let e=h_(t),n=l.queryToTagMap.get(e);l.queryToTagMap.delete(e),l.tagToQueryMap.delete(n)}}}return a}function hf(e,t,n,r=!1){let i,s=t._path,o=null,a=!1;e.syncPointTree_.foreachOnPath(s,(e,t)=>{let n=aR(e,s);o=o||hi(t,n),a=a||ho(t)});let l=e.syncPointTree_.get(s);l?(a=a||ho(l),o=o||hi(l,aE())):(l=new ht,e.syncPointTree_=e.syncPointTree_.set(s,l)),null!=o?i=!0:(i=!1,o=a6.EMPTY_NODE,e.syncPointTree_.subtree(s).foreachChild((e,t)=>{let n=hi(t,aE());n&&(o=o.updateImmediateChild(e,n))}));let h=null!=hs(l,t);if(!h&&!t._queryParams.loadsAllData()){let n=h_(t);eB(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let r=hl++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let u=function(e,t,n,r,i,s){let o=function(e,t,n,r,i){let s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=lH(n,i?r:null),s=!1;return e?s=!0:(e=r instanceof a6?lz(n,r):a6.EMPTY_NODE,s=!1),new l4(t,lT(new lb(e,s,!1),new lb(r,i,!1)))}return o}(e,t,r,i,s);e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n);let a=o.viewCache_.eventCache,l=[];return a.getNode().isLeafNode()||a.getNode().forEachChild(aX,(e,t)=>{l.push(a9(e,t))}),a.isFullyInitialized()&&l.push(a7(a.getNode())),he(o,l,a.getNode(),n)}(l,t,n,lQ(s,e.pendingWriteTree_),o,i);if(!h&&!a&&!r){let n=hs(l,t);u=u.concat(function(e,t,n){let r=t._path,i=hy(e,t),s=hm(e,n),o=e.listenProvider_.startListening(hE(t),i,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(r);if(i)eB(!ho(a.value),"If we're adding a query, it shouldn't be shadowed");else{let t=a.fold((e,t,n)=>{if(!aN(e)&&t&&ho(t))return[ha(t).query];{let e=[];return t&&(e=e.concat(hr(t).map(e=>e.query))),o2(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let r=t[n];e.listenProvider_.stopListening(hE(r),hy(e,r))}}return o}(e,t,n))}return u}function hp(e,t,n){let r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{let r=hi(n,aR(e,t));if(r)return r});return l$(r,t,i,n,!0)}function hg(e,t){var n;return function e(t,n,r,i){if(aN(t.path))return function e(t,n,r,i){let s=n.get(aE());null==r&&null!=s&&(r=hi(s,aE()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=r?r.getImmediateChild(n):null,l=lY(i,n),h=t.operationForChild(n);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(hn(s,t,i,r))),o}(t,n,r,i);{let s=n.get(aE());null==r&&null!=s&&(r=hi(s,aE()));let o=[],a=aC(t.path),l=t.operationForChild(a),h=n.children.get(a);if(h&&l){let t=r?r.getImmediateChild(a):null,n=lY(i,a);o=o.concat(e(l,h,t,n))}return s&&(o=o.concat(hn(s,t,i,r))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,lQ(aE(),n)))}function hm(e,t){let n=t.query,r=hy(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||a6.EMPTY_NODE).hash(),onComplete:t=>{if("ok"===t)if(r)return function(e,t,n){let r=hv(e,n);if(!r)return[];{let n=hw(r),i=n.path,s=n.queryId,o=aR(i,t);return hb(e,i,new l_(lm(s),o))}}(e,n._path,r);else{var i;return i=n._path,hg(e,new l_(lg(),i))}{let r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");let r=Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(t,n);return hd(e,n,null,r)}}}}function hy(e,t){let n=h_(t);return e.queryToTagMap.get(n)}function h_(e){return e._path.toString()+"$"+e._queryIdentifier}function hv(e,t){return e.tagToQueryMap.get(t)}function hw(e){let t=e.indexOf("$");return eB(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new ab(e.substr(0,t))}}function hb(e,t,n){let r=e.syncPointTree_.get(t);return eB(r,"Missing sync point for query tag that we're tracking"),hn(r,n,lQ(t,e.pendingWriteTree_),null)}function hE(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(eB(c,"Reference.ts has not been loaded"),c)(e._repo,e._path):e}class hC{constructor(e){this.node_=e}getImmediateChild(e){return new hC(this.node_.getImmediateChild(e))}node(){return this.node_}}class hT{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=aA(this.path_,e);return new hT(this.syncTree_,t)}node(){return hp(this.syncTree_,this.path_)}}const hI=function(e,t,n){return e&&"object"==typeof e?(eB(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?hx(e[".sv"],t,n):"object"==typeof e[".sv"]?hS(e[".sv"],t):void eB(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},hx=function(e,t,n){if("timestamp"===e)return n.timestamp;eB(!1,"Unexpected server value: "+e)},hS=function(e,t,n){e.hasOwnProperty("increment")||eB(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let r=e.increment;"number"!=typeof r&&eB(!1,"Unexpected increment value: "+r);let i=t.node();if(eB(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let s=i.getValue();return"number"!=typeof s?r:s+r};function hk(e,t,n){let r,i=hI(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return r=e,i!==e.getPriority().val()&&(r=r.updatePriority(new aQ(i))),e.forEachChild(aX,(e,i)=>{let s=hk(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))}),r;{let r=hI(e.getValue(),t,n);return r!==e.getValue()||i!==e.getPriority().val()?new aQ(r,a5(i)):e}}class hA{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function hN(e,t){let n=t instanceof ab?t:new ab(t),r=e,i=aC(n);for(;null!==i;){let e=tu(r.node.children,i)||{children:{},childCount:0};r=new hA(i,r,e),i=aC(n=aI(n))}return r}function hR(e){return e.node.value}function hP(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,r){let i=void 0===hR(r)&&!hD(r),s=th(t.node.children,n);i&&s?(delete t.node.children[n],t.node.childCount--,e(t)):i||s||(t.node.children[n]=r.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function hD(e){return e.node.childCount>0}function hO(e,t){o2(e.node.children,(n,r)=>{t(new hA(n,e,r))})}function hL(e){return new ab(null===e.parent?e.name:hL(e.parent)+"/"+e.name)}const hM=/[\[\].#$\/\u0000-\u001F\u007F]/,hF=/[\[\].#$\u0000-\u001F\u007F]/,hU=function(e){return"string"==typeof e&&0!==e.length&&!hM.test(e)},hB=function(e){return"string"==typeof e&&0!==e.length&&!hF.test(e)},hj=function(e,t,n){let r=n instanceof ab?new aO(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+aM(r));if("function"==typeof t)throw Error(e+"contains a function "+aM(r)+" with contents = "+t.toString());if(oK(t))throw Error(e+"contains "+t.toString()+" "+aM(r));if("string"==typeof t&&t.length>0xa00000/3&&t_(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+aM(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(o2(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!hU(t)))throw Error(e+" contains an invalid key ("+t+") "+aM(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(t),r.byteLength_+=t_(t),aL(r),hj(e,s,r);let o=r.parts_.pop();r.byteLength_-=t_(o),r.parts_.length>0&&(r.byteLength_-=1)}),n&&i)throw Error(e+' contains ".value" child '+aM(r)+" in addition to actual children.")}},hV=function(e,t,n,r){if((!r||void 0!==n)&&!hB(n))throw Error(tm(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},hq=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),hV(e,t,n,r)},h$=function(e,t){var n;let r=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!hU(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==r.length&&((n=r)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!hB(n)))throw Error(tm(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class hH{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function hz(e,t){let n=null;for(let r=0;r<t.length;r++){let i=t[r],s=i.getPath();null===n||aP(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function hW(e,t,n){hz(e,n),hG(e,e=>aP(e,t))}function hK(e,t,n){hz(e,n),hG(e,e=>aD(e,t)||aD(t,e))}function hG(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){let i=e.eventLists_[r];i&&(t(i.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let r=n.getEventRunner();oU&&oV("event: "+n.toString()),o4(r)}}}(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}class hY{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new hH,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=lu(),this.transactionQueueTree_=new hA,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function hQ(e){var t;return(t=t={timestamp:function(e){let t=e.infoData_.getNode(new ab(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}(e)}).timestamp=t.timestamp||new Date().getTime(),t}function hX(e,t,n,r,i){e.dataUpdateCount++;let s=new ab(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){let t=td(n,e=>a5(e));o=function(e,t,n,r){let i=hv(e,r);if(!i)return[];{let r=hw(i),s=r.path,o=r.queryId,a=aR(s,t),l=lN.fromObject(n);return hb(e,s,new lw(lm(o),a,l))}}(e.serverSyncTree_,s,t,i)}else{let t=a5(n);o=function(e,t,n,r){let i=hv(e,r);if(null==i)return[];{let r=hw(i),s=r.path,o=r.queryId,a=aR(s,t);return hb(e,s,new lv(lm(o),a,n))}}(e.serverSyncTree_,s,t,i)}else if(r){let t=td(n,e=>a5(e));o=function(e,t,n){let r=lN.fromObject(n);return hg(e,new lw(lg(),t,r))}(e.serverSyncTree_,s,t)}else{let t=a5(n);o=hc(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=h6(e,s)),hK(e.eventQueue_,a,o)}function hJ(e,t){hZ(e,"connected",t),!1===t&&function(e){h1(e,"onDisconnectEvents");let t=hQ(e),n=lu();lc(e.onDisconnect_,aE(),(r,i)=>{var s;let o=(s=e.serverSyncTree_,hk(i,new hT(s,r),t));!function e(t,n,r){if(aN(n))t.value=r,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(n,r);else{let i=aC(n);t.children.has(i)||t.children.set(i,lu()),e(t.children.get(i),n=aI(n),r)}}(n,r,o)});let r=[];lc(n,aE(),(t,n)=>{r=r.concat(hc(e.serverSyncTree_,t,n));let i=function(e,t){let n=hL(h3(e,t)),r=hN(e.transactionQueueTree_,t);return!function(e,t,n){let r=e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(r,t=>{h8(e,t)}),h8(e,r),!function e(t,n,r,i){r&&!i&&n(t),hO(t,t=>{e(t,n,!0,i)}),r&&i&&n(t)}(r,t=>{h8(e,t)}),n}(e,t);h6(e,i)}),e.onDisconnect_=lu(),hK(e.eventQueue_,aE(),r)}(e)}function hZ(e,t,n){let r=new ab("/.info/"+t),i=a5(n);e.infoData_.updateSnapshot(r,i);let s=hc(e.infoSyncTree_,r,i);hK(e.eventQueue_,r,s)}function h0(e,t,n){let r;r=".info"===aC(t._path)?hd(e.infoSyncTree_,t,n):hd(e.serverSyncTree_,t,n),hW(e.eventQueue_,t._path,r)}function h1(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),oV(n,...t)}function h2(e,t,n){return hp(e.serverSyncTree_,t,n)||a6.EMPTY_NODE}function h6(e,t){let n=h3(e,t),r=hL(n),i=h5(e,n);return function(e,t,n){if(0===t.length)return;let r=[],i=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=aR(n,a.path),h=!1,u;if(eB(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,u=a.abortReason,i=i.concat(hu(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)h=!0,u="maxretry",i=i.concat(hu(e.serverSyncTree_,a.currentWriteId,!0));else{let n=h2(e,a.path,s);a.currentInputSnapshot=n;let r=t[o].update(n.val());if(void 0!==r){hj("transaction failed: Data returned ",r,a.path);let t=a5(r);"object"==typeof r&&null!=r&&th(r,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=hQ(e),h=hk(t,new hC(n),l);a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=h,a.currentWriteId=e.nextWriteId_++,s.splice(s.indexOf(o),1),i=(i=i.concat(function(e,t,n,r,i){var s,o;return(s=e.pendingWriteTree_,o=i,eB(r>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:r,visible:o}),o&&(s.visibleWrites=lP(s.visibleWrites,t,n)),s.lastWriteId=r,i)?hg(e,new lv(lp(),t,n)):[]}(e.serverSyncTree_,a.path,h,a.currentWriteId,a.applyLocally))).concat(hu(e.serverSyncTree_,o,!0))}else h=!0,u="nodata",i=i.concat(hu(e.serverSyncTree_,a.currentWriteId,!0))}hK(e.eventQueue_,n,i),i=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===u?r.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):r.push(()=>t[o].onComplete(Error(u),!1,null))))}h4(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)o4(r[e]);!function e(t,n=t.transactionQueueTree_){if(n||h4(t,n),hR(n)){let r=h5(t,n);eB(r.length>0,"Sending zero length transaction queue"),r.every(e=>0===e.status)&&function(t,n,r){let i=h2(t,n,r.map(e=>e.currentWriteId)),s=i,o=i.hash();for(let e=0;e<r.length;e++){let t=r[e];eB(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let i=aR(n,t.path);s=s.updateChild(i,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,i=>{h1(t,"transaction put response",{path:n.toString(),status:i});let s=[];if("ok"===i){let i=[];for(let e=0;e<r.length;e++)r[e].status=2,s=s.concat(hu(t.serverSyncTree_,r[e].currentWriteId)),r[e].onComplete&&i.push(()=>r[e].onComplete(null,!0,r[e].currentOutputSnapshotResolved)),r[e].unwatcher();h4(t,hN(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),hK(t.eventQueue_,n,s);for(let e=0;e<i.length;e++)o4(i[e])}else{if("datastale"===i)for(let e=0;e<r.length;e++)3===r[e].status?r[e].status=4:r[e].status=0;else{oz("transaction at "+n.toString()+" failed: "+i);for(let e=0;e<r.length;e++)r[e].status=4,r[e].abortReason=i}h6(t,n)}},o)}(t,hL(n),r)}else hD(n)&&hO(n,n=>{e(t,n)})}(e,e.transactionQueueTree_)}(e,i,r),r}function h3(e,t){let n,r=e.transactionQueueTree_;for(n=aC(t);null!==n&&void 0===hR(r);)r=hN(r,n),n=aC(t=aI(t));return r}function h5(e,t){let n=[];return function e(t,n,r){let i=hR(n);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);hO(n,n=>{e(t,n,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function h4(e,t){let n=hR(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,hP(t,n.length>0?n:void 0)}hO(t,t=>{h4(e,t)})}function h8(e,t){let n=hR(t);if(n){let r=[],i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(eB(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(eB(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(hu(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?hP(t,void 0):n.length=s+1,hK(e.eventQueue_,hL(t),i);for(let e=0;e<r.length;e++)o4(r[e])}}const h7=function(e,t){let n=h9(e),r=n.namespace;"firebase.com"===n.domain&&oH(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||oH("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||oW();let i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new ai(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new ab(n.pathString)}},h9=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let u=e.indexOf("/");-1===u&&(u=e.length);let c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(u,c)),u<c&&(i=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let r=n[e];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}(e.substring(u,c)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):oz(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,c)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let f=t.slice(0,h);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{let e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};class ue{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ts(this.snapshot.exportVal())}}class ut{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class un{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return eB(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class ur{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return aN(this._path)?null:ax(this._path)}get ref(){return new ui(this._repo,this._path)}get _queryIdentifier(){let e=o0(la(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return la(this._queryParams)}isEqual(e){if(!((e=tv(e))instanceof ur))return!1;let t=this._repo===e._repo,n=aP(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class ui extends ur{constructor(e,t){super(e,t,new ls,!1)}get parent(){let e=ak(this._path);return null===e?null:new ui(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class us{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new ab(e),n=uo(this.ref,e);return new us(this._node.getChild(t),n,aX)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new us(n,uo(this.ref,t),aX)))}hasChild(e){let t=new ab(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function uo(e,t){return null===aC((e=tv(e))._path)?hq("child","path",t,!1):hV("child","path",t,!1),new ui(e._repo,aA(e._path,t))}class ua{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new ue("value",this,new us(e.snapshotNode,new ui(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ut(this,e,t):null}matches(e){return e instanceof ua&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class ul{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ut(this,e,t):null}createEvent(e,t){eB(null!=e.childName,"Child events should have a childName.");let n=uo(new ui(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new ue(e.type,this,new us(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof ul&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}eB(!u,"__referenceConstructor has already been defined"),u=ui,eB(!c,"__referenceConstructor has already been defined"),c=ui;const uh={};class uu{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){if(e.stats_=ah(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new ll(e.repoInfo_,(t,n,r,i)=>{hX(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>hJ(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{ts(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new aU(e.repoInfo_,t,(t,n,r,i)=>{hX(e,t,n,r,i)},t=>{hJ(e,t)},t=>{var n;n=e,o2(t,(e,t)=>{hZ(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){let n=e.toString();return al[n]||(al[n]=t()),al[n]}(e.repoInfo_,()=>new lf(e.stats_,e.server_)),e.infoData_=new lh,e.infoSyncTree_=new hh({startListening:(t,n,r,i)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=hc(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),hZ(e,"connected",!1),e.serverSyncTree_=new hh({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{let s=i(n,r);hK(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ui(this._repo,aE())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){let n=uh[t];n&&n[e.key]===e||oH(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&oH("Cannot call "+e+" on a deleted database.")}}aU.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},aU.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},ok=t3,tZ(new tw("database",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app").getImmediate();return function(e,t,n,r,i){var s,o,a,l;let h,u,c,d,f=r||e.options.databaseURL;void 0===f&&(e.options.projectId||oH("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),oV("Using default host for project ",e.options.projectId),f=`${e.options.projectId}-default-rtdb.firebaseio.com`);let p=h7(f,void 0),g=p.repoInfo;c?(d=!0,g=(p=h7(f=`http://${c}?ns=${g.namespace}`,void 0)).repoInfo):d=!p.repoInfo.secure;let m=i&&d?new ae(ae.OWNER):new o9(e.name,e.options,t);return h$("Invalid Firebase Database URL",p),aN(p.path)||oH("Database URL must point to the root of a Firebase Database (not including a child path)."),new uu((s=g,o=e,a=m,l=new o7(e,n),(h=uh[o.name])||(h={},uh[o.name]=h),(u=h[s.toURLString()])&&oH("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),u=new hY(s,!1,a,l),h[s.toURLString()]=u,u),e)}(n,e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),t8(ox,oS,void 0),t8(ox,oS,"esm2017");const uc=t5({apiKey:"rLnpaxAfuKe7ZPMFtiuNllAevzlv6qd04ozuBUqC",authDomain:"ejercicio-backend.firebaseapp.com",projectId:"ejercicio-backend",databaseURL:"https://ejercicio-backend-default-rtdb.firebaseio.com/"});var ud,uf=uc;const up=t0("object"==typeof uf?uf:t4(),"firestore").getImmediate({identifier:"string"==typeof uf?uf:rJ});if(!up._initialized){let e=eZ("firestore");e&&function(e,t,n,r={}){var i;e=function(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ri(rr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=function(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":re(12329,{type:typeof e})}(e);throw new ri(rr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}(e,oh);let s=e2(t),o=e._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${n}`;s&&(e6(`https://${l}`),e8("Firestore",!0)),o.host!==oa&&o.host!==l&&n7("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=Object.assign(Object.assign({},o),{host:l,ssl:s,emulatorOptions:r});if(!tf(h,a)&&(e._setSettings(h),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=n2.MOCK_USER;else{t=e3(r.mockUserToken,null==(i=e._app)?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new ri(rr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new n2(s)}e._authCredentials=new rl(new ro(t,n))}}(up,...e)}const ug=function(e=t4(),t){let n=t0(e,"database").getImmediate({identifier:void 0});if(!n._instanceStarted){let e=eZ("database");e&&function(e,t,n,r={}){let i;(e=tv(e))._checkNotDeleted("useEmulator");let s=`${t}:${n}`,o=e._repoInternal;if(e._instanceStarted){if(s===e._repoInternal.repoInfo_.host&&tf(r,o.repoInfo_.emulatorOptions))return;oH("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}o.repoInfo_.nodeAdmin?(r.mockUserToken&&oH('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),i=new ae(ae.OWNER)):r.mockUserToken&&(i=new ae("string"==typeof r.mockUserToken?r.mockUserToken:e3(r.mockUserToken,e.app.options.projectId))),e2(t)&&(e6(t),e8("Database",!0));var a=i;let l=s.lastIndexOf(":"),h=e2(s.substring(0,l));o.repoInfo_=new ai(s,h,o.repoInfo_.namespace,o.repoInfo_.webSocketOnly,o.repoInfo_.nodeAdmin,o.repoInfo_.persistenceKey,o.repoInfo_.includeNamespaceInQueryParams,!0,r),a&&(o.authTokenProvider_=a)}(n,...e)}return n}(uc);var um={},uy={};uy=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};var u_={},uv={},uw={},ub={},uE={},uC={};uC=function(){this.__data__=[],this.size=0};var uT={},uI={},ux={};ux=function(e,t){return e===t||e!=e&&t!=t},uI=function(e,t){for(var n=e.length;n--;)if(ux(e[n][0],t))return n;return -1};var uS=Array.prototype.splice;uT=function(e){var t=this.__data__,n=uI(t,e);return!(n<0)&&(n==t.length-1?t.pop():uS.call(t,n,1),--this.size,!0)};var uk={};uk=function(e){var t=this.__data__,n=uI(t,e);return n<0?void 0:t[n][1]};var uA={};uA=function(e){return uI(this.__data__,e)>-1};var uN={};function uR(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}uN=function(e,t){var n=this.__data__,r=uI(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},uR.prototype.clear=uC,uR.prototype.delete=uT,uR.prototype.get=uk,uR.prototype.has=uA,uR.prototype.set=uN,uE=uR;var uP={};uP=function(){this.__data__=new uE,this.size=0};var uD={};uD=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var uO={};uO=function(e){return this.__data__.get(e)};var uL={};uL=function(e){return this.__data__.has(e)};var uM={},uF={},uU={},uB={},uj={},uV={},uq={},u$=V("23YZo");uq=u$.Symbol;var uH={},uz=Object.prototype,uW=uz.hasOwnProperty,uK=uz.toString,uG=uq?uq.toStringTag:void 0;uH=function(e){var t=uW.call(e,uG),n=e[uG];try{e[uG]=void 0;var r=!0}catch(e){}var i=uK.call(e);return r&&(t?e[uG]=n:delete e[uG]),i};var uY={},uQ=Object.prototype.toString;uY=function(e){return uQ.call(e)};var uX=uq?uq.toStringTag:void 0;uV=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":uX&&uX in Object(e)?uH(e):uY(e)};var uJ={};uJ=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},uj=function(e){if(!uJ(e))return!1;var t=uV(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};var uZ={},u0={},u$=V("23YZo");u0=u$["__core-js_shared__"];var u1=(m=/[^.]+$/.exec(u0&&u0.keys&&u0.keys.IE_PROTO||""))?"Symbol(src)_1."+m:"";uZ=function(e){return!!u1&&u1 in e};var u2={},u6=Function.prototype.toString;u2=function(e){if(null!=e){try{return u6.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var u3=/^\[object .+?Constructor\]$/,u5=Object.prototype,u4=Function.prototype.toString,u8=u5.hasOwnProperty,u7=RegExp("^"+u4.call(u8).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");uB=function(e){return!(!uJ(e)||uZ(e))&&(uj(e)?u7:u3).test(u2(e))};var u9={};u9=function(e,t){return null==e?void 0:e[t]},uU=function(e,t){var n=u9(e,t);return uB(n)?n:void 0};var u$=V("23YZo");uF=uU(u$,"Map");var ce={},ct={},cn={},cr={},ci={};ci=uU(Object,"create"),cr=function(){this.__data__=ci?ci(null):{},this.size=0};var cs={};cs=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=!!t,t};var co={},ca=Object.prototype.hasOwnProperty;co=function(e){var t=this.__data__;if(ci){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return ca.call(t,e)?t[e]:void 0};var cl={},ch=Object.prototype.hasOwnProperty;cl=function(e){var t=this.__data__;return ci?void 0!==t[e]:ch.call(t,e)};var cu={};function cc(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}cu=function(e,t){var n=this.__data__;return this.size+=+!this.has(e),n[e]=ci&&void 0===t?"__lodash_hash_undefined__":t,this},cc.prototype.clear=cr,cc.prototype.delete=cs,cc.prototype.get=co,cc.prototype.has=cl,cc.prototype.set=cu,cn=cc,ct=function(){this.size=0,this.__data__={hash:new cn,map:new(uF||uE),string:new cn}};var cd={},cf={},cp={};cp=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e},cf=function(e,t){var n=e.__data__;return cp(t)?n["string"==typeof t?"string":"hash"]:n.map},cd=function(e){var t=cf(this,e).delete(e);return this.size-=!!t,t};var cg={};cg=function(e){return cf(this,e).get(e)};var cm={};cm=function(e){return cf(this,e).has(e)};var cy={};function c_(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function cv(e){var t=this.__data__=new uE(e);this.size=t.size}cy=function(e,t){var n=cf(this,e),r=n.size;return n.set(e,t),this.size+=+(n.size!=r),this},c_.prototype.clear=ct,c_.prototype.delete=cd,c_.prototype.get=cg,c_.prototype.has=cm,c_.prototype.set=cy,ce=c_,uM=function(e,t){var n=this.__data__;if(n instanceof uE){var r=n.__data__;if(!uF||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new ce(r)}return n.set(e,t),this.size=n.size,this},cv.prototype.clear=uP,cv.prototype.delete=uD,cv.prototype.get=uO,cv.prototype.has=uL,cv.prototype.set=uM,ub=cv;var cw={},cb={},cE={},cC={},cT={};cT=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var cI={};function cx(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new ce;++t<n;)this.add(e[t])}cI=function(e){return this.__data__.has(e)},cx.prototype.add=cx.prototype.push=cT,cx.prototype.has=cI,cC=cx;var cS={};cS=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1};var ck={};ck=function(e,t){return e.has(t)},cE=function(e,t,n,r,i,s){var o=1&n,a=e.length,l=t.length;if(a!=l&&!(o&&l>a))return!1;var h=s.get(e),u=s.get(t);if(h&&u)return h==t&&u==e;var c=-1,d=!0,f=2&n?new cC:void 0;for(s.set(e,t),s.set(t,e);++c<a;){var p=e[c],g=t[c];if(r)var m=o?r(g,p,c,t,e,s):r(p,g,c,e,t,s);if(void 0!==m){if(m)continue;d=!1;break}if(f){if(!cS(t,function(e,t){if(!ck(f,t)&&(p===e||i(p,e,n,r,s)))return f.push(t)})){d=!1;break}}else if(!(p===g||i(p,g,n,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d};var cA={},cN={},u$=V("23YZo");cN=u$.Uint8Array;var cR={};cR=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n};var cP={};cP=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n};var cD=uq?uq.prototype:void 0,cO=cD?cD.valueOf:void 0;cA=function(e,t,n,r,i,s,o){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!s(new cN(e),new cN(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return ux(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=cR;case"[object Set]":var l=1&r;if(a||(a=cP),e.size!=t.size&&!l)break;var h=o.get(e);if(h)return h==t;r|=2,o.set(e,t);var u=cE(a(e),a(t),r,i,s,o);return o.delete(e),u;case"[object Symbol]":if(cO)return cO.call(e)==cO.call(t)}return!1};var cL={},cM={},cF={},cU={};cU=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e};var cB={};cB=Array.isArray,cF=function(e,t,n){var r=t(e);return cB(e)?r:cU(r,n(e))};var cj={},cV={};cV=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s};var cq={};cq=function(){return[]};var c$=Object.prototype.propertyIsEnumerable,cH=Object.getOwnPropertySymbols;cj=cH?function(e){return null==e?[]:(e=Object(e),cV(cH(e),function(t){return c$.call(e,t)}))}:cq;var cz={},cW={},cK={};cK=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};var cG={},cY={},cQ={};cQ=function(e){return null!=e&&"object"==typeof e},cY=function(e){return cQ(e)&&"[object Arguments]"==uV(e)};var cX=Object.prototype,cJ=cX.hasOwnProperty,cZ=cX.propertyIsEnumerable;cG=cY(function(){return arguments}())?cY:function(e){return cQ(e)&&cJ.call(e,"callee")&&!cZ.call(e,"callee")};var c0=V("f504n"),c1={},c2=/^(?:0|[1-9]\d*)$/;c1=function(e,t){var n=typeof e;return!!(t=null==t?0x1fffffffffffff:t)&&("number"==n||"symbol"!=n&&c2.test(e))&&e>-1&&e%1==0&&e<t};var c6={},c3={},c5={};c5=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=0x1fffffffffffff};var c4={};c4["[object Float32Array]"]=c4["[object Float64Array]"]=c4["[object Int8Array]"]=c4["[object Int16Array]"]=c4["[object Int32Array]"]=c4["[object Uint8Array]"]=c4["[object Uint8ClampedArray]"]=c4["[object Uint16Array]"]=c4["[object Uint32Array]"]=!0,c4["[object Arguments]"]=c4["[object Array]"]=c4["[object ArrayBuffer]"]=c4["[object Boolean]"]=c4["[object DataView]"]=c4["[object Date]"]=c4["[object Error]"]=c4["[object Function]"]=c4["[object Map]"]=c4["[object Number]"]=c4["[object Object]"]=c4["[object RegExp]"]=c4["[object Set]"]=c4["[object String]"]=c4["[object WeakMap]"]=!1,c3=function(e){return cQ(e)&&c5(e.length)&&!!c4[uV(e)]};var c8={};c8=function(e){return function(t){return e(t)}};var c7=V("jIny1"),c9=c7&&c7.isTypedArray;c6=c9?c8(c9):c3;var de=Object.prototype.hasOwnProperty;cW=function(e,t){var n=cB(e),r=!n&&cG(e),i=!n&&!r&&c0(e),s=!n&&!r&&!i&&c6(e),o=n||r||i||s,a=o?cK(e.length,String):[],l=a.length;for(var h in e)(t||de.call(e,h))&&!(o&&("length"==h||i&&("offset"==h||"parent"==h)||s&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||c1(h,l)))&&a.push(h);return a};var dt={},dn={},dr=Object.prototype;dn=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||dr)};var di={},ds={};di=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object);var da=Object.prototype.hasOwnProperty;dt=function(e){if(!dn(e))return di(e);var t=[];for(var n in Object(e))da.call(e,n)&&"constructor"!=n&&t.push(n);return t};var dl={};dl=function(e){return null!=e&&c5(e.length)&&!uj(e)},cz=function(e){return dl(e)?cW(e):dt(e)},cM=function(e){return cF(e,cz,cj)};var dh=Object.prototype.hasOwnProperty;cL=function(e,t,n,r,i,s){var o=1&n,a=cM(e),l=a.length;if(l!=cM(t).length&&!o)return!1;for(var h=l;h--;){var u=a[h];if(!(o?u in t:dh.call(t,u)))return!1}var c=s.get(e),d=s.get(t);if(c&&d)return c==t&&d==e;var f=!0;s.set(e,t),s.set(t,e);for(var p=o;++h<l;){var g=e[u=a[h]],m=t[u];if(r)var y=o?r(m,g,u,t,e,s):r(g,m,u,e,t,s);if(!(void 0===y?g===m||i(g,m,n,r,s):y)){f=!1;break}p||(p="constructor"==u)}if(f&&!p){var _=e.constructor,v=t.constructor;_!=v&&"constructor"in e&&"constructor"in t&&!("function"==typeof _&&_ instanceof _&&"function"==typeof v&&v instanceof v)&&(f=!1)}return s.delete(e),s.delete(t),f};var du={},dc={},u$=V("23YZo");dc=uU(u$,"DataView");var dd={},u$=V("23YZo");dd=uU(u$,"Promise");var df={},u$=V("23YZo");df=uU(u$,"Set");var dp={},u$=V("23YZo");dp=uU(u$,"WeakMap");var dg="[object Map]",dm="[object Promise]",dy="[object Set]",d_="[object WeakMap]",dv="[object DataView]",dw=u2(dc),db=u2(uF),dE=u2(dd),dC=u2(df),dT=u2(dp),dI=uV;(dc&&dI(new dc(new ArrayBuffer(1)))!=dv||uF&&dI(new uF)!=dg||dd&&dI(dd.resolve())!=dm||df&&dI(new df)!=dy||dp&&dI(new dp)!=d_)&&(dI=function(e){var t=uV(e),n="[object Object]"==t?e.constructor:void 0,r=n?u2(n):"";if(r)switch(r){case dw:return dv;case db:return dg;case dE:return dm;case dC:return dy;case dT:return d_}return t}),du=dI;var c0=V("f504n"),dx="[object Arguments]",dS="[object Array]",dk="[object Object]",dA=Object.prototype.hasOwnProperty;cb=function(e,t,n,r,i,s){var o=cB(e),a=cB(t),l=o?dS:du(e),h=a?dS:du(t);l=l==dx?dk:l,h=h==dx?dk:h;var u=l==dk,c=h==dk,d=l==h;if(d&&c0(e)){if(!c0(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ub),o||c6(e)?cE(e,t,n,r,i,s):cA(e,t,l,n,r,i,s);if(!(1&n)){var f=u&&dA.call(e,"__wrapped__"),p=c&&dA.call(t,"__wrapped__");if(f||p){var g=f?e.value():e,m=p?t.value():t;return s||(s=new ub),i(g,m,n,r,s)}}return!!d&&(s||(s=new ub),cL(e,t,n,r,i,s))},cw=function e(t,n,r,i,s){return t===n||(null!=t&&null!=n&&(cQ(t)||cQ(n))?cb(t,n,r,i,e,s):t!=t&&n!=n)},uw=function(e,t,n,r){var i=n.length,s=i,o=!r;if(null==e)return!s;for(e=Object(e);i--;){var a=n[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<s;){var l=(a=n[i])[0],h=e[l],u=a[1];if(o&&a[2]){if(void 0===h&&!(l in e))return!1}else{var c=new ub;if(r)var d=r(h,u,l,e,t,c);if(!(void 0===d?cw(u,h,3,r,c):d))return!1}}return!0};var dN={},dR={};dR=function(e){return e==e&&!uJ(e)},dN=function(e){for(var t=cz(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,dR(i)]}return t};var dP={};dP=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},uv=function(e){var t=dN(e);return 1==t.length&&t[0][2]?dP(t[0][0],t[0][1]):function(n){return n===e||uw(n,e,t)}};var dD={},dO={},dL={},dM={},dF={},dU={};dU=function(e){return"symbol"==typeof e||cQ(e)&&"[object Symbol]"==uV(e)};var dB=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,dj=/^\w*$/;dF=function(e,t){if(cB(e))return!1;var n=typeof e;return!!("number"==n||"symbol"==n||"boolean"==n||null==e||dU(e))||dj.test(e)||!dB.test(e)||null!=t&&e in Object(t)};var dV={},dq={},d$={};function dH(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(dH.Cache||ce),n}dH.Cache=ce,d$=dH;var dz=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dW=/\\(\\)?/g;dV=function(e){var t=d$(e,function(e){return 500===n.size&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(dz,function(e,n,r,i){t.push(r?i.replace(dW,"$1"):n||e)}),t});var dK={},dG={},dY=1/0,dQ=uq?uq.prototype:void 0,dX=dQ?dQ.toString:void 0;dG=function e(t){if("string"==typeof t)return t;if(cB(t))return uy(t,e)+"";if(dU(t))return dX?dX.call(t):"";var n=t+"";return"0"==n&&1/t==-dY?"-0":n},dK=function(e){return null==e?"":dG(e)},dM=function(e,t){return cB(e)?e:dF(e,t)?[e]:dV(dK(e))};var dJ={},dZ=1/0;dJ=function(e){if("string"==typeof e||dU(e))return e;var t=e+"";return"0"==t&&1/e==-dZ?"-0":t},dL=function(e,t){t=dM(t,e);for(var n=0,r=t.length;null!=e&&n<r;)e=e[dJ(t[n++])];return n&&n==r?e:void 0},dO=function(e,t,n){var r=null==e?void 0:dL(e,t);return void 0===r?n:r};var d0={},d1={};d1=function(e,t){return null!=e&&t in Object(e)};var d2={};d2=function(e,t,n){t=dM(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=dJ(t[r]);if(!(s=null!=e&&n(e,o)))break;e=e[o]}return s||++r!=i?s:!!(i=null==e?0:e.length)&&c5(i)&&c1(o,i)&&(cB(e)||cG(e))},d0=function(e,t){return null!=e&&d2(e,t,d1)},dD=function(e,t){return dF(e)&&dR(t)?dP(dJ(e),t):function(n){var r=dO(n,e);return void 0===r&&r===t?d0(n,e):cw(t,r,3)}};var d6={};d6=function(e){return e};var d3={},d5={};d5=function(e){return function(t){return null==t?void 0:t[e]}};var d4={};d4=function(e){return function(t){return dL(t,e)}},d3=function(e){return dF(e)?d5(dJ(e)):d4(e)},u_=function(e){return"function"==typeof e?e:null==e?d6:"object"==typeof e?cB(e)?dD(e[0],e[1]):uv(e):d3(e)};var d8={},d7={},d9={},fe={},ft={};fe=function(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var l=o[e?a:++i];if(!1===n(s[l],l,s))break}return t}}();var fn={};d7=function(e,t){return function(n,r){if(null==n)return n;if(!dl(n))return e(n,r);for(var i=n.length,s=t?i:-1,o=Object(n);(t?s--:++s<i)&&!1!==r(o[s],s,o););return n}}(d9=function(e,t){return e&&fe(e,t,cz)}),d8=function(e,t){var n=-1,r=dl(e)?Array(e.length):[];return d7(e,function(e,i,s){r[++n]=t(e,i,s)}),r},um=function(e,t){return(cB(e)?uy:d8)(e,u_(t,3))};const fr="http://localhost:3000",fi={data:{email:"",nombre:"",messages:[],userId:"",roomId:"",rtdbRoomId:""},listeners:[],getState(){return this.data},setState(e){for(let t of(this.data=e,this.listeners))t();localStorage.setItem("state",JSON.stringify(e)),console.log("Soy el state, he cambiado",e)},init(){let e=localStorage.getItem("state");if(e){let t=JSON.parse(e);this.setState(t),console.log("Estado inicializado desde localStorage",t)}else console.log("No hay estado en localStorage, se inicia con valores por defecto")},listenRoom(){var e,t;let n=this.getState();!function(e,t,n,r,i){var s;let o,a;if("object"==typeof r&&(o=void 0,i=r),"function"==typeof r&&(o=r),i&&i.onlyOnce){let t=n,r=(n,r)=>{h0(e._repo,e,h),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}let l=new un(n,o||void 0),h="value"===t?new ua(l):new ul(t,l);s=e._repo,a=".info"===aC(e._path)?hf(s.infoSyncTree_,e,h):hf(s.serverSyncTree_,e,h),hW(s.eventQueue_,e._path,a),()=>h0(e._repo,e,h)}((e=ug,t="/rooms/"+n.rtdbRoomId,(e=tv(e))._checkNotDeleted("ref"),void 0!==t?uo(e._root,t):e._root),"value",e=>{var t;let r=e.val();n.messages=r?((t=um)&&t.__esModule?t.default:t)(r):[],this.setState(n)},void 0,void 0)},sendMessage(e){let t=this.getState();fetch(fr+"/messages",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({from:t.nombre,message:e,rtdbRoomId:t.rtdbRoomId})}).then(e=>e.json()).then(e=>{console.log("soy sendMessage",e)})},setEmailAndName(e){let t=this.getState();t.nombre=e.name,t.email=e.email,t.roomId=e.roomId,this.setState(t)},signIn(e){let t=this.getState();t.email?fetch(fr+"/auth",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email.trim()})}).then(e=>e.json()).then(n=>{t.userId=n.userId,this.setState(t),t.roomId?this.accesToRoom():this.askNewRoom(),e&&e()}):console.error("No hay email en state")},askNewRoom(e){let t=this.getState();t.userId?fetch(fr+"/rooms",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.userId})}).then(e=>e.json()).then(n=>{t.roomId=n.roomId,this.setState(t),this.accesToRoom(),e&&e()}):console.error("No hay userId en state")},accesToRoom(e){let t=this.getState();fetch(fr+"/rooms/"+t.roomId+"?userId="+t.userId,{method:"get"}).then(e=>e.json()).then(n=>{t.rtdbRoomId=n.rtdbRoomId,this.setState(t),this.listenRoom(),e&&e()})},subscribe(e){this.listeners.push(e)}};fi.init();class fs extends HTMLElement{constructor(){super(),this.render()}render(){let e=this.attachShadow({mode:"open"}),t=document.createElement("style"),n=document.createElement("div"),r=this.getAttribute("name");n.innerHTML=`
      <form class="form">
      <input type="text" class="input" id="input" name="${r}">
      <button class="button" ></button>
      </form>
      `,t.innerHTML=`
      .input{
        width: 100%;
        height: 55px;
        margin:0;
        border: solid 2px black;
        box-sizing: border-box;
        }
        .button{
          width: 100%;
          height: 55px;
          background-color: #9CBBE9;
          margin:0;
          margin-top: 12px;
          padding: 0;
          }
          
          `,n.querySelector(".button").textContent=this.textContent,e.appendChild(n),e.appendChild(t);let i=n.querySelector(".form");i?.addEventListener("submit",e=>{this.dispatchEvent(new CustomEvent("form-clicked")),e.preventDefault()})}}customElements.define("input-comp",fs);class fo extends HTMLElement{constructor(){super(),this.render()}render(){let e,t=this.attachShadow({mode:"open"}),n=this.getAttribute("class"),r=document.createElement("style");(e="title"===n?document.createElement("h1"):"label"===n?document.createElement("h4"):"chat"===n?document.createElement("p"):"name"===n?document.createElement("h6"):document.createElement("p")).textContent=this.textContent,e.className=n,r.innerHTML=`
        .title{
          font-weight: 700;
          font-size: 52px;
          margin: 0;
        }
        .label{
          font-weight: 500;
          font-size: 24px;
          margin: 0;

        }
        .chat{
          font-weight: 400;
          font-size: 18px;
          margin: 0;
        }
        .name{
          font-weight: 400;
          font-size: 14px;
          color: #A5A5A5;
          margin: 0;
        }
      `,t.appendChild(e),t.appendChild(r)}}customElements.define("text-comp",fo);class fa extends HTMLElement{constructor(){super(),this.render()}render(){let e=document.createElement("div");e.style.height="60px",e.style.backgroundColor="#FF8282",this.appendChild(e)}}customElements.define("header-comp",fa);class fl extends HTMLElement{constructor(){super(),this.render()}render(){let e=this.attachShadow({mode:"open"}),t=document.createElement("div"),n=document.createElement("style");t.innerHTML=`
      <header-comp></header-comp>
      <div class="container-title">
        <text-comp class="title">Bienvenido</text-comp>
      </div>
      <div class="container-form">
        <form class="form">
          <text-comp class="label" for="email"> Email </text-comp>
          <input type="email" class="input" id="email" name="email">
          <text-comp class="label" for="name"> Tu nombre </text-comp>
          <input type="text" class="input" id="name" name="nombre">
          <text-comp class="label room-label" for="room"> Room </text-comp>
          <select class="input room-input" id="room" name="select-room">
            <option value="room-existente">Room existente</option>
            <option value="nuevo-room">Nuevo room</option>
          </select>
          <text-comp class="label roomId-label" for="roomId"> Room id </text-comp>
          <input type="text" class="input roomId" id="roomId" name="roomId" placeholder="AXFTR1">
          <button class="button" >Comenzar</button>
        </form>
      </div>  
    `,n.innerHTML=`
      .input{
        width: 100%;
        height: 55px;
        margin:0;
        border: solid 2px black;
        box-sizing: border-box;
        font-size: 20px;
      }
      .button{
        width: 100%;
        height: 55px;
        background-color: #9CBBE9;
        margin:0;
        margin-top: 15px;
        padding: 0;
        font-size: 20px;
      }
      text-comp .label{
        margin-top:15px;
      }
      `;let r=t.querySelector(".form");r?.addEventListener("submit",e=>{e.preventDefault();let t=Object.fromEntries(new FormData(e.target).entries());fi.setEmailAndName({email:t.email,name:t.nombre,roomId:t.roomId||""}),fi.signIn(),eM.go("/chat")});let i=r?.querySelector(".room-input"),s=r?.querySelector(".roomId"),o=r?.querySelector(".roomId-label");i?.addEventListener("change",e=>{"nuevo-room"===e.target.value?(s.style.display="none",o.style.display="none"):(s.style.display="block",o.style.display="block")}),e.appendChild(n),e.appendChild(t)}}customElements.define("home-page",fl);class fh extends HTMLElement{connectedCallback(){this.render(),fi.subscribe(()=>{let e=fi.getState();this.messages=e.messages,this.render()})}render(){this.shadow.innerHTML="";let e=document.createElement("style"),t=document.createElement("div");t.innerHTML=`
      <div class="container">
        <div class="container-header">
          <header-comp></header-comp>
          <text-comp class="title">Chat</text-comp>
          <text-comp class="label"> romm id:${fi.getState().roomId}</text-comp>
        </div>
        <div class="container-chat">
        ${this.messages.filter(e=>e.from&&e.message).map(e=>{let t=e.from===fi.data.nombre;return`
            <div class="chat-container">
              <text-comp class="name ${t?"current-name":"other-name"}">${e.from}</text-comp>
              <div class="message-container ${t?"current-user":"other-user"}">
                <text-comp class="message">${e.message}</text-comp> 
              </div> 
            </div>
            `}).join("")} 
          </div>  
          <div class="container-input">
          <input-comp class="input">Enviar</input-comp>
          </div>  
        </div>
        `,e.innerHTML=`
        .container{
          display: grid;
          grid-template-rows: 22% 56% 22%; 
          box-sizing: border-box;
        }
        .container-header{
          grid-row:1;
        }
        .container-chat{
          grid-row:2;
          height: 380px;
          overflow: scroll;

        }    
        .container-input{
          grid-row:3;
          margin:0;
          margin-top:10px;
          
        }  
        .chat-container{
          margin:0;
          padding:0;
          display: flex;
          flex-direction: column;
        }
        .message-container{
          padding:15px;
          margin:0;
          margin-bottom: 10px;
          display:block;
          max-width: 60px;
          border-radius: 5px;
          text-align: center;
          }
          .message-container.current-user{
            background-color: #B9E97C;
            align-self: flex-end;
          }
          .name.current-name{
            display:none;
          }
          .message-container.other-user{
            background-color: #D8D8D8;
          }
          .message{
            margin:0;
            padding:0;
            display:block;
          }
          `,t.querySelector(".input").addEventListener("form-clicked",e=>{let t=e.target.shadowRoot.querySelector("input").value;fi.sendMessage(t)}),this.shadow.appendChild(t),this.shadow.appendChild(e);let n=this.shadow.querySelector(".container-chat");n.scrollTop=n.scrollHeight}constructor(...e){super(...e),this.shadow=this.attachShadow({mode:"open"}),this.messages=fi.getState().messages}}customElements.define("chat-page",fh);
//# sourceMappingURL=ejercicioRooms.b4f453ee.js.map
